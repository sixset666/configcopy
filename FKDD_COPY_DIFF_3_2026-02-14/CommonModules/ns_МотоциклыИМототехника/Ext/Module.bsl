Функция СправочникМотоциклыИМототехникаСопоставлен() Экспорт
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	ns_МотоциклыИМототехника.Ссылка КАК Ссылка
	|ИЗ
	|	Справочник.ns_МотоциклыИМототехника КАК ns_МотоциклыИМототехника";
	РезультатЗапроса = Запрос.Выполнить();
	
	Если РезультатЗапроса.Пустой() Тогда
		Возврат Ложь;
	Иначе
		Возврат Истина;
	КонецЕсли; 
КонецФункции

// Область Выгрузка

Функция ПолучитьДанныеНоменклатуры(МагазинСтрока) Экспорт 
	Если ns_ОбщегоНазначенияПовтИсп.ПолучитьДобавлятьIDКатегории() Тогда
		Префикс = "moto-" + Строка(МагазинСтрока.Магазин.Префикс) + "-";
	Иначе
		Префикс = Строка(МагазинСтрока.Магазин.Префикс);
	КонецЕсли;	
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ns_МотоциклыИМототехника.Номенклатура КАК Номенклатура,
	|	ns_МотоциклыИМототехника.Title КАК Title,
	|	ns_МотоциклыИМототехника.AdStatus КАК AdStatus,
	|	ns_МотоциклыИМототехника.AllowEmail КАК AllowEmail,
	|	ns_МотоциклыИМототехника.AvitoId КАК AvitoId,
	|	ns_МотоциклыИМототехника.Category КАК Category,
	|	ns_МотоциклыИМототехника.DateBegin КАК DateBegin,
	|	ns_МотоциклыИМототехника.DateEnd КАК DateEnd,
	|	&Префикс + ns_МотоциклыИМототехника.Id КАК Id,
	|	ns_МотоциклыИМототехника.ListingFee КАК ListingFee,
	|	ns_МотоциклыИМототехника.nsDescription КАК nsDescription,
	|	ns_МотоциклыИМототехника.VideoURL КАК VideoURL,
	|	ns_МотоциклыИМототехника.Шаблон КАК Шаблон,
	|	0 КАК Price,
	|	ВЫРАЗИТЬ("""" КАК СТРОКА(17)) КАК ContactPhone,
	|	ВЫРАЗИТЬ("""" КАК СТРОКА(40)) КАК ManagerName,
	|	ВЫРАЗИТЬ("""" КАК СТРОКА(255)) КАК Address,
	|	ns_МотоциклыИМототехника.Артикул КАК Артикул,
	|	ns_МотоциклыИМототехника.Наименование КАК Наименование,
	|	ns_МотоциклыИМототехника.Характеристика КАК Характеристика,
	|	ns_МотоциклыИМототехника.Ссылка КАК Ссылка,
	|	ns_МотоциклыИМототехника.Condition КАК Condition,
	|	ns_МотоциклыИМототехника.VehicleType КАК VehicleType,
	|	ns_МотоциклыИМототехника.MotoType КАК MotoType
	|ИЗ
	|	Справочник.ns_МотоциклыИМототехника КАК ns_МотоциклыИМототехника
	|ГДЕ
	|	ns_МотоциклыИМототехника.ЭтоГруппа = ЛОЖЬ
	|	И ns_МотоциклыИМототехника.Выгружать = ИСТИНА";
	Запрос.УстановитьПараметр("Префикс", Префикс);
	РезультатЗапроса = Запрос.Выполнить();
	
	Возврат РезультатЗапроса.Выгрузить();
КонецФункции

// Область Выгрузка

//Область Сопоставление

Процедура Сопоставить(Ссылка, Характеристика, Родитель, ТаблицаСопоставления) Экспорт
	Изменен = Истина;
	
	СсылкаНаЭлемент = ns_Сопоставление.НайтиСопоставление(Ссылка, Характеристика, ТаблицаСопоставления);
	Если СсылкаНаЭлемент = Неопределено Тогда
		ОбъектЭлемент = Справочники.ns_МотоциклыИМототехника.СоздатьЭлемент();
		ОбъектЭлемент.Номенклатура = Ссылка;
		Если ЗначениеЗаполнено(Характеристика) Тогда
			ОбъектЭлемент.Характеристика = Характеристика;
			Id = Строка(Ссылка.УникальныйИдентификатор()) + "#" + Строка(Характеристика.УникальныйИдентификатор());
		Иначе
			Id = Строка(Ссылка.УникальныйИдентификатор());
		КонецЕсли; 
		ОбъектЭлемент.Id = Id;
		ОбъектЭлемент.Category = ns_МотоциклыИМототехникаПовтИсп.ПолучитьМотоциклыИМототехника();
		ОбъектЭлемент.Выгружать = ns_ОбщегоНазначенияПовтИсп.ПолучитьДобавлятьВВыгрузку();
		ОбъектЭлемент.Condition = ns_ОбщегоНазначенияПовтИсп.ПолучитьConditionМотоциклыИМототехника();
		
		Изменен = Истина;
	Иначе
		ОбъектЭлемент = СсылкаНаЭлемент.ПолучитьОбъект();
	КонецЕсли; 
	
	ns_Сопоставление.ЗаполнитьTitle(ОбъектЭлемент);
	ns_Сопоставление.ЗаполнитьDescription(Ссылка, ОбъектЭлемент);
	
	ОбъектЭлемент.ПометкаУдаления = Ссылка.ПометкаУдаления;
	ОбъектЭлемент.Наименование = Ссылка.Наименование;
	ОбъектЭлемент.Артикул = Ссылка.Артикул;
	ОбъектЭлемент.Родитель = Справочники.ns_МотоциклыИМототехника.ПолучитьСсылку(Родитель.УникальныйИдентификатор());
	
	Если Изменен Тогда
		ОбъектЭлемент.Записать();
	КонецЕсли; 
	
КонецПроцедуры

Процедура СопоставитьЭлементНоменклатуры(Ссылка) Экспорт
	ns_Сопоставление.СопоставитьЭлементНоменклатуры(Ссылка, "ns_МотоциклыИМототехника");			
КонецПроцедуры
 
//КонецОбласти











