
////////////////////////////////////////////////////////////////////////////////
// ПЕРЕМЕННЫЕ ОБЪЕКТА


////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ДОПОЛНИТЕЛЬНЫХ МЕТОДОВ ОБЪЕКТА

// Рассчитаем размеры ячеек, исходя из указанного количества и размеров склада
//
// Возвращаемое значение:
//    Структура - СредняяДлинаЯчейки, СредняяШиринаЯчейки
//
Функция РассчитатьРазмерыЯчейки() Экспорт
	// Округляем в меньшую сторону, чтобы ячейки не "вылезли" за пределы склада
	СредняяДлинаЯчейки  = ?(ЧислоЯчеек > 0, Окр((Склад.ДлинаСклада  + Зазор) / (ЧислоЯчеек + Зазор), 2, РежимОкругления.Окр15как10), 0);  
	СредняяШиринаЯчейки = ?(ЧислоРядов > 0, Окр((Склад.ШиринаСклада + Зазор) / (ЧислоРядов + Зазор), 2, РежимОкругления.Окр15как10), 0);  
	СтруктураРазмеры = Новый Структура ("СредняяДлинаЯчейки, СредняяШиринаЯчейки",СредняяДлинаЯчейки,СредняяШиринаЯчейки);
	Возврат СтруктураРазмеры;
КонецФункции // РассчитатьРазмерыЯчейки()

// Рассчитаем количество ячеек, исходя из указанных размеров ячеек и склада
//
// Возвращаемое значение:
//    Структура 	- КоличествоЯчеек, КоличествоРядов
//
Функция РассчитатьКоличествоЯчеек() Экспорт
	// длину склада мы увеличиваем на величину зазора, поскольку зазоры между крайними ячейками и
	// "стенками" склада мы не учитываем
	КоличествоЯчеек = ?(ДлинаЯчейки  > 0, Цел((Склад.ДлинаСклада  + Зазор) / (ДлинаЯчейки  + Зазор)), 0);  
	КоличествоРядов = ?(ШиринаЯчейки > 0, Цел((Склад.ШиринаСклада + Зазор) / (ШиринаЯчейки + Зазор)), 0);  
	СтруктураКоличество = Новый Структура ("КоличествоЯчеек, КоличествоРядов",КоличествоЯчеек,КоличествоРядов);
	Возврат СтруктураКоличество;
КонецФункции // РассчитатьКоличествоЯчеек()

// Процедура заполнения выбранного склада ячейками
//
// Параметры:
//    НЕТ
//
Процедура СоздатьЯчейки() Экспорт
	Если СтратегияЗаполнения = 1 Тогда
		СтруктураКоличество = РассчитатьКоличествоЯчеек();
		// Создадим нужно количество ячеек
		НачатьТранзакцию();
		ОбщееКоличество = СтруктураКоличество.КоличествоЯчеек * СтруктураКоличество.КоличествоРядов * Склад.ЧислоУровней;
		Счетчик = 0;
		СтарЗначение = 0;
		Прогресс = 0;
		#Если Клиент Тогда
		Состояние("Выполнено: 0%");
		#КонецЕсли
		// координаты x, y и z начинаются с нуля
		Для x = 0 По СтруктураКоличество.КоличествоЯчеек - 1 Цикл
			Для y = 0 По СтруктураКоличество.КоличествоРядов -1 Цикл
				Для z = 0 По Склад.ЧислоУровней-1 Цикл
					НовыйЭлемент = Справочники.ЯчейкиХранения.СоздатьЭлемент();
					НовыйЭлемент.Владелец = Склад;			
					НовыйЭлемент.КоординатаX = x;
					НовыйЭлемент.КоординатаY = y;
					НовыйЭлемент.КоординатаX = x * (ДлинаЯчейки  + Зазор);
					НовыйЭлемент.КоординатаY = y * (ШиринаЯчейки + Зазор);
					НовыйЭлемент.Уровень 	 = z;
					НовыйЭлемент.ДлинаЯчейки	 = ДлинаЯчейки;
					НовыйЭлемент.ШиринаЯчейки 	 = ШиринаЯчейки;
					НовыйЭлемент.Недоступна  = Ложь;
					НовыйЭлемент.Код = "" + (x+1) + "-" + (y+1) + "-" + (z);
					НовыйЭлемент.Записать();
					#Если Клиент Тогда
					ОбработкаПрерыванияПользователя();
					Счетчик = Счетчик + 1;
					Прогресс = Цел(Счетчик * 100 / ОбщееКоличество);
					Если Прогресс <> СтарЗначение Тогда
						Состояние("Выполнено: " + Прогресс + "%");
					    СтарЗначение = Прогресс;
					КонецЕсли; 
					#КонецЕсли
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		ЗафиксироватьТранзакцию();
	ИначеЕсли СтратегияЗаполнения = 2 Тогда	
		РазмерыЯчейки = РассчитатьРазмерыЯчейки();
		// Создадим нужное количество ячеек
		НачатьТранзакцию();
		ОбщееКоличество = ЧислоЯчеек * ЧислоРядов * Склад.ЧислоУровней;
		Счетчик = 0;
		СтарЗначение = 0;
		#Если Клиент Тогда
		Состояние("Выполнено: 0%");
		#КонецЕсли
		// координаты x, y и z начинаются с нуля
		Для x = 0 По ЧислоЯчеек - 1 Цикл
			Для y = 0 По ЧислоРядов - 1 Цикл
				Для z = 0 По Склад.ЧислоУровней-1 Цикл
					НовыйЭлемент = Справочники.ЯчейкиХранения.СоздатьЭлемент();
					НовыйЭлемент.Владелец = Склад;			
					НовыйЭлемент.КоординатаX = x * (РазмерыЯчейки.СредняяДлинаЯчейки  + Зазор);
					НовыйЭлемент.КоординатаY = y * (РазмерыЯчейки.СредняяШиринаЯчейки + Зазор);
					НовыйЭлемент.Уровень 	 = z;
					НовыйЭлемент.ДлинаЯчейки	 = РазмерыЯчейки.СредняяДлинаЯчейки;
					НовыйЭлемент.ШиринаЯчейки 	 = РазмерыЯчейки.СредняяШиринаЯчейки;
					НовыйЭлемент.Недоступна  = Ложь;
					НовыйЭлемент.Код = "" + (x+1) + "-" + (y+1) + "-" + (z);
					НовыйЭлемент.Записать();
					#Если Клиент Тогда
					ОбработкаПрерыванияПользователя();
					Счетчик = Счетчик + 1;
					Прогресс = Цел(Счетчик * 100 / ОбщееКоличество);
					Если Прогресс <> СтарЗначение Тогда
						Состояние("Выполнено: " + Прогресс + "%");
					    СтарЗначение = Прогресс;
					КонецЕсли; 
					#КонецЕсли
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		ЗафиксироватьТранзакцию();
	КонецЕсли; 
	
КонецПроцедуры // СоздатьЯчейки()

////////////////////////////////////////////////////////////////////////////////
// ИСПОЛНЯЕМАЯ ЧАСТЬ МОДУЛЯ
