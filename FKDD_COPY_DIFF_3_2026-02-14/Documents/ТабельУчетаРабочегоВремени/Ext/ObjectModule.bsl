
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если РежимЗаписи=РежимЗаписиДокумента.Проведение Тогда
		
		Если НЕ ПериодРаботы=Дата('00010101') Тогда
			НачПериода=НачалоМесяца(ПериодРаботы);
			КонПериода=КонецМесяца(ПериодРаботы);
		Иначе
			Сообщить("Неверная периодичность");
			Возврат;
		КонецЕсли;

		Запрос=Новый Запрос("ВЫБРАТЬ
		|	ТабельУчетаРабочегоВремениТабель.Сотрудник,
		|	ТабельУчетаРабочегоВремениТабель.Ссылка
		|ИЗ
		|	Документ.ТабельУчетаРабочегоВремени.Табель КАК ТабельУчетаРабочегоВремениТабель
		|ГДЕ
		|	ТабельУчетаРабочегоВремениТабель.Ссылка.ПериодРаботы МЕЖДУ &НачПериода И &КонПериода
		|	И ТабельУчетаРабочегоВремениТабель.Сотрудник В(&Сотрудники)
		|	И ТабельУчетаРабочегоВремениТабель.Ссылка <> &Ссылка
		|	И НЕ ТабельУчетаРабочегоВремениТабель.Ссылка.ПометкаУдаления
		|
		|СГРУППИРОВАТЬ ПО
		|	ТабельУчетаРабочегоВремениТабель.Сотрудник,
		|	ТабельУчетаРабочегоВремениТабель.Ссылка");
		
		Запрос.УстановитьПараметр("НачПериода",НачПериода);
		Запрос.УстановитьПараметр("КонПериода",КонПериода);
		
		СпСот=Новый СписокЗначений;
		М=Табель.ВыгрузитьКолонку("Сотрудник");
		СпСот.ЗагрузитьЗначения(М);
		Запрос.УстановитьПараметр("Сотрудники",СпСот);
		Запрос.УстановитьПараметр("Ссылка",ЭтотОбъект.Ссылка);
		Выб=Запрос.Выполнить().Выбрать();
		Ошибки="";
		Пока Выб.Следующий() Цикл
			Отказ=истина;
			Ошибки=Ошибки+"
			|Табель по сотруднику "+Выб.Сотрудник+" уже сформирован "+Выб.Ссылка.Номер + " от "+Выб.Ссылка.Дата + " Нельзя вводить еще один!";
		КонецЦикла;
		             
		Если Отказ Тогда
			Сообщить(Ошибки);
		КонецЕсли;
		
	КонецЕсли;

КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	Если Табель.Количество() = 0 Тогда
		Сообщить("Не заполненный документ провести нельзя!");
		Отказ = истина;
	КонецЕсли;

КонецПроцедуры
