
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Для Каждого ТекСтр из ДатыЗапрета Цикл
		Если Год(ТекСтр.Месяц)<>Год(Период) Тогда
			ТекСтр.Месяц=Дата(Год(Период),Месяц(ТекСтр.Месяц),1,0,0,0);
		КонецЕсли;
	КонецЦикла;
	
	Если РежимЗаписи=РежимзаписиДокумента.Проведение Тогда
		
		Запрос=новый Запрос("ВЫБРАТЬ
		|	ДатыЗапретаРедактированияНачислений.Ссылка
		|ИЗ
		|	Документ.ДатыЗапретаРедактированияНачислений КАК ДатыЗапретаРедактированияНачислений
		|ГДЕ
		|	ДатыЗапретаРедактированияНачислений.Проведен
		|	И ДатыЗапретаРедактированияНачислений.Организация = &Организация
		|	И ДатыЗапретаРедактированияНачислений.Период = &Период
		|	И ДатыЗапретаРедактированияНачислений.Ссылка <> &Ссылка
		|	И ДатыЗапретаРедактированияНачислений.ПодразделениеКомпании = &Подразделение");
		
		Запрос.УстановитьПараметр("Организация",Организация);
		Запрос.УстановитьПараметр("Ссылка",Ссылка);
		Запрос.УстановитьПараметр("Период",Период);
		Запрос.УстановитьПараметр("Подразделение",ПодразделениеКомпании);
		Выб=Запрос.Выполнить().Выбрать();
		
		Если Выб.Следующий() Тогда
			
			Сообщить("Уже есть документ для этого периода!");
			
			Отказ=истина;
			
			Возврат;
			
		КонецЕсли;
		
	КонецЕсли;

КонецПроцедуры

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	Движения.ДатыЗапретаРедактирования.Записывать = Истина;
	Движения.ДатыЗапретаРедактирования.Очистить();
	
	Для Каждого ТекСтрокаДатыЗапрета Из ДатыЗапрета Цикл
		
		Движение = Движения.ДатыЗапретаРедактирования.Добавить();
		Движение.Период=Дата;
		Движение.Месяц = ТекСтрокаДатыЗапрета.Месяц;
		Движение.Организация=Организация;
		Движение.ПодразделениеКомпании=ПодразделениеКомпании;
		Движение.ЗапретРедактированияРасчета = ТекСтрокаДатыЗапрета.ЗапретРедактированияРасчета;
		Движение.ЗапретРедактированияКорректировок = ТекСтрокаДатыЗапрета.ЗапретРедактированияКорректировок;
		
	КонецЦикла;

КонецПроцедуры
