ВЫБРАТЬ
	ПОДСТРОКА(Понедельник.ДеньНедели + Вторник.ДеньНедели + Среда.ДеньНедели + Четверг.ДеньНедели + Пятница.ДеньНедели + Субота.ДеньНедели + Воскресенье.ДеньНедели, 3, 27) КАК Расшифровка,
	Понедельник.КодСтр + Вторник.КодСтр + Среда.КодСтр + Четверг.КодСтр + Пятница.КодСтр + Субота.КодСтр + Воскресенье.КодСтр КАК ДниНедели
ПОМЕСТИТЬ РасшифровкаДнейНедели
ИЗ
	(ВЫБРАТЬ
		", Вс" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Воскресенье,
	(ВЫБРАТЬ
		", Сб" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	             		
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Субота,
	(ВЫБРАТЬ
		", Пт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Пятница,
	(ВЫБРАТЬ
		", Чт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Четверг,
	(ВЫБРАТЬ
		", Ср" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Среда,
	(ВЫБРАТЬ
		", Вт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Вторник,
	(ВЫБРАТЬ
		", Пн" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Понедельник
;	
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	СкидкиШапкиСрезПоследних.Подразделение,
	СкидкиШапкиСрезПоследних.ЗалОбслуживания,
	СкидкиШапкиСрезПоследних.ДисконтнаяКарта,
	СкидкиШапкиСрезПоследних.Скидка,
	ЧАС(СкидкиШапкиСрезПоследних.НачВремя) КАК ЧасНачВремя,
	МИНУТА(СкидкиШапкиСрезПоследних.НачВремя) КАК МинутаНачВремя,
	СЕКУНДА(СкидкиШапкиСрезПоследних.НачВремя) КАК СекундаНачВремя,
	ЧАС(СкидкиШапкиСрезПоследних.КонВремя) КАК ЧасКонВремя,
	МИНУТА(СкидкиШапкиСрезПоследних.КонВремя) КАК МинутаКонВремя,
	СЕКУНДА(СкидкиШапкиСрезПоследних.КонВремя) КАК СекундаКонВремя,
	РасшифровкаДнейНедели.Расшифровка КАК ДниНедели,
	СкидкиШапкиСрезПоследних.ОтСуммыЧека КАК ДействуетОтСуммыЧека,
	СкидкиШапкиСрезПоследних.РучнаяСкидка КАК СпособВыбора, // Способ установки
	СкидкиШапкиСрезПоследних.ОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	СкидкиШапкиСрезПоследних.ЭтоПодарок,
	СкидкиШапкиСрезПоследних.Свойство,
	СкидкиШапкиСрезПоследних.ЗначениеСкидки,
	СкидкиШапкиСрезПоследних.СпособВычисления,
	СкидкиШапкиСрезПоследних.ФлагВытеснения,
	СкидкиШапкиСрезПоследних.ВидПрайсЛистаПодарка,
	СкидкиШапкиСрезПоследних.МаксимальнаяСуммаПодарка,
	СкидкиШапкиСрезПоследних.ИдентификаторСкидки,
	ВЫБОР
		КОГДА СкидкиШапкиСрезПоследних.СкидкаНаТовары И СкидкиШапкиСрезПоследних.СкидкаНаРаботы ТОГДА
			"Скидка на товары и работы"
		КОГДА СкидкиШапкиСрезПоследних.СкидкаНаТовары ТОГДА
			"Скидка на товары"
		КОГДА СкидкиШапкиСрезПоследних.СкидкаНаРаботы ТОГДА
			"Скидка на работы"
		ИНАЧЕ
		 ""
	КОНЕЦ КАК ПрименяемостьСкидки
	
	{ВЫБРАТЬ
	Подразделение,
	ЗалОбслуживания,
	ДисконтнаяКарта,
	Скидка,
	ЧасНачВремя КАК ЧасНачВремя,
	МинутаНачВремя КАК МинутаНачВремя,
	СекундаНачВремя КАК СекундаНачВремя,
	ЧасКонВремя КАК ЧасКонВремя,
	МинутаКонВремя КАК МинутаКонВремя,
	СекундаКонВремя КАК СекундаКонВремя,
	ДниНедели КАК ДниНедели,
	ДействуетОтСуммыЧека КАК ДействуетОтСуммыЧека,
	СпособВыбора КАК СпособВыбора, // Способ установки
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство,
	// Ресурсы
	ЗначениеСкидки КАК ЗначениеСкидки,
	СпособВычисления КАК СпособВычисления,
	ФлагВытеснения КАК ФлагВытеснения,
	ВидПрайсЛистаПодарка КАК ВидПрайсЛистаПодарка,
	МаксимальнаяСуммаПодарка КАК МаксимальнаяСуммаПодарка,
	ИдентификаторСкидки КАК ИдентификаторСкидки,
	ПрименяемостьСкидки}
	
ПОМЕСТИТЬ ТаблицаСкидок

ИЗ
	РегистрСведений.СкидкиШапки.СрезПоследних(&ДатаКон,
	{Подразделение.* КАК Подразделение,
	ЗалОбслуживания.* КАК ЗалОбслуживания,
	ДисконтнаяКарта.* КАК ДисконтнаяКарта,
	Скидка.* КАК Скидка,
	РучнаяСкидка КАК РучнаяСкидка,
	ОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	РегистраторСкидки.* КАК РегистраторСкидки,
	ОтСуммыЧека КАК ДействуетОтСуммыЧека,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство}
	) КАК СкидкиШапкиСрезПоследних
ЛЕВОЕ СОЕДИНЕНИЕ РасшифровкаДнейНедели КАК РасшифровкаДнейНедели
	ПО
	СкидкиШапкиСрезПоследних.ДниНедели=РасшифровкаДнейНедели.ДниНедели
ГДЕ
	СкидкиШапкиСрезПоследних.Действует
;

ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	ТаблицаСкидок.Подразделение,
	ТаблицаСкидок.ЗалОбслуживания,
	ТаблицаСкидок.ДисконтнаяКарта,
	ТаблицаСкидок.Скидка,
	ТаблицаСкидок.ЧасНачВремя,
	ТаблицаСкидок.МинутаНачВремя,
	ТаблицаСкидок.СекундаНачВремя,
	ТаблицаСкидок.ЧасКонВремя,
	ТаблицаСкидок.МинутаКонВремя,
	ТаблицаСкидок.СекундаКонВремя,
	ТаблицаСкидок.ДниНедели,
	ТаблицаСкидок.ДействуетОтСуммыЧека,
	ВЫБОР КОГДА ТаблицаСкидок.СпособВыбора ТОГДА "Ручной" ИНАЧЕ "Автоматический" КОНЕЦ КАК СпособВыбора,
	ТаблицаСкидок.ДействуетОтСуммыНакопленияНаКарте,
	ВЫБОР КОГДА ТаблицаСкидок.ЭтоПодарок ТОГДА "Да" ИНАЧЕ "Нет" КОНЕЦ КАК ЭтоПодарок,
	ТаблицаСкидок.Свойство,
	ТаблицаСкидок.ЗначениеСкидки,
	ТаблицаСкидок.СпособВычисления,
	ВЫБОР КОГДА ТаблицаСкидок.ФлагВытеснения ТОГДА "Да" ИНАЧЕ "Нет" КОНЕЦ КАК ФлагВытеснения,
	ТаблицаСкидок.ВидПрайсЛистаПодарка,
	ТаблицаСкидок.МаксимальнаяСуммаПодарка,
	ТаблицаСкидок.ИдентификаторСкидки,
	ТаблицаСкидок.ПрименяемостьСкидки
	
	{ВЫБРАТЬ
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ЧасНачВремя КАК ЧасНачВремя,
	МинутаНачВремя КАК МинутаНачВремя,
	СекундаНачВремя КАК СекундаНачВремя,
	ЧасКонВремя КАК ЧасКонВремя,
	МинутаКонВремя КАК МинутаКонВремя,
	СекундаКонВремя КАК СекундаКонВремя,
	ДниНедели КАК ДниНедели,
	ДействуетОтСуммыЧека КАК ДействуетОтСуммыЧека,
	СпособВыбора КАК СпособВыбора,
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство,
	// Ресурсы
	ЗначениеСкидки КАК ЗначениеСкидки,
	СпособВычисления КАК СпособВычисления,
	ФлагВытеснения КАК ФлагВытеснения,
	ВидПрайсЛистаПодарка КАК ВидПрайсЛистаПодарка,
	МаксимальнаяСуммаПодарка КАК МаксимальнаяСуммаПодарка,
	ИдентификаторСкидки КАК ИдентификаторСкидки,
	ПрименяемостьСкидки КАК ПрименяемостьСкидки}
	
ИЗ
	ТаблицаСкидок КАК ТаблицаСкидок
//@ТекстОтбора@

{УПОРЯДОЧИТЬ ПО
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ДниНедели КАК ДниНедели,
	ДействуетОтСуммыЧека КАК ДействуетОтСуммыЧека,
	СпособВыбора КАК СпособВыбора, // Способ установки
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство
}

{ИТОГИ ПО
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ДниНедели.*
}

ИТОГИ 
	МАКСИМУМ(ЧасНачВремя),
	МАКСИМУМ(МинутаНачВремя),
	МАКСИМУМ(СекундаНачВремя),
	МАКСИМУМ(ЧасКонВремя),
	МАКСИМУМ(МинутаКонВремя),
	МАКСИМУМ(СекундаКонВремя)
ПО
	Подразделение,
	ЗалОбслуживания,
	ДисконтнаяКарта,
	Скидка,
	ДниНедели