ВЫБРАТЬ
	ПОДСТРОКА(Понедельник.ДеньНедели + Вторник.ДеньНедели + Среда.ДеньНедели + Четверг.ДеньНедели + Пятница.ДеньНедели + Субота.ДеньНедели + Воскресенье.ДеньНедели, 3, 27) КАК Расшифровка,
	Понедельник.КодСтр + Вторник.КодСтр + Среда.КодСтр + Четверг.КодСтр + Пятница.КодСтр + Субота.КодСтр + Воскресенье.КодСтр КАК ДниНедели
ПОМЕСТИТЬ РасшифровкаДнейНедели
ИЗ
	(ВЫБРАТЬ
		", Вс" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Воскресенье,
	(ВЫБРАТЬ
		", Сб" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	             		
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Субота,
	(ВЫБРАТЬ
		", Пт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Пятница,
	(ВЫБРАТЬ
		", Чт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Четверг,
	(ВЫБРАТЬ
		", Ср" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Среда,
	(ВЫБРАТЬ
		", Вт" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Вторник,
	(ВЫБРАТЬ
		", Пн" КАК ДеньНедели,
		"1" КАК КодСтр,
		3 КАК Длина
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		"",
		"0",
		0) КАК Понедельник
;	
	
ВЫБРАТЬ РАЗРЕШЕННЫЕ
	СкидкиСтрокиСрезПоследних.Подразделение,
	СкидкиСтрокиСрезПоследних.ЗалОбслуживания,
	СкидкиСтрокиСрезПоследних.ДисконтнаяКарта,
	СкидкиСтрокиСрезПоследних.Скидка,
	ЧАС(СкидкиСтрокиСрезПоследних.НачВремя) КАК ЧасНачВремя,
	МИНУТА(СкидкиСтрокиСрезПоследних.НачВремя) КАК МинутаНачВремя,
	СЕКУНДА(СкидкиСтрокиСрезПоследних.НачВремя) КАК СекундаНачВремя,
	ЧАС(СкидкиСтрокиСрезПоследних.КонВремя) КАК ЧасКонВремя,
	МИНУТА(СкидкиСтрокиСрезПоследних.КонВремя) КАК МинутаКонВремя,
	СЕКУНДА(СкидкиСтрокиСрезПоследних.КонВремя) КАК СекундаКонВремя,
	РасшифровкаДнейНедели.Расшифровка КАК ДниНедели,
	СкидкиСтрокиСрезПоследних.Объект КАК ОбъектНазначенияСкидки,
	СкидкиСтрокиСрезПоследних.ОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	СкидкиСтрокиСрезПоследних.ОтКоличества КАК ДействуетОтКоличества,
	СкидкиСтрокиСрезПоследних.Правило КАК ПравилоРасчетаСкидкиПоКоличеству,
	СкидкиСтрокиСрезПоследних.РучнаяСкидка КАК СпособВыбора, // Способ установки
	СкидкиСтрокиСрезПоследних.ОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	СкидкиСтрокиСрезПоследних.ЭтоПодарок,
	СкидкиСтрокиСрезПоследних.Свойство,
	СкидкиСтрокиСрезПоследних.ЗначениеСкидки,
	СкидкиСтрокиСрезПоследних.СпособВычисления,
	СкидкиСтрокиСрезПоследних.ФлагВытеснения,
	СкидкиСтрокиСрезПоследних.ВидПрайсЛистаПодарка,
	СкидкиСтрокиСрезПоследних.МаксимальнаяСуммаПодарка,
	СкидкиСтрокиСрезПоследних.ИдентификаторСкидки,
	ВЫБОР
		КОГДА СкидкиСтрокиСрезПоследних.СкидкаНаТовары И СкидкиСтрокиСрезПоследних.СкидкаНаРаботы ТОГДА
			"Скидка на товары и работы"
		КОГДА СкидкиСтрокиСрезПоследних.СкидкаНаТовары ТОГДА
			"Скидка на товары"
		КОГДА СкидкиСтрокиСрезПоследних.СкидкаНаРаботы ТОГДА
			"Скидка на работы"
		ИНАЧЕ
		 ""
	КОНЕЦ КАК ПрименяемостьСкидки
	
	{ВЫБРАТЬ
	Подразделение,
	ЗалОбслуживания,
	ДисконтнаяКарта,
	Скидка,
	ЧасНачВремя КАК ЧасНачВремя,
	МинутаНачВремя КАК МинутаНачВремя,
	СекундаНачВремя КАК СекундаНачВремя,
	ЧасКонВремя КАК ЧасКонВремя,
	МинутаКонВремя КАК МинутаКонВремя,
	СекундаКонВремя КАК СекундаКонВремя,
	ДниНедели КАК ДниНедели,
	ОбъектНазначенияСкидки КАК ОбъектНазначенияСкидки,
	ДействуетОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	ДействуетОтКоличества КАК ДействуетОтКоличества,
	ПравилоРасчетаСкидкиПоКоличеству КАК ПравилоРасчетаСкидкиПоКоличеству,
	СпособВыбора КАК СпособВыбора, // Способ установки
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство,
	// Ресурсы
	ЗначениеСкидки КАК ЗначениеСкидки,
	СпособВычисления КАК СпособВычисления,
	ФлагВытеснения КАК ФлагВытеснения,
	ВидПрайсЛистаПодарка КАК ВидПрайсЛистаПодарка,
	МаксимальнаяСуммаПодарка КАК МаксимальнаяСуммаПодарка,
	ИдентификаторСкидки КАК ИдентификаторСкидки,
	ПрименяемостьСкидки}

ПОМЕСТИТЬ ТаблицаСкидок

ИЗ
	РегистрСведений.СкидкиСтроки.СрезПоследних(&ДатаКон,
	{Подразделение.* КАК Подразделение,
	ЗалОбслуживания.* КАК ЗалОбслуживания,
	ДисконтнаяКарта.* КАК ДисконтнаяКарта,
	Скидка.* КАК Скидка,
	РучнаяСкидка КАК РучнаяСкидка,
	ОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	Объект.* КАК ОбъектНазначенияСкидки,
	ОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	РегистраторСкидки.* КАК РегистраторСкидки,
	ОтКоличества КАК ДействуетОтКоличества,
	Правило КАК ПравилоРасчетаСкидкиПоКоличеству,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство}
	) КАК СкидкиСтрокиСрезПоследних
ЛЕВОЕ СОЕДИНЕНИЕ РасшифровкаДнейНедели КАК РасшифровкаДнейНедели
	ПО
	СкидкиСтрокиСрезПоследних.ДниНедели=РасшифровкаДнейНедели.ДниНедели
ГДЕ
	СкидкиСтрокиСрезПоследних.Действует
	
;

ВЫБРАТЬ РАЗЛИЧНЫЕ РАЗРЕШЕННЫЕ
	ТаблицаСкидок.Подразделение,
	ТаблицаСкидок.ЗалОбслуживания,
	ТаблицаСкидок.ДисконтнаяКарта,
	ТаблицаСкидок.Скидка,
	ТаблицаСкидок.ЧасНачВремя,
	ТаблицаСкидок.МинутаНачВремя,
	ТаблицаСкидок.СекундаНачВремя,
	ТаблицаСкидок.ЧасКонВремя,
	ТаблицаСкидок.МинутаКонВремя,
	ТаблицаСкидок.СекундаКонВремя,
	ТаблицаСкидок.ДниНедели,
	ТаблицаСкидок.ОбъектНазначенияСкидки КАК ОбъектНазначенияСкидки,
	ТаблицаСкидок.ДействуетОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	ТаблицаСкидок.ДействуетОтКоличества КАК ДействуетОтКоличества,
	ТаблицаСкидок.ПравилоРасчетаСкидкиПоКоличеству КАК ПравилоРасчетаСкидкиПоКоличеству,
	ВЫБОР КОГДА ТаблицаСкидок.СпособВыбора ТОГДА "Ручной" ИНАЧЕ "Автоматический" КОНЕЦ КАК СпособВыбора,
	ТаблицаСкидок.ДействуетОтСуммыНакопленияНаКарте,
	ВЫБОР КОГДА ТаблицаСкидок.ЭтоПодарок ТОГДА "Да" ИНАЧЕ "Нет" КОНЕЦ КАК ЭтоПодарок,
	ТаблицаСкидок.Свойство,
	ТаблицаСкидок.ЗначениеСкидки,
	ТаблицаСкидок.СпособВычисления,
	ВЫБОР КОГДА ТаблицаСкидок.ФлагВытеснения ТОГДА "Да" ИНАЧЕ "Нет" КОНЕЦ КАК ФлагВытеснения,
	ТаблицаСкидок.ВидПрайсЛистаПодарка,
	ТаблицаСкидок.МаксимальнаяСуммаПодарка,
	ТаблицаСкидок.ИдентификаторСкидки,
	ТаблицаСкидок.ПрименяемостьСкидки
	
	{ВЫБРАТЬ
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ЧасНачВремя КАК ЧасНачВремя,
	МинутаНачВремя КАК МинутаНачВремя,
	СекундаНачВремя КАК СекундаНачВремя,
	ЧасКонВремя КАК ЧасКонВремя,
	МинутаКонВремя КАК МинутаКонВремя,
	СекундаКонВремя КАК СекундаКонВремя,
	ДниНедели КАК ДниНедели,
	ОбъектНазначенияСкидки.* КАК ОбъектНазначенияСкидки,
	ДействуетОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	ДействуетОтКоличества КАК ДействуетОтКоличества,
	ПравилоРасчетаСкидкиПоКоличеству КАК ПравилоРасчетаСкидкиПоКоличеству,
	СпособВыбора КАК СпособВыбора,
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство,
	// Ресурсы
	ЗначениеСкидки КАК ЗначениеСкидки,
	СпособВычисления КАК СпособВычисления,
	ФлагВытеснения КАК ФлагВытеснения,
	ВидПрайсЛистаПодарка КАК ВидПрайсЛистаПодарка,
	МаксимальнаяСуммаПодарка КАК МаксимальнаяСуммаПодарка,
	ИдентификаторСкидки КАК ИдентификаторСкидки,
	ПрименяемостьСкидки}
	
ИЗ
	ТаблицаСкидок КАК ТаблицаСкидок
//@ТекстОтбора@

{УПОРЯДОЧИТЬ ПО
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ДниНедели КАК ДниНедели,
	ОбъектНазначенияСкидки.* КАК ОбъектНазначенияСкидки,
	ДействуетОтСуммыСтроки КАК ДействуетОтСуммыСтроки,
	ДействуетОтКоличества КАК ДействуетОтКоличества,
	ПравилоРасчетаСкидкиПоКоличеству КАК ПравилоРасчетаСкидкиПоКоличеству,
	СпособВыбора КАК СпособВыбора, // Способ установки
	ДействуетОтСуммыНакопленияНаКарте КАК ДействуетОтСуммыНакопленияНаКарте,
	ЭтоПодарок КАК ЭтоПодарок,
	Свойство КАК Свойство
}

{ИТОГИ ПО
	Подразделение.*,
	ЗалОбслуживания.*,
	ДисконтнаяКарта.*,
	Скидка.*,
	ОбъектНазначенияСкидки.*,
	ДниНедели.*
}

ИТОГИ 
	МАКСИМУМ(ЧасНачВремя),
	МАКСИМУМ(МинутаНачВремя),
	МАКСИМУМ(СекундаНачВремя),
	МАКСИМУМ(ЧасКонВремя),
	МАКСИМУМ(МинутаКонВремя),
	МАКСИМУМ(СекундаКонВремя)
ПО
	Подразделение,
	ЗалОбслуживания,
	ДисконтнаяКарта,
	Скидка,
	ОбъектНазначенияСкидки,
	ДниНедели