
&НаКлиенте
Процедура ПроизвестиРасчетПоказателей(Команда)
	
	ОткрытьФорму("Обработка.БТ_ВыборочныйРасчетПоказателей.Форма.Форма");
	//ПроизвестиРасчетПоказателейНаСервере(Ложь);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеЗакрытияВопроса(Результат, Параметры) Экспорт
	
	Если Результат = КодВозвратаДиалога.Отмена Тогда
		
		Возврат;
		
	КонецЕсли;
		
	ПроизвестиРасчетПоказателейНаСервере(Результат = КодВозвратаДиалога.Да);
	
КонецПроцедуры

&НаСервере
Процедура ПроизвестиРасчетПоказателейНаСервере(СНачалоГода = ложь, Показатель = Неопределено)
	УстановитьПривилегированныйРежим(Истина);
	ВремяНачала = ТекущаяУниверсальнаяДатаВМиллисекундах();
	//Если СНачалоГода Тогда
	//	
	//	ТекДата = НачалоГода(ТекущаяДата());
	//	
	//	Пока ТекДата <= ТекущаяДата() Цикл
	//		
	//		БТ_РасчетПоказателей.ПроизвестиРасчетПоказателей(ТекДата);
	//		ТекДата = ТекДата + 86400;
	//		
	//	КонецЦикла;
	//	
	//Иначе
	//	
	//	БТ_РасчетПоказателей.ПроизвестиРасчетПоказателей(,,Показатель, Ложь, Истина);
	//	
	//КонецЕсли;
	//
	//ВремяКонцаВыполнения = ТекущаяУниверсальнаяДатаВМиллисекундах();
	//ВремяВыполненияВМиллисекундах = ВремяКонцаВыполнения - ВремяНачала;
	//Сообщить("ВремяВыполненияВМиллисекундах: "+ВремяВыполненияВМиллисекундах);
	
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ДатаНачалаРаботыСистемы = РегистрыСведений.БТ_КонстантныеЗначения.ПолучитьЗначение("ДатаНачалаРасчетаПоказателей");
	
	Элементы.ФормаПроизвестиРасчетПоказателей.Видимость = не НРег(ПараметрыСеанса.Пользователь.Наименование) = Нрег("Шевченко Дмитрий");
	
КонецПроцедуры

&НаСервере
Процедура ДатаНачалаРаботыСистемыПриИзмененииНаСервере()
	
	РегистрыСведений.БТ_КонстантныеЗначения.ЗаписатьЗначение("ДатаНачалаРасчетаПоказателей",ДатаНачалаРаботыСистемы);
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаНачалаРаботыСистемыПриИзменении(Элемент)
	
	ДатаНачалаРаботыСистемыПриИзмененииНаСервере();
	
КонецПроцедуры

&НаКлиенте
Процедура РасчетатьПоПоказателю(Команда) 
	
	Если не Элементы.Список.ТекущиеДанные = Неопределено Тогда
		
		СтруктураПараметры = Новый Структура("Показатель", Элементы.Список.ТекущиеДанные.Ссылка);
		ОткрытьФорму("Обработка.БТ_ВыборочныйРасчетПоказателей.Форма.Форма", СтруктураПараметры);
		
		//ПроизвестиРасчетПоказателейНаСервере(,Элементы.Список.ТекущиеДанные.Ссылка);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ВыгрузитьПоказатели(Очистить, Показатели)
	
	
	Справочники.БТ_Показатели.ВыгрузитьПоказатели(Показатели, Очистить);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеВопросаООчисткеДанных(Результат, Параметры) Экспорт
	
	Если Результат = КодВозвратаДиалога.Отмена Тогда
		
        Возврат;
		
	КонецЕсли;   
	
	ВыгрузитьПоказатели(Результат = КодВозвратаДиалога.Да, Параметры.ВыбранныеПоказатели);

КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьПоказателиВСмежнуюБазу(Команда) 
	
	ОпОповещение = Новый ОписаниеОповещения("ПослеВопросаООчисткеДанных", ЭтотОбъект, новый Структура("ВыбранныеПоказатели", Элементы.Список.ВыделенныеСтроки));
	ПоказатьВопрос(ОпОповещение, "Очистить данные?", РежимДиалогаВопрос.ДаНетОтмена);
	
КонецПроцедуры
