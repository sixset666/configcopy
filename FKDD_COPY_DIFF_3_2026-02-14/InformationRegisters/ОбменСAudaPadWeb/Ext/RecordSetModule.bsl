Перем СерверОснование; // сервер auto pad web
Перем ОбщаяСтруктура Экспорт; // Структура автомобиля при загрузке калькуляций задания
Перем СодержаниеЗадания Экспорт; // xml-содержание полученного задания
Перем КэшКалькуляций Экспорт; // Кэш калькуляций
Перем СервисПрикреплений Экспорт; // Адрес веб-сервиса вложений
Перем ПроксиЗаданий Экспорт; // Прокси для работы с сервисом заданий
Перем ПроксиПрикреплений Экспорт; // Проксм для работы с сервисом прикреплений
Перем ДлинаНаименованияТовара; // Длина наименования номенклатуры
Перем ДлинаНаименованияРаботы; // Длина наименования автоработы
Перем флПоискАртикул Экспорт; // Поиск по артикулу
Перем флПоискНаименованиеПолное Экспорт; // Поиск по полному наименованию
Перем флСинхронизироватьНоменклатуру Экспорт; // Режим синхронизации запчастей
Перем флКонтрагентыТолькоИзГруппы Экспорт; // Правило поиска контрагентов
Перем флНеДобавлятьНоменклатуруПриСозданииАвторабот Экспорт; // отображение связанной номенклатуры в автоработе
Перем КодировкаФайлаПриложения Экспорт; // Кодировка в которой файл будет прикреплен на сайт
Перем НоменклатураДляРаботПоУмолчанию Экспорт; // номенклатура если не указываем связанную
Перем ВидРемонта Экспорт; // Вид ремонта для подставновки в документ
Перем ТипЦен Экспорт; // Тип цен для подставновки в документ
Перем ТипЦенРабот Экспорт; // Тип цен работ для подставновки в документ
Перем Цех Экспорт; // Цех для подставновки в документ
Перем ГруппаАвтомобили Экспорт; // Группа-родитель для загрузки автомобилей
Перем ГруппаАвторабот Экспорт; // Группа-родитель для загрузки авторабот
Перем ГруппаКонтрагентов Экспорт; // Группа-родитель для загрузки контрагентов
Перем ГруппаМодели Экспорт; // Группа-родитель для загрузки моделей
Перем ГруппаНоменклатуры Экспорт; // Группа-родитель для загрузки номенклатуры
Перем ПользовательАХ Экспорт; // Пользователь Audatex
Перем ПарольАХ Экспорт; // Пароль Audatex
Перем ПользовательПрокси Экспорт; // Пользователь прокси
Перем ПарольПрокси Экспорт; // Пароль прокси
Перем ИспользоватьТаблицуСоответствий Экспорт; // признак ипользования таблицы соответствия при загрузке номенклатуры и работ
Перем РежимЗагрузкиРабот Экспорт; // Режим загрузки таблицы работ(загружать, добавлять, не загружать)
Перем РежимЗагрузкиДеталей Экспорт; // Режим загрузки таблицы деталей(загружать, добавлять, не загружать)
Перем ОбновлятьШапкуДокумента Экспорт; // Обновлять шапку документа


//////////////////////////////////////////////////////////////
// ФУНКЦИОНАЛ AUDATEX

// Функция осуществляет проверку доступности сервиса заданий
//
Функция аудПроверкаПроксиЗаданий()
	Результат = "";
	
	Если ПроксиЗаданий = Неопределено Тогда
		ПроксиЗаданий = Обработки.ТранспортОбменаСAudaPadWeb.Создать();
		ПроксиЗаданий.Инициализировать(СерверОснование, "/b2b/services/TaskService_v1?wsdl", Истина);
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция осуществляет проверку доступности сервиса заданий
//
Функция аудПроверкаПроксиПрикреплений()
	Результат = "";
	
	Если ПроксиПрикреплений = Неопределено Тогда
		ПроксиПрикреплений = Обработки.ТранспортОбменаСAudaPadWeb.Создать();
		ПроксиПрикреплений.Инициализировать(СерверОснование, "/b2b/services/AttachmentService_v1?wsdl", Истина);
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция создает новое задание для AudaPad
//
Функция аудСоздатьЗадание(СодержаниеPayload, ИдентификаторДела, ИдентификаторЗадания, ЗаказНаряд) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("markForDownload", "true");
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("createTask", СтруктураПараметров, СодержаниеPayload) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("createTaskResponse") <> Неопределено Тогда
		
			Если ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.returnCode = "0" Тогда
				
				ИдентификаторДела = ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message.caseId;
				ИдентификаторЗадания = ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message.taskId;
				Возврат Результат;
			
			КонецЕсли;
			
			Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message) = Тип("ОбъектXDTO") Тогда
			
				Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message.text;
				
			ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message) = Тип("СписокXDTO") Тогда
				
				Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.createTaskResponse.message Цикл
					
					Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
					
				КонецЦикла;
				
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
	
КонецФункции

// Функция осуществляет попытку обращения к сервису дел AudaPad Web
//
Функция аудПроверитьСвязь() Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("ping", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("pingResponse") <> Неопределено И
			ПроксиЗаданий.ОтветСервераОбъект.Body.pingResponse.returnCode <> "0" Тогда
			
			Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.pingResponse.message) = Тип("ОбъектXDTO") Тогда
				Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.pingResponse.message.text;
			ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.pingResponse.message) = Тип("СписокXDTO") Тогда
				Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.pingResponse.message Цикл
					Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Процедура Обновления сервисов
//
Функция аудПолучитьСписокЗаданий(ДатаНачала, ДатаОкончания, СтатусДел, ТаблицаЗаданий) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("fromDate", XMLСтрока(Формат(ДатаНачала, "ДФ=""гггг-ММ-дд""")));
	СтруктураПараметров.Вставить("toDate", XMLСтрока(Формат(ДатаОкончания, "ДФ=""гггг-ММ-дд""")));
	СтруктураПараметров.Вставить("box", СтатусДел);
	СтруктураПараметров.Вставить("fieldsToReturn", ПоляСпискаЗаданий());
	
	//getTaskList
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("getTaskList", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("getTaskListResponse") <> Неопределено Тогда
			Если ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.returnCode = "0" Тогда
				ТекстСпискаЗаданий = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.payload;
				
				ТаблицаЗаданий.Очистить();
				ТаблицаЗаданий = зфЗащищенныеФункцииСервер.DOMРазборСпискаXML(ТекстСпискаЗаданий, ТаблицаЗаданий);
			ИначеЕсли ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.returnCode <> "0" Тогда
				
				Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message) = Тип("ОбъектXDTO") Тогда
					Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message.text;
				ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message) = Тип("СписокXDTO") Тогда
					Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message Цикл
						Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
					КонецЦикла;
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Процедура Обновления сервисов
//
Функция аудПолучитьСписокЗаданийПоИдДела(ИдДела, ТаблицаЗаданий) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("filterOnField", "CaseId");
	СтруктураПараметров.Вставить("filterValue", ИдДела);
	СтруктураПараметров.Вставить("fieldsToReturn", ПоляСпискаЗаданий());
	
	//getTaskList
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("getTaskList", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("getTaskListResponse") <> Неопределено Тогда
			Если ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.returnCode = "0" Тогда
				ТекстСпискаЗаданий = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.payload;
				
				ТаблицаЗаданий = зфЗащищенныеФункцииСервер.DOMРазборСпискаXML(ТекстСпискаЗаданий, ТаблицаЗаданий);
			ИначеЕсли ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.returnCode <> "0" Тогда
				
				Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message) = Тип("ОбъектXDTO") Тогда
					Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message.text;
				ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message) = Тип("СписокXDTO") Тогда
					Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskListResponse.message Цикл
						Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
					КонецЦикла;
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция осуществляет запрос данных задания
//
Функция аудПолучитьЗадание(Знач ИдентификаторЗадания, ЗаданиеТекст, ИдентификаторДела, СтрокаЗадания) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("taskId", ИдентификаторЗадания);
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("getTask", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("getTaskResponse") <> Неопределено Тогда
			Если ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.returnCode = "0" Тогда
				ЗаданиеТекст = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.payload;
				
				РазобратьСписокКалькуляций(ИдентификаторДела, ЗаданиеТекст, СтрокаЗадания);
			ИначеЕсли ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.returnCode <> "0" Тогда
				
				Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.message) = Тип("ОбъектXDTO") Тогда
					Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.message.text;
				ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.message) = Тип("СписокXDTO") Тогда
					Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.getTaskResponse.message Цикл
						Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
					КонецЦикла;
				КонецЕсли;
				
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция осуществляет закрытие задание по его идентификатору
//
Функция аудЗакрытьЗадание(Знач ИдентификаторЗадания) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("taskId", ИдентификаторЗадания);
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("closeTask", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("closeTaskResponse") <> Неопределено И
			ПроксиЗаданий.ОтветСервераОбъект.Body.closeTaskResponse.returnCode <> "0" Тогда
			
			Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.closeTaskResponse.message) = Тип("ОбъектXDTO") Тогда
				Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.closeTaskResponse.message.text;
			ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.closeTaskResponse.message) = Тип("СписокXDTO") Тогда
				Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.closeTaskResponse.message Цикл
					Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция осуществляет попытку обращения к сервису дел AudaPad Web
//
Функция аудПереназначитьДело(ПолучательДела, ИдЗадания) Экспорт
	Результат = аудПроверкаПроксиЗаданий();
	
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("transferFrom", "Login:" + ПользовательАХ);
	СтруктураПараметров.Вставить("transferTo", "Login:" + ПолучательДела);
	СтруктураПараметров.Вставить("taskId", ИдЗадания);
	СтруктураПараметров.Вставить("comment", "Task transfer service");
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("transferTask", СтруктураПараметров) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("transferTaskResponse") <> Неопределено И
			ПроксиЗаданий.ОтветСервераОбъект.Body.transferTaskResponse.returnCode <> "0" Тогда
			
			Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.transferTaskResponse.message) = Тип("ОбъектXDTO") Тогда
				Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.transferTaskResponse.message.text;
			ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.transferTaskResponse.message) = Тип("СписокXDTO") Тогда
				Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.transferTaskResponse.message Цикл
					Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция осуществляет прикрепление файла к заданию
//
Функция аудПрикрепитьФайл(ХМЛПрикрепления, Знач ИдентификаторЗадания) Экспорт
	Результат = аудПроверкаПроксиПрикреплений();
	
	Если НЕ ПустаяСтрока(Результат) Тогда
		Возврат Результат;
	КонецЕсли;
	
	СтруктураПараметров = Новый Структура();
	СтруктураПараметров.Вставить("loginId", ПользовательАХ);
	СтруктураПараметров.Вставить("password", ПарольАХ);
	СтруктураПараметров.Вставить("taskId", ИдентификаторЗадания);
	
	ПроксиЗаданий.УстановитьЗаголовкиПоУмолчанию();
	
	Если ПроксиЗаданий.ВыполнитьЗапрос("addAttachmentsToTask", СтруктураПараметров, ХМЛПрикрепления) Тогда
		Если ПроксиЗаданий.ОтветСервераОбъект.Body.Свойства().Получить("addAttachmentsToTaskResponse") <> Неопределено И
			ПроксиЗаданий.ОтветСервераОбъект.Body.addAttachmentsToTaskResponse.returnCode <> "0" Тогда
			
			Если ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.addAttachmentsToTaskResponse.message) = Тип("ОбъектXDTO") Тогда
				Результат = ПроксиЗаданий.ОтветСервераОбъект.Body.addAttachmentsToTaskResponse.message.text;
			ИначеЕсли ТипЗнч(ПроксиЗаданий.ОтветСервераОбъект.Body.addAttachmentsToTaskResponse.message) = Тип("СписокXDTO") Тогда
				Для Каждого Сообщение Из ПроксиЗаданий.ОтветСервераОбъект.Body.addAttachmentsToTaskResponse.message Цикл
					Результат = Результат + ?(ПустаяСтрока(Результат), "", Символы.ПС) + Сообщение.text;
				КонецЦикла;
			КонецЕсли;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

Функция ПоляСпискаЗаданий()
	
	Возврат "TaskId,CaseId,ClaimNumber,PlateNumber,Creator,TaskStatus,ManufacturerName,ModelName,VehicleOwnerName,VehicleOwnerFirstName,VehicleOwnerLastName,CreationDate,PolicyNumber,LastEditedDateTime,DisplayName,TaskProgress,PolicyHolderLastName,ClaimantLastName,VIN";
	
КонецФункции


////////////////////////////////////////////////////////////////
// РАБОТА С XML

// Разбор структуры для получения калькуляции
//
Функция РазобратьСписокКалькуляций(Знач ИдЗадания, Знач СтрокаВозврата, СтрокаЗадания) Экспорт
	
	КэшКалькуляций.Очистить();
	ЗаписьХМЛ = Новый ЧтениеXML();
	
	Попытка
		ЗаписьХМЛ.УстановитьСтроку(СтрокаВозврата);
	Исключение Возврат Неопределено; КонецПопытки;
	
	ПоследовательностьЭлементов = "";
	
	Пока Истина Цикл
		
		ОчереднойУзелПрочитан = Ложь;
		
		Попытка
			
			ОчереднойУзелПрочитан = ЗаписьХМЛ.Прочитать();
			
		Исключение
			
			Прервать;
			
		КонецПопытки;
		
		Если НЕ ОчереднойУзелПрочитан Тогда
			
			Прервать;
			
		КонецЕсли;
		
		ТипУзла = ЗаписьХМЛ.ТипУзла;
		ИмяУзла = ЗаписьХМЛ.Имя;
		
		Если ТипУзла = ТипУзлаXML.НачалоЭлемента Тогда
			
			ПоследовательностьЭлементов = ДобавитьЭлементКПоследовательности(
					ПоследовательностьЭлементов,
					ИмяУзла
				);
			Успешно = ОбработатьНачалоЭлемента(ЗаписьХМЛ, ПоследовательностьЭлементов, СтрокаЗадания);
			
			Если НЕ Успешно Тогда
				
				Прервать;
				
			КонецЕсли;
			
		ИначеЕсли ТипУзла = ТипУзлаXML.КонецЭлемента Тогда
			
			Если ПоследовательностьЭлементов = ПутьКРаботамПоПодготовкеОкраски() Тогда
				
				ПеренестиРаботыПоПодготовкеКОстальным();
				
			КонецЕсли;
			
			ПоследовательностьЭлементов = УдалитьПоследнийЭлементИзПоследовательности(ПоследовательностьЭлементов);
			
		ИначеЕсли ТипУзла = ТипУзлаXML.Текст Тогда
			
			ЗначениеЭлемента = ЗаписьХМЛ.Значение;
			Успешно = ОбработатьЗначениеЭлемента(ПоследовательностьЭлементов, ЗначениеЭлемента, СтрокаЗадания);
			
			Если НЕ Успешно Тогда
				Прервать;
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЦикла;
	
	ЗаписьХМЛ.Закрыть();
	Возврат КэшКалькуляций;
	
КонецФункции

// Функция формирует путь текущего узла ХМЛ
//
Функция ДобавитьЭлементКПоследовательности(Знач ПоследовательностьЭлементов, Знач ИмяУзла)
	
	Если НЕ ПоследовательностьЭлементов = "" Тогда
		ПоследовательностьЭлементов = ПоследовательностьЭлементов + ".";
	КонецЕсли;
	ПоследовательностьЭлементов = ПоследовательностьЭлементов + ИмяУзла;
	
	Возврат ПоследовательностьЭлементов;
	
КонецФункции

// Функция убирает последнюю ветку в структуре пути узла
//
Функция УдалитьПоследнийЭлементИзПоследовательности(Знач ПоследовательностьЭлементов)
	
	ПромСтрока = СтрЗаменить(ПоследовательностьЭлементов, ".", Символы.ПС);
	КоличествоЭлементов = СтрЧислоСтрок(ПромСтрока);
	
	ПоследовательностьЭлементов = "";
	Если КоличествоЭлементов > 0 Тогда
		КоличествоЭлементов = КоличествоЭлементов - 1;
		Для Счетчик = 1 По КоличествоЭлементов Цикл
			ПоследовательностьЭлементов = ПоследовательностьЭлементов + "." + СтрПолучитьСтроку(ПромСтрока, Счетчик);
		КонецЦикла;
		ПоследовательностьЭлементов = Прав(ПоследовательностьЭлементов, СтрДлина(ПоследовательностьЭлементов) - 1);
	КонецЕсли;
	
	Возврат ПоследовательностьЭлементов;
КонецФункции

// Функция обрабатывает начало узла ХМЛ
//
Функция ОбработатьНачалоЭлемента(ЗаписьХМЛ, ИмяЭлемента, СтрокаЗадания);
	
	Успешно = Истина;
	КорневойПуть = "Task.CalculationList.CLASSCalculation.CLASSResult.CLASSXml";
	
	// Текущая строка шапки
	ВсегоКалькуляций = КэшКалькуляций.Количество();
	Если ВсегоКалькуляций > 0 Тогда
		ТекСтрока = КэшКалькуляций[ВсегоКалькуляций - 1];
	Иначе
		ТекСтрока = Неопределено;
	КонецЕсли;
	
	// Текущая строка товаров
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.Товары) = Тип("ТаблицаЗначений") И
		ТекСтрока.Товары.Количество() > 0 Тогда
		ВсегоТоваров = ТекСтрока.Товары.Количество();
		СтрокаТовара = ТекСтрока.Товары[ВсегоТоваров - 1];
	Иначе
		СтрокаТовара = Неопределено;
	КонецЕсли;
	
	// Текущая строка работ
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.Работы) = Тип("ТаблицаЗначений") И
		ТекСтрока.Работы.Количество() > 0 Тогда
		ВсегоРабот = ТекСтрока.Работы.Количество();
		СтрокаРаботы = ТекСтрока.Работы[ВсегоРабот - 1];
	Иначе
		СтрокаРаботы = Неопределено;
	КонецЕсли;
	
	// Текущая строка параметров окраски
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.ПараметрыОкраски) = Тип("ТаблицаЗначений") И
		ТекСтрока.ПараметрыОкраски.Количество() > 0 Тогда
		ВсегоПараметровОкраски = ТекСтрока.ПараметрыОкраски.Количество();
		СтрокаПараметровОкраски = ТекСтрока.ПараметрыОкраски[ВсегоПараметровОкраски - 1];
	Иначе
		СтрокаПараметровОкраски = Неопределено;
	КонецЕсли;
	
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.ДопКоды) = Тип("ТаблицаЗначений") И
		ТекСтрока.ДопКоды.Количество() > 0 Тогда
		ВсегоДопКодов = ТекСтрока.ДопКоды.Количество();
		СтрокаДопКодов = ТекСтрока.ДопКоды[ВсегоДопКодов - 1];
	Иначе
		СтрокаДопКодов = Неопределено;
	КонецЕсли;
	
	// При начале разбора xml очистим структуру автомобиля
	Если ИмяЭлемента = "Task" Тогда
		ОбщаяСтруктура.Очистить();
		
		// Необходимо заполнить структуру автомобиля
	ИначеЕсли ИмяЭлемента = КорневойПуть Тогда
		
		// Заполним структуру автомобиля в шапке
		Для Каждого СтрокаСтруктуры Из ОбщаяСтруктура Цикл
			ТекСтрока.Шапка.Вставить(СтрокаСтруктуры.Ключ, СтрокаСтруктуры.Значение);
		КонецЦикла;
		
	ИначеЕсли ИмяЭлемента = "Task.CalculationList.CLASSCalculation" Тогда // описание шапки
		
		ТекСтрока = КэшКалькуляций.Добавить();
		
		Если ТипЗнч(ТекСтрока.Шапка) <> Тип("Соответствие") Тогда
			ТекСтрока.Шапка = Новый Соответствие();
		КонецЕсли;
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.CalcDat" Тогда
		
		// Количество рабочих позиций (РП) в часе
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.TimeBase" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Val" Тогда
				ТекСтрока.Шапка.Вставить("РПВЧас", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
			ИначеЕсли ЗаписьХМЛ.Имя = "Unit" Тогда
				ТекСтрока.Шапка.Вставить("РПВЧас_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
			КонецЕсли;
		КонецЦикла;
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.RunDesc" Тогда
		
		// Тип калькуляции
		ЗаписьХМЛ.Прочитать();
		
		Если ЗаписьХМЛ.Значение = "GlassCalculation" Тогда
			
			Пока ЗаписьХМЛ.ТипУзла <> ТипУзлаXML.КонецЭлемента ИЛИ ЗаписьХМЛ.Имя <> "CalcData" Цикл
				
				ЗаписьХМЛ.Прочитать();
				
			КонецЦикла;
			
			ИмяЭлемента = УдалитьПоследнийЭлементИзПоследовательности(ИмяЭлемента);
			
		КонецЕсли;
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.GrandTotal.Tot" Тогда
		//ТекСтрока.Шапка.Вставить("Итого");
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				ТекСтрока.Шапка.Вставить("ВалютаИтого", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
			КонецЕсли;
		КонецЦикла;
		// Наценка на детали
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FCPart.FCSundry.PCofParts.PCofPart.PC" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Val" Тогда
				ТекСтрока.Шапка.Вставить("НаценкаНаДетали", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
			ИначеЕсли ЗаписьХМЛ.Имя = "Unit" Тогда
				ТекСтрока.Шапка.Вставить("НаценкаНаДетали_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
			КонецЕсли;
		КонецЦикла;
		
		// Стоимость нормо-часа кузовных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FCLabor.LaborRates.LaborResults.Rate" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				ТекСтрока.Шапка.Вставить("НормочасРабот_Валюта", ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты"));
			ИначеЕсли ЗаписьХМЛ.Имя = "Unit" Тогда
				ТекСтрока.Шапка.Вставить("НормочасРабот_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
			КонецЕсли;
		КонецЦикла;
		
		// Стоимость нормо-часа окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FCPaint.LaborRates.LaborResults.Rate" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				ТекСтрока.Шапка.Вставить("НормочасОкраски_Валюта", ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты"));
			ИначеЕсли ЗаписьХМЛ.Имя = "Unit" Тогда
				ТекСтрока.Шапка.Вставить("НормочасОкраски_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
			КонецЕсли;
		КонецЦикла;
		
		// Курс исходной валюты
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.CurDtl.ExChgDtl.ExChgRate.Rate" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Val" Тогда
				ЗначениеВалюты = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
				Если ЗначениеВалюты = Неопределено ИЛИ ЗначениеВалюты = "" Тогда
					ЗначениеВалюты = 0;
				КонецЕсли;
				ТекСтрока.Шапка.Вставить("КурсИсходнойВалюты", ЗначениеВалюты);
			КонецЕсли;
		КонецЦикла;
		
		// Список товаров
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls" Тогда
		Если ТипЗнч(ТекСтрока.Товары) <> Тип("ТаблицаЗначений")
			ИЛИ ТекСтрока.Товары.Количество() = 0 Тогда
			ТекСтрока.Товары = Новый ТаблицаЗначений();
			ТекСтрока.Товары.Колонки.Добавить("ТипРемонта");
			ТекСтрока.Товары.Колонки.Добавить("КодДетали");
			ТекСтрока.Товары.Колонки.Добавить("НаименованиеДетали", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(200)));
			ТекСтрока.Товары.Колонки.Добавить("НомерДетали", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(50)));
			ТекСтрока.Товары.Колонки.Добавить("СтоимостьДетали");
			ТекСтрока.Товары.Колонки.Добавить("ЦенаРубли");
			ТекСтрока.Товары.Колонки.Добавить("ЦенаЕвро");
			ТекСтрока.Товары.Колонки.Добавить("Источник");
			ТекСтрока.Товары.Колонки.Добавить("КоличествоДеталей");
		КонецЕсли;
		// список доп кодов
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.CalcControl.ActivIDBlks" Тогда
		Если ТипЗнч(ТекСтрока.ДопКоды) <> Тип("ТаблицаЗначений") ИЛИ ТекСтрока.ДопКоды.Колонки.Количество() = 0 Тогда
			ТекСтрока.ДопКоды = Новый ТаблицаЗначений();
			ТекСтрока.ДопКоды.Колонки.Добавить("Код");
			ТекСтрока.ДопКоды.Колонки.Добавить("Ссылка");
			ТекСтрока.ДопКоды.Колонки.Добавить("Значение");
			ТекСтрока.ДопКоды.Колонки.Добавить("Источник");
			ТекСтрока.ДопКоды.Колонки.Добавить("Сумма");
			ТекСтрока.ДопКоды.Колонки.Добавить("СпособРаспределения");
		КонецЕсли;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PartDtl
		
		// Количество деталей
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl" Тогда
		ТекСтрока.Товары.Добавить();
		
		// Тип ремонтного воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.Qty" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаТовара["КоличествоДеталей"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Список работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor" Тогда
		Если ТипЗнч(ТекСтрока.Работы) <> Тип("ТаблицаЗначений")
			ИЛИ ТекСтрока.Работы.Количество() = 0 Тогда
			ТекСтрока.Работы = Новый ТаблицаЗначений();
			ТекСтрока.Работы.Колонки.Добавить("ТипРемонта");
			ТекСтрока.Работы.Колонки.Добавить("КодДетали");
			ТекСтрока.Работы.Колонки.Добавить("НомерРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(50)));
			ТекСтрока.Работы.Колонки.Добавить("НаименованиеРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
			ТекСтрока.Работы.Колонки.Добавить("НаименованиеДетали", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(200)));
			ТекСтрока.Работы.Колонки.Добавить("СтоимостьРабот");
			ТекСтрока.Работы.Колонки.Добавить("СтоимостьРабот_Валюта");
			ТекСтрока.Работы.Колонки.Добавить("ЦенаРубли");
			ТекСтрока.Работы.Колонки.Добавить("ЦенаЕвро");
			ТекСтрока.Работы.Колонки.Добавить("КоличествоРП");
			ТекСтрока.Работы.Колонки.Добавить("КоличествоРП_Измерение");
			ТекСтрока.Работы.Колонки.Добавить("Время");
			ТекСтрока.Работы.Колонки.Добавить("Время_Измерение");
			ТекСтрока.Работы.Колонки.Добавить("Источник");
			ТекСтрока.Работы.Колонки.Добавить("ОписаниеРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(200)));
		КонецЕсли;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PartComposit
		
		// Строка работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit" Тогда
		ТекСтрока.Работы.Добавить();
		
		// Валюта стоимости работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.Price" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
		
		// Единица измерения количества рабочих позиций в работе
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.WuNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["КоличествоРП_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Измерение времени работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.HrNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["Время_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["Время"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								NetLabor
		
		// Строка ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor" Тогда
		ТекСтрока.Работы.Добавить();
		
		// Измерение количество РП ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.WuNet" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["КоличествоРП_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Измерение времени ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.WuNetHrNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["Время_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["Время"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Валюта стоимости работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.Price" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								VDtl
		
		// Строка работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl" Тогда
		ТекСтрока.Работы.Добавить();
		
		// Измерение количество РП ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.WuNet" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.WuNet" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.WuNet" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.WuNet" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.WuNet" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.WuNet" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["КоличествоРП_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Измерение времени ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.WuNetHrNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.WuNetHrNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.WuNetHrNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.WuNetHrNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.WuNetHrNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.WuNetHrNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["Время_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["Время"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Валюта стоимости работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.Price" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PaintHeader
		
		// Параметры окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint" Тогда
		Если ТипЗнч(ТекСтрока.ПараметрыОкраски) <> Тип("ТаблицаЗначений")
			ИЛИ ТекСтрока.ПараметрыОкраски.Количество() = 0 Тогда
			ТекСтрока.ПараметрыОкраски = Новый ТаблицаЗначений();
			ТекСтрока.ПараметрыОкраски.Колонки.Добавить("ТипОкраски");
			ТекСтрока.ПараметрыОкраски.Колонки.Добавить("КодТипаОкраски");
			ТекСтрока.ПараметрыОкраски.Колонки.Добавить("НаименованиеТипаОкраски");
			ТекСтрока.ПараметрыОкраски.Колонки.Добавить("ТипОкраскиСистема");
			ТекСтрока.ПараметрыОкраски.Колонки.Добавить("КоличествоРП");
		КонецЕсли;
		
		Если ТипЗнч(ТекСтрока.Работы) <> Тип("ТаблицаЗначений")
			ИЛИ ТекСтрока.Работы.Количество() = 0 Тогда
			ТекСтрока.Работы = Новый ТаблицаЗначений();
			ТекСтрока.Работы.Колонки.Добавить("ТипРемонта");
			ТекСтрока.Работы.Колонки.Добавить("КодДетали");
			ТекСтрока.Работы.Колонки.Добавить("НомерРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(50)));
			ТекСтрока.Работы.Колонки.Добавить("НаименованиеРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(100)));
			ТекСтрока.Работы.Колонки.Добавить("НаименованиеДетали", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(200)));
			ТекСтрока.Работы.Колонки.Добавить("СтоимостьРабот");
			ТекСтрока.Работы.Колонки.Добавить("СтоимостьРабот_Валюта");
			ТекСтрока.Работы.Колонки.Добавить("ЦенаРубли");
			ТекСтрока.Работы.Колонки.Добавить("ЦенаЕвро");
			ТекСтрока.Работы.Колонки.Добавить("КоличествоРП");
			ТекСтрока.Работы.Колонки.Добавить("КоличествоРП_Измерение");
			ТекСтрока.Работы.Колонки.Добавить("Время");
			ТекСтрока.Работы.Колонки.Добавить("Время_Измерение");
			ТекСтрока.Работы.Колонки.Добавить("Источник");
			ТекСтрока.Работы.Колонки.Добавить("ОписаниеРаботы", Новый ОписаниеТипов("Строка", , Новый КвалификаторыСтроки(200)));
		КонецЕсли;
		
		// Строка параметров окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader" Тогда
		ТекСтрока.ПараметрыОкраски.Добавить();
		
	///////////////////////////////////////////////////////////////////////////////////////////
	// PntPrep
		
	// Строка подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep" Тогда
		
		Если СтрокаПараметровОкраски.ТипОкраски = "AZT" Тогда
			
			ТекСтрока.ПодготовительныеРаботыПоОкраске = Новый Структура(
				"ОкраскаМетала,ОкраскаПластика,СмешиваниеКраски,ВыкрасОбразцаЦвета",
				Новый Структура,
				Новый Структура,
				Новый Структура,
				Новый Структура
			);
			
		Иначе
			
			ТекСтрока.Работы.Добавить()["Источник"] = "PaintPreparations";
			
		КонецЕсли;
		
	///////////////////////////////////////////////////////////////////////////////////////////
	// PntPrep.MF
	
	// Валюта стоимости работы
	ИначеЕсли ИмяЭлемента=КорневойПуть+".CalcData.Paint.PaintPreparations.PntPrep.Price" Тогда

		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
				
			КонецЕсли;
			
		КонецЦикла;
		
	///////////////////////////////////////////////////////////////////////////////////////////
	// PntPrep.ОкраскаМетала
	
	// Количество РП подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.WuNo" Тогда
		
		Если НЕ ЗначениеЗаполнено(ТекСтрока.ПодготовительныеРаботыПоОкраске) Тогда
			
			Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
				
				Если ЗаписьХМЛ.Имя = "Unit" Тогда
					
					СтрокаРаботы["КоличествоРП_Измерение"]	=  ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
					
				ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
					
					СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
					
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе
			
			ОкраскаМетала = Неопределено;
			ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаМетала", ОкраскаМетала);
			
			Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
				
				Если ЗаписьХМЛ.Имя = "Unit" Тогда
					
					ОкраскаМетала.Вставить("КоличествоРП_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
					
				ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
					
					ОкраскаМетала.Вставить("КоличествоРП", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
					
				КонецЕсли;
				
			КонецЦикла;
			
		КонецЕсли;
		
	// Время подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.HrNo" Тогда
		
		Если НЕ ЗначениеЗаполнено(ТекСтрока.ПодготовительныеРаботыПоОкраске) Тогда
			
			Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
				
				Если ЗаписьХМЛ.Имя = "Unit" Тогда
					
					СтрокаРаботы["Время_Измерение"]	=  ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
					
				ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
					
					СтрокаРаботы["Время"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
					
				КонецЕсли;
				
			КонецЦикла;
			
		Иначе
			
			ОкраскаМетала = Неопределено;
			ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаМетала", ОкраскаМетала);
			
			Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
				
				Если ЗаписьХМЛ.Имя = "Unit" Тогда
					
					ОкраскаМетала.Вставить("Время_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
					
				ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
					
					ОкраскаМетала.Вставить("Время", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
					
				КонецЕсли;
				
			КонецЦикла;
			
		КонецЕсли;
		
	// Валюта стоимости
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.Amnt" Тогда
		
		ОкраскаМетала = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаМетала", ОкраскаМетала);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				ОкраскаМетала.Вставить(
					"СтоимостьРабот_Валюта",
					ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты")
				);
				
			КонецЕсли;
			
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		// PntPrep.ОкраскаПластика
		
		// Количество РП подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.PlasticWuNo" Тогда
		
		ОкраскаПластика = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаПластика", ОкраскаПластика);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				ОкраскаПластика.Вставить("КоличествоРП_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				ОкраскаПластика.Вставить("КоличествоРП", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Время подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.PlasticHrNo" Тогда
		
		ОкраскаПластика = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаПластика", ОкраскаПластика);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				ОкраскаПластика.Вставить("Время_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				ОкраскаПластика.Вставить("Время", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Валюта стоимости
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.PlasticAmnt" Тогда
		
		ОкраскаПластика = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаПластика", ОкраскаПластика);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				ОкраскаПластика.Вставить(
					"СтоимостьРабот_Валюта",
					ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты")
				);
				
			КонецЕсли;
			
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		// PntPrep.СмешиваниеКраски
		
		// Количество РП подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColMixingWuNo" Тогда
		
		СмешиваниеКраски = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("СмешиваниеКраски", СмешиваниеКраски);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				СмешиваниеКраски.Вставить("КоличествоРП_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				СмешиваниеКраски.Вставить("КоличествоРП", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Время подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColMixingHrNo" Тогда
		
		СмешиваниеКраски = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("СмешиваниеКраски", СмешиваниеКраски);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				СмешиваниеКраски.Вставить("Время_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				СмешиваниеКраски.Вставить("Время", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Валюта стоимости
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColMixingAmnt" Тогда
		
		СмешиваниеКраски = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("СмешиваниеКраски", СмешиваниеКраски);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				
				СмешиваниеКраски.Вставить(
					"СтоимостьРабот_Валюта",
					ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты")
				);
				
			КонецЕсли;
			
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		// PntPrep.ВыкрасОбразцаЦвета
		
		// Количество РП подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColSampleWuNo" Тогда
		
		ВыкрасОбразцаЦвета = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ВыкрасОбразцаЦвета", ВыкрасОбразцаЦвета);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				ВыкрасОбразцаЦвета.Вставить("КоличествоРП_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				ВыкрасОбразцаЦвета.Вставить("КоличествоРП", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Время подготовки к окраске
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColSampleHrNo" Тогда
		
		ВыкрасОбразцаЦвета = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ВыкрасОбразцаЦвета", ВыкрасОбразцаЦвета);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				
				ВыкрасОбразцаЦвета.Вставить("Время_Измерение", ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка"));
				
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				
				ВыкрасОбразцаЦвета.Вставить("Время", ПривестиЗначение(ЗаписьХМЛ.Значение, "Число"));
				
			КонецЕсли;
			
		КонецЦикла;
		
		// Валюта стоимости
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColSampleAmnt" Тогда
		
		ВыкрасОбразцаЦвета = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ВыкрасОбразцаЦвета", ВыкрасОбразцаЦвета);
		
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				
				ВыкрасОбразцаЦвета.Вставить(
					"СтоимостьРабот_Валюта",
					ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты")
				);
				
			КонецЕсли;
			
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PaintDtl
		
		// Строка окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl" Тогда
		ТекСтрока.Работы.Добавить();
		
		// Количество РП окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.WuNo" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.WuNoFix" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["КоличествоРП_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Валюта стоимости окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.Lbr" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.LbrFix" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.AdjacentDeduGrpTot.Lbr" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.AdjacentDeduGrpTot.LbrFix" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PaintTotMat
		
		// Строка надбавки окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE1"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE2"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE3"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE4"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LLev2"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LILev3"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Amnt"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Plastic"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatIdx" Тогда
		
			ТекСтрока.Работы.Добавить();
		
		// Валюта стоимости строки надбавки окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE1.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE2.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE3.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE4.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LLev2.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LILev3.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Amnt"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Plastic"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatIdx.Amn" Тогда
		
			Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
				Если ЗаписьХМЛ.Имя = "Cur" Тогда
					СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
				КонецЕсли;
			КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								MfcPCChg
		
		// Строка надбавки окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.MfcPCChgs.MfcPCChg" Тогда
		ТекСтрока.Работы.Добавить();
		
		// Количество РП строки надбавки окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.MfcPCChgs.MfcPCChg.WuNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				СтрокаРаботы["КоличествоРП_Измерение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаРаботы["КоличествоРП"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Валюта стоимости строки надбавки окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.MfcPCChgs.MfcPCChg.Lbr" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								ExtraItem/RiskDetail
		
		// Строка дополнительных воздействий
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail" Тогда
		ТекСтрока.Работы.Добавить();
		
		
		// Количество РП воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.WuNo"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.WuNo" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Unit" Тогда
				//СтрокаРаботы["Время_Измерение"]	= ПривестиЗначение(ЗаписьХМЛ.Значение, "Строка");
			ИначеЕсли ЗаписьХМЛ.Имя = "Val" Тогда
				//СтрокаРаботы["Время"]		= ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
		
		// Стоимость дополнительных воздействий
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.Amnt"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.Amnt" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Cur" Тогда
				СтрокаРаботы["СтоимостьРабот_Валюта"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "СправочникСсылка.Валюты");
			КонецЕсли;
		КонецЦикла;
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.CalcControl.ActivIDBlks.IDBlkDtl" Тогда
		ТекСтрока.ДопКоды.Добавить();
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.CalcControl.ActivIDBlks.IDBlkDtl.Val" Тогда
		Пока ЗаписьХМЛ.ПрочитатьАтрибут() Цикл
			Если ЗаписьХМЛ.Имя = "Val" Тогда
				СтрокаДопКодов["Значение"] = ПривестиЗначение(ЗаписьХМЛ.Значение, "Число");
			КонецЕсли;
		КонецЦикла;
	КонецЕсли;
	
	Возврат Успешно;
КонецФункции

// Функция обрабатывает значение узла ХМЛ
//
Функция ОбработатьЗначениеЭлемента(Знач ИмяЭлемента, Знач ЗначениеЭлемента, СтрокаЗадания)
	
	Успешно = Истина;
	КорневойПуть = "Task.CalculationList.CLASSCalculation.CLASSResult.CLASSXml";
	
	// Текущая строка шапки
	ВсегоКалькуляций = КэшКалькуляций.Количество();
	Если ВсегоКалькуляций > 0 Тогда
		ТекСтрока = КэшКалькуляций[ВсегоКалькуляций - 1];
	Иначе
		ТекСтрока = Неопределено;
	КонецЕсли;
	
	// Текущая строка товаров
	Если
		ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.Товары) = Тип("ТаблицаЗначений")
		И ТекСтрока.Товары.Количество() > 0
		Тогда
		
		ВсегоТоваров = ТекСтрока.Товары.Количество();
		СтрокаТовара = ТекСтрока.Товары[ВсегоТоваров - 1];
		
	Иначе
		
		СтрокаТовара = Неопределено;
		
	КонецЕсли;
	
	// Текущая строка работ
	Если
		ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.Работы) = Тип("ТаблицаЗначений")
		И ТекСтрока.Работы.Количество() > 0
		Тогда
		
		ВсегоРабот = ТекСтрока.Работы.Количество();
		СтрокаРаботы = ТекСтрока.Работы[ВсегоРабот - 1];
		
	Иначе
		
		СтрокаРаботы = Неопределено;
		
	КонецЕсли;
	
	// Текущая строка параметров окраски
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.ПараметрыОкраски) = Тип("ТаблицаЗначений") И
		ТекСтрока.ПараметрыОкраски.Количество() > 0 Тогда
		ВсегоПараметровОкраски = ТекСтрока.ПараметрыОкраски.Количество();
		СтрокаПараметровОкраски = ТекСтрока.ПараметрыОкраски[ВсегоПараметровОкраски - 1];
	Иначе
		СтрокаПараметровОкраски = Неопределено;
	КонецЕсли;
	
	Если ТекСтрока <> Неопределено И ТипЗнч(ТекСтрока.ДопКоды) = Тип("ТаблицаЗначений") И
		ТекСтрока.ДопКоды.Количество() > 0 Тогда
		ВсегоДопКодов = ТекСтрока.ДопКоды.Количество();
		СтрокаДопКодов = ТекСтрока.ДопКоды[ВсегоДопКодов - 1];
	Иначе
		СтрокаДопКодов = Неопределено;
	КонецЕсли;
	
	///////////////////////////////////////////////////////////////////////////////////////////
	//								VehicleIdentification
	
	// Идентификатор автомобиля
	Если ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleIdentification.ItemId" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Идентификатор", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// VIN автомобиля
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleIdentification.VIN" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_VIN", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Наименование производителя автомобиля
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleIdentification.ManufacturerName" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Производитель", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Модель автомобиля
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleIdentification.ModelName" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Модель", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Наименование подмодели автомобиля
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleIdentification.SubModelName" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Подмодель", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Гос. номер
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleAdmin.PlateNumber" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Номер", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Дата выпуска
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleAdmin.BuildDate" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_ДатаВыпуска", ПривестиЗначение(ЗначениеЭлемента, "Дата"));
		
		// Имя владельца
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleAdmin.VehicleOwner.FirstName" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_ИмяВладельца", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Фамилия владельца
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleAdmin.VehicleOwner.LastName" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_ФамилияВладельца", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Пробег
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleEngineering.Mileage" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Пробег", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		// Измерение пробега автомобиля
	ИначеЕсли ИмяЭлемента = "Task.BasicClaimData.Vehicle.VehicleEngineering.MileageUnit" Тогда
		ОбщаяСтруктура.Вставить("Автомобиль_Пробег_Измерение", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Идентификатор калькуляции
	ИначеЕсли ИмяЭлемента = "Task.CalculationList.CLASSCalculation.CalculationId" Тогда
		
		ТекСтрока.ИдКалькуляции = ЗначениеЭлемента;
		
		Если СтрокаЗадания <> Неопределено Тогда
			Фамилия = ?(СтрокаЗадания.ФамилияВладельца = Неопределено, "", СокрЛП(СтрокаЗадания.ФамилияВладельца));
			Имя = ?(СтрокаЗадания.ИмяВладельца = Неопределено, "", СокрЛП(СтрокаЗадания.ИмяВладельца));
			
			Если обЗначениеНеЗаполнено(Фамилия) И ОбщаяСтруктура.Свойство("Автомобиль_ФамилияВладельца") И
				НЕ обЗначениеНеЗаполнено(ОбщаяСтруктура["Автомобиль_ФамилияВладельца"]) Тогда
				Фамилия = ОбщаяСтруктура["Автомобиль_ФамилияВладельца"];
			КонецЕсли;
			
			Если обЗначениеНеЗаполнено(Имя) И ОбщаяСтруктура.Свойство("Автомобиль_ИмяВладельца") И
				НЕ обЗначениеНеЗаполнено(ОбщаяСтруктура["Автомобиль_ИмяВладельца"]) Тогда
				Имя = ОбщаяСтруктура["Автомобиль_ИмяВладельца"];
			КонецЕсли;
			
			ТекСтрока.Шапка.вставить("ФамилияВладельца", Фамилия);
			ТекСтрока.Шапка.вставить("ИмяВладельца", Имя);
			ТекСтрока.Шапка.вставить("ГосНомер", СтрокаЗадания.ГосНомер);
		КонецЕсли;
		
	ИначеЕсли ИмяЭлемента = "Task.CalculationList.CLASSCalculation.CaseId" Тогда
		ТекСтрока.ИдДела = ЗначениеЭлемента;
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								CalcIdent
		
		// Номер калькуляции
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcIdent.CalcNo" Тогда
		ТекСтрока.НомерДела = ЗначениеЭлемента;
		
		// Идентификатор дела
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcIdent.CaseId" Тогда
		ТекСтрока.ИдДела = ЗначениеЭлемента;
		
		// Дата калькуляции
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcIdent.SystemDat" Тогда
		ТекСтрока.ДатаКалькуляции = ПривестиЗначение(ЗначениеЭлемента, "Дата");
		
		// Дата и время калькуляции
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcIdent.TimeStamp" Тогда
		Если обЗначениеНеЗаполнено(ТекСтрока.ДатаКалькуляции) Тогда
			ТекДата = Формат(Дата(1900, 1, 1), "ДФ=yyyy-MM-dd") + " " + ЗначениеЭлемента;
		Иначе
			ТекДата = Формат(ТекСтрока.ДатаКалькуляции, "ДФ=yyyy-MM-dd") + " " + ЗначениеЭлемента;
		КонецЕсли;
		ТекСтрока.ДатаКалькуляции = ПривестиЗначение(ТекДата, "Дата");
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								CalcParam
		
		// Дата цен
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.PPPriceDat" Тогда
		ТекСтрока.Шапка.Вставить("ДатаЦен", ПривестиЗначение(ЗначениеЭлемента, "Дата"));
		
		// Валюта калькуляции
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.CurDtl.ISO" Тогда
		ТекСтрока.Шапка.Вставить("ВалютаКалькуляции", ПривестиЗначение(ЗначениеЭлемента, "СправочникСсылка.Валюты"));
		ТекСтрока.Шапка.Вставить("ВалютаКалькуляцииСтрока", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
		// Исходная валюта цен
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.CurDtl.ExChgDtl.From.ISO" Тогда
		ТекСтрока.Шапка.Вставить("ВалютаИсходная", ПривестиЗначение(ЗначениеЭлемента, "СправочникСсылка.Валюты"));
		
		// Курс исходной валюты
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".GlobalData.CalcParam.CurDtl.ExChgDtl.ExChgRate.Valuta" Тогда
		ТекСтрока.Шапка.Вставить("КурсИсходнойВалюты_Дата", ПривестиЗначение(ЗначениеЭлемента, "Дата"));
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								FinalCalc
		// Итого
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.GrandTotal.Tot" Тогда
		ТекСтрока.Шапка.Вставить("Итого", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		// Стоимость нормо-часа кузовных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FCLabor.LaborRates.LaborResults.Rate" Тогда
		ТекСтрока.Шапка.Вставить("НормочасРабот", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		// Стоимость нормо-часа окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FinalCalc.FCPaint.LaborRates.LaborResults.Rate" Тогда
		ТекСтрока.Шапка.Вставить("НормочасОкраски", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.FinalCalc.FCPaint.LaborRates.LaborResults.Rate" Тогда
		ТекСтрока.Шапка.Вставить("НормочасОкраски", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PartDtl
		
		// Тип ремонтного воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.RepTyp" Тогда
		СтрокаТовара["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Внутренний код запчасти в базе ПО Аудатэкс
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.GId" Тогда
		СтрокаТовара["КодДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование запчасти
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.PartDesc" Тогда
		СтрокаТовара["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаТовара["Источник"] = "PartDtls";
		
		// Код запчасти по производителю
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.PartNo" Тогда
		СтрокаТовара["НомерДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость запчасти
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.SpareParts.PartDtls.PartDtl.Price" Тогда
		СтрокаТовара["СтоимостьДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаТовара, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаТовара["СтоимостьДетали"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаТовара);
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PartComposit
		
		// Наименование работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.CompositeDesc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.LbrPosNo" Тогда
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.Price" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		// Полное наименование
	ИначеЕсли
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.MoreDesc.AddDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PartComposits.PartComposit.CompositeDesc.MoreDesc.AddDesc"
		Тогда
		
		СтрокаРаботы["ОписаниеРаботы"] = ?(
				СтрокаРаботы["ОписаниеРаботы"] = Неопределено,
				"",
				СтрокаРаботы["ОписаниеРаботы"] + " "
			) + ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								NetLabor
		
		// Тип ремонта работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.RepTyp" Тогда
		
		СтрокаРаботы["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.GId" Тогда
		СтрокаРаботы["КодДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.PartDesc" Тогда
		СтрокаРаботы["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаРаботы["Источник"] = "NetLabors";
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.RepDesc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.LbrPosNo" Тогда
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NetLabors.NetLabor.Price" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		////////////////////////////////////////////////////
		// NDtls.NDtl
		// Тип ремонта работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.RepTyp" Тогда
		СтрокаРаботы["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.GId" Тогда
		СтрокаРаботы["КодДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.PartDesc" Тогда
		СтрокаРаботы["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаРаботы["Источник"] = "NetLabors";
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.RepDesc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.LbrPosNo" Тогда
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.NDtls.NDtl.Price" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		///////////////////////////////////////////////////////////////////////////////////////////
		//								VehicleIdentification
		
		// Тип ремонта работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.RepTyp" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.RepTyp" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.RepTyp" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.RepTyp" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.RepTyp" Тогда
		СтрокаРаботы["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.GId" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.GId" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.GId" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.GId" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.GId" Тогда
		СтрокаРаботы["КодДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.PartDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.PartDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.PartDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.PartDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.PartDesc" Тогда
		СтрокаРаботы["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаРаботы["Источник"] = "Dtls";
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.RepDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.RepDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.RepDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.RepDesc" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.RepDesc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Labor.VDtls.VDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.IDtls.IDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.PDtls.PDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.UDtls.UDtl.Price" ИЛИ
		ИмяЭлемента = КорневойПуть + ".CalcData.Labor.HDtls.HDtl.Price" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PaintHeader
		
		// Тип окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader.PaintTyp" Тогда
		СтрокаПараметровОкраски["ТипОкраски"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код типа окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader.PaintCd" Тогда
		СтрокаПараметровОкраски["КодТипаОкраски"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование типа окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader.PaintTypDesc" Тогда
		СтрокаПараметровОкраски["НаименованиеТипаОкраски"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Системный тип окраски
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader.PaintSystemTyp" Тогда
		СтрокаПараметровОкраски["ТипОкраскиСистема"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Количество рабочих позиций в часе
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintHeader.PaintSystemTyp.TimeBase" Тогда
		СтрокаПараметровОкраски["КоличествоРП"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
	///////////////////////////////////////////////////////////////////////////////////////////
	// PaintPreparations
	
	ИначеЕсли ИмяЭлемента = КорневойПуть+".CalcData.Paint.PaintPreparations.PntPrep.MoreDesc.AddDesc" Тогда
		
		Если СтрокаРаботы["ОписаниеРаботы"] = Неопределено Тогда
			
			СтрокаРаботы["ОписаниеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
			
		Иначе
			
			СтрокаРаботы["ОписаниеРаботы"] = СтрокаРаботы["ОписаниеРаботы"]
				+ ПривестиЗначение(ЗначениеЭлемента, "Строка");
			
		КонецЕсли;
		
	ИначеЕсли ИмяЭлемента=КорневойПуть+".CalcData.Paint.PaintPreparations.PntPrep.LbrPosNo" Тогда
		
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
	ИначеЕсли ИмяЭлемента=КорневойПуть+".CalcData.Paint.PaintPreparations.PntPrep.CompositeDesc" Тогда
		
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
	ИначеЕсли ИмяЭлемента = КорневойПуть+".CalcData.Paint.PaintPreparations.PntPrep.Price" Тогда
		
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(
			ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока),
			СТРДанныхСтроки,
			СтрокаРаботы["СтоимостьРабот"]
		);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.WuNoTxC" Тогда
		
		ОкраскаМетала = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаМетала", ОкраскаМетала);
		ОкраскаМетала.Вставить("НаименованиеРаботы", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.Amnt" Тогда
		
		ОкраскаМетала = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаМетала", ОкраскаМетала);
		ОкраскаМетала.Вставить("СтоимостьРабот", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		ОкраскаМетала.Вставить("ЦенаРубли", 0);
		ОкраскаМетала.Вставить("ЦенаЕвро", 0);
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(
			ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока),
			ОкраскаМетала,
			ОкраскаМетала.СтоимостьРабот
		);
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.PlasticTxC" Тогда
		
		ОкраскаПластика = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаПластика", ОкраскаПластика);
		ОкраскаПластика.Вставить("НаименованиеРаботы", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.PlasticAmnt" Тогда
		
		ОкраскаПластика = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ОкраскаПластика", ОкраскаПластика);
		ОкраскаПластика.Вставить("СтоимостьРабот", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		ОкраскаПластика.Вставить("ЦенаРубли", 0);
		ОкраскаПластика.Вставить("ЦенаЕвро", 0);
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(
			ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока),
			ОкраскаПластика,
			ОкраскаПластика.СтоимостьРабот
		);
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColorMixTxC" Тогда
		
		СмешиваниеКраски = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("СмешиваниеКраски", СмешиваниеКраски);
		СмешиваниеКраски.Вставить("НаименованиеРаботы", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColMixingAmnt" Тогда
		
		СмешиваниеКраски = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("СмешиваниеКраски", СмешиваниеКраски);
		СмешиваниеКраски.Вставить("СтоимостьРабот", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		СмешиваниеКраски.Вставить("ЦенаРубли", 0);
		СмешиваниеКраски.Вставить("ЦенаЕвро", 0);
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(
			ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока),
			СмешиваниеКраски,
			СмешиваниеКраски.СтоимостьРабот
		);
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColorSamplTxC" Тогда
		
		ВыкрасОбразцаЦвета = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ВыкрасОбразцаЦвета", ВыкрасОбразцаЦвета);
		ВыкрасОбразцаЦвета.Вставить("НаименованиеРаботы", ПривестиЗначение(ЗначениеЭлемента, "Строка"));
		
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPreparations.PntPrep.ColSampleAmnt" Тогда
		
		ВыкрасОбразцаЦвета = Неопределено;
		ТекСтрока.ПодготовительныеРаботыПоОкраске.Свойство("ВыкрасОбразцаЦвета", ВыкрасОбразцаЦвета);
		ВыкрасОбразцаЦвета.Вставить("СтоимостьРабот", ПривестиЗначение(ЗначениеЭлемента, "Число"));
		
		ВыкрасОбразцаЦвета.Вставить("ЦенаРубли", 0);
		ВыкрасОбразцаЦвета.Вставить("ЦенаЕвро", 0);
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(
			ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока),
			ВыкрасОбразцаЦвета,
			ВыкрасОбразцаЦвета.СтоимостьРабот
		);
		
	///////////////////////////////////////////////////////////////////////////////////////////
	//								PaintDtl
	
	// Тип ремонта окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.RepTyp" Тогда
		СтрокаРаботы["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код детали окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.GId" Тогда
		СтрокаРаботы["КодДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование детали окрасочных работ
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.Desc" Тогда
		СтрокаРаботы["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаРаботы["Источник"] = "PaintPositions";
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.RepTypDesc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.LbrPosNo" Тогда
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.Lbr"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintPositions.PaintDtl.AdjacentDeduGrpTot.Lbr" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								PaintTotMat
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE1.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE2.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE3.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE4.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LLev2.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LILev3.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.TxC"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.PlasticTxC"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatIdx.Desc" Тогда
		
			СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
			СтрокаРаботы["КоличествоРП"] = 1;
			СтрокаРаботы["КоличествоРП_Измерение"] = "WU";
			СтрокаРаботы["Источник"] = "PaintTotMat";
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE1.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE2.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE3.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LE4.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LLev2.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.LILev3.Price"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Amnt"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatConst.Plastic"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.Paint.PaintTotMat.MatIdx.Amnt" Тогда
		
			СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
			СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
			зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
			РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		
			///////////////////////////////////////////////////////////////////////////////////////////
		//								MfcPCChg
		
		// Код детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.MfcPCChgs.MfcPCChg.Desc1" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.Paint.MfcPCChgs.MfcPCChg.Desc2" Тогда
		НаименованиеРаботы = СтрокаРаботы["НаименованиеРаботы"];
		НаименованиеРаботы = НаименованиеРаботы + " " + ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость ремонта
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.Paint.MfcPCChgs.MfcPCChg.Lbr" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		
		///////////////////////////////////////////////////////////////////////////////////////////
		//								ExtraItem/RiskDetail
		
		// Тип воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.RepTyp"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.RepTyp" Тогда
		СтрокаРаботы["ТипРемонта"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Код детали или объекта воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.GId"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.GId" Тогда
		СтрокаРаботы["НомерРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Наименование детали работы
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.PartDesc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.PartDesc" Тогда
		СтрокаРаботы["НаименованиеДетали"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаРаботы["Источник"] = "ExtraItems";
		
		// Наименование воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.Desc"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.Desc" Тогда
		СтрокаРаботы["НаименованиеРаботы"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		
		// Стоимость воздействия
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.ExtraItems.ExtraItem.Amnt"
		ИЛИ ИмяЭлемента = КорневойПуть + ".CalcData.RiskDetails.RiskDetail.Amnt" Тогда
		СтрокаРаботы["СтоимостьРабот"] = ПривестиЗначение(ЗначениеЭлемента, "Число");
		СТРДанныхСтроки = ПодготовитьДанныеДляПередачиНаСервер(СтрокаРаботы, "СтрокаТЧ");
		зфЗащищенныеФункцииСервер.ЗаполнитьЦену(ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока), СТРДанныхСтроки, СтрокаРаботы["СтоимостьРабот"]);
		РазобратьДанныеПолученныеССервера(СТРДанныхСтроки, СтрокаРаботы);
		
		////////////////////////////////////////////////////////////////////////////////////////////
		//									CalcControl/ActivIDBlks
	ИначеЕсли ИмяЭлемента = КорневойПуть + ".CalcData.CalcControl.ActivIDBlks.IDBlkDtl.IDBlk" Тогда
		СтрокаДопКодов["Код"] = ПривестиЗначение(ЗначениеЭлемента, "Строка");
		СтрокаДопКодов["Источник"] = "ActivIDBlks";
	КонецЕсли;
	
	Возврат Успешно;
	
КонецФункции

// Функция преобразует указанное значение в требуемый тип
//
Функция ПривестиЗначение(Знач Значение, Тип, ДопПараметры = Неопределено) Экспорт
	Результат = Неопределено;
	
	Если Тип = "Строка" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Результат = СокрЛП(Значение);
		КонецЕсли;
	ИначеЕсли Тип = "Число" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") И НЕ ПустаяСтрока(Значение) Тогда
			РабочееЗначение = Значение;
			Если Найти(РабочееЗначение, "-") Тогда
				Знак = - 1;
			Иначе
				Знак = 1;
			КонецЕсли;
			РабочееЗначение = СтрЗаменить(РабочееЗначение, "-", "");
			РабочееЗначение = СтрЗаменить(РабочееЗначение, "+", "");
			//РабочееЗначение	= СтрЗаменить(РабочееЗначение, ".", ",");
			Результат = Знак * Число(РабочееЗначение);
		КонецЕсли;
	ИначеЕсли Тип = "Дата" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") И НЕ ПустаяСтрока(Значение) тогда
			// По умолчанию формат строковой даты ГГГ-мм-дд
			ТекГод = 1; ТекМесяц = 1; ТекДень = 1; ТекЧас = 0; ТекМинута = 0; ТекСекунда = 0;
			РабочееЗначение = Значение;
			РабочееЗначение = СтрЗаменить(РабочееЗначение, "-", Символы.ПС);
			РабочееЗначение = СтрЗаменить(РабочееЗначение, " ", Символы.ПС);
			РабочееЗначение = СтрЗаменить(РабочееЗначение, ":", Символы.ПС);
			РабочееЗначение = СтрЗаменить(РабочееЗначение, ".", Символы.ПС);
			
			КоличествоЭлементов = СтрЧислоСтрок(РабочееЗначение);
			Если КоличествоЭлементов > 0 Тогда
				Для Счетчик = 1 По КоличествоЭлементов Цикл
					ПромежуточгаяСтрока = СтрПолучитьСтроку(РабочееЗначение, Счетчик);
					Если Счетчик = 1 Тогда
						ТекГод = Число(Сред(ПромежуточгаяСтрока, 0, 4));
					ИначеЕсли Счетчик = 2 Тогда
						ТекМесяц = Число(Сред(ПромежуточгаяСтрока, 0, 2));
					ИначеЕсли Счетчик = 3 Тогда
						ТекДень = Число(Сред(ПромежуточгаяСтрока, 0, 2));
					ИначеЕсли Счетчик = 4 Тогда
						ТекЧас = Число(Сред(ПромежуточгаяСтрока, 0, 2));
					ИначеЕсли Счетчик = 5 Тогда
						ТекМинута = Число(Сред(ПромежуточгаяСтрока, 0, 2));
					ИначеЕсли Счетчик = 6 Тогда
						ТекСекунда = Число(Сред(ПромежуточгаяСтрока, 0, 2));
					КонецЕсли;
					
					Результат = Дата(ТекГод, ТекМесяц, ТекДень, ТекЧас, ТекМинута, ТекСекунда);
				КонецЦикла;
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Валюты" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			// Попытаемся найти по наименованию
			ЗапросВалюты = Новый Запрос();
			ЗапросВалюты.Текст = "ВЫБРАТЬ Валюты.Ссылка КАК Ссылка
				|ИЗ Справочник.Валюты КАК Валюты
				|ГДЕ	Валюты.Наименование = &Наименование";
			ЗапросВалюты.УстановитьПараметр("Наименование", Значение);
			ТаблицаЗапроса = ЗапросВалюты.Выполнить().Выбрать();
			Если ТаблицаЗапроса.Следующий() Тогда
				Возврат ТаблицаЗапроса.Ссылка;
			Иначе
				// Определение кода валюта по наименованию
				Если ВРег(Значение) = "RUR" ИЛИ ВРег(Значение) = "RUB" Тогда
					ВероятныйКод = "643";
				ИначеЕсли ВРег(Значение) = "USD" Тогда
					ВероятныйКод = "840";
				ИначеЕсли ВРег(Значение) = "EUR" Тогда
					ВероятныйКод = "978";
				Иначе
					ВероятныйКод = 0;
				КонецЕсли;
				
				// Попытаемся найти по коду
				ЗапросВалюты.Текст = "ВЫБРАТЬ Валюты.Ссылка КАК Ссылка
					|ИЗ Справочник.Валюты КАК Валюты
					|ГДЕ	Валюты.Код = &Код";
				ЗапросВалюты.УстановитьПараметр("Код", ВероятныйКод);
				ТаблицаЗапроса = ЗапросВалюты.Выполнить().Выбрать();
				Если ТаблицаЗапроса.Следующий() Тогда
					Возврат ТаблицаЗапроса.Ссылка;
				Иначе
					// По коду и наименованию валюта не найдена,
					// создадим валюту
					НовыйОбъект = Справочники.Валюты.СоздатьЭлемент();
					Если ВероятныйКод = 0 Тогда
						НовыйОбъект.УстановитьНовыйКод();
					Иначе
						НовыйОбъект.Код = ВероятныйКод;
					КонецЕсли;
					НовыйОбъект.Заполнить(Неопределено);
					НовыйОбъект.Наименование = Значение;
					НовыйОбъект.НаименованиеПолное = Значение;
					Попытка
						НовыйОбъект.Записать();
						Результат = НовыйОбъект.Ссылка;
					Исключение
						Результат = Неопределено;
					КонецПопытки;
				КонецЕсли;
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Номенклатура" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			
			ЗапчастьКод = Неопределено;
			ЗапчастьАртикул = Неопределено;
			ЗапчастьТип = Неопределено;
			ЗапчастьНаименование = Неопределено;
			ИсточникДетали = Неопределено;
			ВалютаНормочасаРабот = Неопределено;
			
			ДопПараметры.Свойство("КодДетали", ЗапчастьКод);
			ДопПараметры.Свойство("НомерДетали", ЗапчастьАртикул);
			ДопПараметры.Свойство("Источник", ИсточникДетали);
			ДопПараметры.Свойство("ТипРемонта", ЗапчастьТип);
			ДопПараметры.Свойство("НаименованиеДетали", ЗапчастьНаименование);
			ДопПараметры.Свойство("НормочасРабот_Валюта", ВалютаНормочасаРабот);
			
			Если обЗначениеНеЗаполнено(ЗапчастьАртикул) Тогда
				ДопПараметры.Свойство("НомерРаботы", ЗапчастьАртикул);
				Если НЕ обЗначениеНеЗаполнено(ЗапчастьАртикул) И
					обЗначениеНеЗаполнено(ЗапчастьНаименование) Тогда
					ДопПараметры.Свойство("НаименованиеРаботы", ЗапчастьНаименование);
				КонецЕсли;
			КонецЕсли;
			
			Если ВРег(ЗапчастьАртикул = "ЗАМЕНИТЬ") ИЛИ ВРег(ЗапчастьАртикул) = "БН" Тогда
				ЗапчастьАртикул = "";
			КонецЕсли;
			
			ЗапросНоменклатуры = Новый Запрос();
			ЗапросНоменклатуры.УстановитьПараметр("Артикул", ?(обЗначениеНеЗаполнено(ЗапчастьАртикул), "", ЗапчастьАртикул));
			ЗапросНоменклатуры.УстановитьПараметр("Наименование", Лев(ЗапчастьНаименование, ДлинаНаименованияТовара));
			ЗапросНоменклатуры.УстановитьПараметр("НаименованиеПолное", ЗапчастьНаименование);
			
			// Поиск по артикулу и наименованию
			ЗапросНоменклатуры.Текст = "ВЫБРАТЬ	Номенклатура.Ссылка КАК Ссылка
				|ИЗ	Справочник.Номенклатура КАК Номенклатура
				|ГДЕ	НЕ Номенклатура.ЭтоГруппа
				|	И Номенклатура.Артикул = &Артикул
				|	И Номенклатура.Наименование = &Наименование";
			ТаблицаЗапроса = ЗапросНоменклатуры.Выполнить().Выбрать();
			Если ТаблицаЗапроса.Следующий() Тогда
				Возврат ТаблицаЗапроса.Ссылка;
			КонецЕсли;
			
			// если точного соответствия не нашли попробуем провести синхронизацию
			Если флПоискАртикул И НЕ обЗначениеНеЗаполнено(ЗапчастьАртикул) Тогда
				ЗапросСинхронизация = Новый Запрос;
				ЗапросСинхронизация.Текст =
					"ВЫБРАТЬ
					|	Номенклатура.Ссылка КАК Номенклатура
					|ИЗ
					|	Справочник.Номенклатура КАК Номенклатура
					|ГДЕ
					|	НЕ Номенклатура.ЭтоГруппа
					|	И Номенклатура.Артикул = &Артикул";
				ЗапросСинхронизация.УстановитьПараметр("Артикул", ЗапчастьАртикул);
				Выборка = ЗапросСинхронизация.Выполнить().Выбрать();
				
				Если Выборка.Следующий() Тогда
					Если флСинхронизироватьНоменклатуру Тогда
						СинхранизируемыйОбъект = Выборка.Номенклатура.ПолучитьОбъект();
						
						// проведем синхронизацию если нашли что-то
						СинхранизируемыйОбъект.Артикул = ЗапчастьАртикул;
						СинхранизируемыйОбъект.Наименование = ЗапчастьНаименование;
						СинхранизируемыйОбъект.НаименованиеИностранное = ЗапчастьНаименование;
						СинхранизируемыйОбъект.НаименованиеПолное = ЗапчастьНаименование;
						СинхранизируемыйОбъект.Комментарий = ИсточникДетали;
						
						Попытка
							СинхранизируемыйОбъект.Записать();
							Результат = СинхранизируемыйОбъект.Ссылка;
						Исключение
							Сообщить(ОписаниеОшибки());
							Возврат Справочники.Номенклатура.ПустаяСсылка();
						КонецПопытки;
					КонецЕсли;
					Возврат Результат;
				КонецЕсли;
			КонецЕсли;
			
			Если обЗначениеНеЗаполнено(ЗапчастьНаименование) Тогда
				НаименованиеРаб = Неопределено;
				ДопПараметры.Свойство("НаименованиеРаботы", НаименованиеРаб);
				Если НЕ обЗначениеНеЗаполнено(НаименованиеРаб) Тогда
					Возврат Справочники.Номенклатура.Авторабота;
				Иначе
					Возврат Справочники.Номенклатура.ПустаяСсылка();
				КонецЕсли;
			КонецЕсли;
			
			ТипНоменклатуры = Справочники.ТипыНоменклатуры.Штучный;
			ВидНоменклатуры = Перечисления.ВидыНоменклатуры.Товар;
			БазоваяЕдиница = ТипНоменклатуры.ОсновнаяБазоваяЕдиницаИзмерения;
			
			НовыйОбъект = Справочники.Номенклатура.СоздатьЭлемент();
			
			// Иначе номенклатура с пустыми артикулами не загрузится
			НовыйОбъект.ОбменДанными.Загрузка = Истина;
			
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Артикул = ЗапчастьАртикул;
			НовыйОбъект.Наименование = ЗапчастьНаименование;
			НовыйОбъект.НаименованиеИностранное = ЗапчастьНаименование;
			НовыйОбъект.НаименованиеПолное = ЗапчастьНаименование;
			НовыйОбъект.СтавкаНДС = Справочники.СтавкиНДС.ОсновнаяСтавкаНДС;
			Если ВалютаНормочасаРабот <> Неопределено Тогда
				НовыйОбъект.ВалютаУчета = ВалютаНормочасаРабот;
			КонецЕсли;
			НовыйОбъект.Родитель = ГруппаНоменклатуры;
			НовыйОбъект.ТипНоменклатуры = ТипНоменклатуры;
			НовыйОбъект.ВидНоменклатуры = ВидНоменклатуры;
			НовыйОбъект.БазоваяЕдиницаИзмерения = БазоваяЕдиница;
			НовыйОбъект.Комментарий = ИсточникДетали;
			
			Попытка
				НовыйОбъект.Записать();
				Результат = НовыйОбъект.Ссылка;
				Если НовыйОбъект.ОсновнаяЕдиницаИзмерения.Пустая() Тогда
					Попытка // Возможна ошибка при записи основной единицы измерения (если не задана базовая)
						НовыйОбъект.ОсновнаяЕдиницаИзмерения = НовыйОбъект.ПолучитьЕдиницуИзмеренияПоБазовой();
						НовыйОбъект.Записать();
					Исключение КонецПопытки;
				КонецЕсли;
			Исключение
				Сообщить(ОписаниеОшибки());
				Возврат Справочники.Номенклатура.ПустаяСсылка();
			КонецПопытки;
			Возврат Результат;
		КонецЕсли;
		
	ИначеЕсли Тип = "Справочники.КлассификаторСтранМира" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ПустаяСтрока(Значение) Тогда
				Значение = "Неопределено";
			КонецЕсли;
			СтранаПроисхождения = Справочники.КлассификаторСтранМира.НайтиПоНаименованию(Значение, Истина);
			Если обЗначениеНеЗаполнено(СтранаПроисхождения) Тогда
				НовыйОбъект = Справочники.КлассификаторСтранМира.СоздатьЭлемент();
				НовыйОбъект.Заполнить(Неопределено);
				НовыйОбъект.УстановитьНовыйКод();
				НовыйОбъект.Наименование = Значение;
				НовыйОбъект.НаименованиеПолное = Значение;
				Попытка
					НовыйОбъект.Записать();
				Исключение
					Возврат Справочники.КлассификаторСтранМира.ПустаяСсылка();
				КонецПопытки;
				
				Возврат НовыйОбъект.Ссылка;
			Иначе
				Возврат СтранаПроисхождения;
			КонецЕсли;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Производители" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			
			Если обЗначениеНеЗаполнено(Значение) Тогда
				Возврат Справочники.Производители.ПустаяСсылка();
			КонецЕсли;
			
			// Уберем служебные символы из наименования производителя
			Пропустить = Ложь;
			НаименованиеПроизводителя = "";
			Для Индекс = 1 По СтрДлина(Значение) - 1 Цикл
				ТекСимвол = Сред(Значение, Индекс, 1);
				Если ТекСимвол = "[" Тогда
					Пропустить = Истина;
				ИначеЕсли ТекСимвол = "]" Тогда
					Пропустить = Ложь;
				ИначеЕсли НЕ Пропустить Тогда
					НаименованиеПроизводителя = НаименованиеПроизводителя + ТекСимвол;
				КонецЕсли;
			КонецЦикла;
			
			// Поиск по наименонию производителя
			ЗапросПроизводителей = Новый Запрос();
			ЗапросПроизводителей.УстановитьПараметр("Наименование", НаименованиеПроизводителя);
			ЗапросПроизводителей.Текст = "ВЫБРАТЬ
				|	Производители.Ссылка
				|ИЗ
				|	Справочник.Производители КАК Производители
				|ГДЕ
				|	Производители.Наименование = &Наименование";
			ТаблицаПроизводителей = ЗапросПроизводителей.Выполнить().Выбрать();
			Если ТаблицаПроизводителей.Следующий() Тогда
				Возврат ТаблицаПроизводителей.Ссылка;
			КонецЕсли;
			
			// Классификатор страны произвождения не известен
			СтранаПроисхождения = ПривестиЗначение("", "Справочники.КлассификаторСтранМира", ДопПараметры);
			
			НовыйОбъект = Справочники.Производители.СоздатьЭлемент();
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Наименование = НаименованиеПроизводителя;
			НовыйОбъект.СтранаПроисхождения = СтранаПроисхождения;
			Попытка
				НовыйОбъект.Записать();
			Исключение
				Возврат Справочники.Производители.ПустаяСсылка();
			КонецПопытки;
			
			Возврат НовыйОбъект.Ссылка;
			
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Модели" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			
			СсылкаНаРодителя = ГруппаМодели;
			Производитель = ПривестиЗначение(Значение, "СправочникСсылка.Производители", ДопПараметры);
			ВалютаУчета = Константы.ВалютаРегламентированногоУчетаОрганизаций.Получить();
			
			// Поиск по наименованию
			ЗапросМоделей = Новый Запрос();
			ЗапросМоделей.УстановитьПараметр("Наименование", Значение);
			ЗапросМоделей.Текст = "ВЫБРАТЬ
				|	Модели.Ссылка
				|ИЗ
				|	Справочник.Модели КАК Модели
				|ГДЕ
				|	НЕ Модели.ЭтоГруппа
				|	И Модели.Наименование = &Наименование";
			ТаблицаМоделей = ЗапросМоделей.Выполнить().Выбрать();
			Если ТаблицаМоделей.Следующий() Тогда
				Возврат ТаблицаМоделей.Ссылка;
			КонецЕсли;
			
			НовыйОбъект = Справочники.Модели.СоздатьЭлемент();
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Наименование = Значение;
			НовыйОбъект.НаименованиеПолное = Значение;
			НовыйОбъект.Производитель = Производитель;
			НовыйОбъект.Родитель = СсылкаНаРодителя;
			Если обЗначениеНеЗаполнено(НовыйОбъект.ВалютаУчета) Тогда
				НовыйОбъект.ВалютаУчета = ВалютаУчета;
			КонецЕсли;
			
			Попытка
				НовыйОбъект.Записать();
			Исключение
				Возврат Справочники.Модели.ПустаяСсылка();
			КонецПопытки;
			
			Возврат НовыйОбъект.Ссылка;
			
			
			
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Автомобили" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			
			ТекстМодель = Неопределено; ТекстПодМодель = Неопределено;
			ТекстПроизводитель = Неопределено; ТекстИдентификатор = Неопределено;
			ДатаВыпуска = Неопределено; ГосНомер = Неопределено;
			ПробегАвто = Неопределено; ХозяинАвтомобиля = Неопределено;
			
			ДопПараметры.Свойство("Автомобиль_Модель", ТекстМодель);
			ДопПараметры.Свойство("Автомобиль_Подмодель", ТекстПодМодель);
			ДопПараметры.Свойство("Автомобиль_Производитель", ТекстПроизводитель);
			ДопПараметры.Свойство("Автомобиль_Идентификатор", ТекстИдентификатор);
			
			Если обЗначениеНеЗаполнено(ТекстПроизводитель) И обЗначениеНеЗаполнено(ТекстМодель) Тогда
				Возврат Справочники.Автомобили.ПустаяСсылка();
			Иначе
				НаименованиеМодели = зфЗащищенныеФункцииСервер.ПолучитьНаименованиеМодели(ТекстПроизводитель, ТекстМодель);
			КонецЕсли;
			ВалютаУчета = Константы.ВалютаРегламентированногоУчетаОрганизаций.Получить();
			СсылкаНаРодителя = ГруппаАвтомобили;
			
			ДопПараметры.Свойство("Автомобиль_ДатаВыпуска", ДатаВыпуска);
			ДопПараметры.Свойство("Автомобиль_Номер", ГосНомер);
			ДопПараметры.Свойство("Автомобиль_Пробег", ПробегАвто);
			ДопПараметры.Свойство("ХозяинАвтомобиля", ХозяинАвтомобиля);
			
			ГосНомер = СтрЗаменить(ГосНомер, " ", "");
			
			// Поиск по VIN-у
			ЗапросАвтомобиля = Новый Запрос();
			ЗапросАвтомобиля.УстановитьПараметр("VIN", Значение);
			ЗапросАвтомобиля.УстановитьПараметр("НаименованиеМодели", НаименованиеМодели);
			ЗапросАвтомобиля.Текст = "ВЫБРАТЬ
				|	Автомобили.Ссылка КАК Ссылка
				|ИЗ
				|	Справочник.Автомобили КАК Автомобили
				|ГДЕ (НЕ Автомобили.ЭтоГруппа)
				|	И (Автомобили.VIN = &VIN
				|	ИЛИ Автомобили.ОригинальныйVIN = &VIN)";
			
			ТаблицаАвто = ЗапросАвтомобиля.Выполнить().Выбрать();
			Если ТаблицаАвто.Следующий() Тогда
				Возврат ТаблицаАвто.Ссылка;
			КонецЕсли;
			
			// Поиск по наименованию
			Если НЕ обЗначениеНеЗаполнено(НаименованиеМодели) Тогда
				ЗапросАвтомобиля.Текст = "ВЫБРАТЬ
					|	Автомобили.Ссылка КАК Ссылка
					|ИЗ
					|	Справочник.Автомобили КАК Автомобили
					|ГДЕ НЕ Автомобили.ЭтоГруппа
					|	И Автомобили.Наименование = &НаименованиеМодели";
				
				ТаблицаАвто = ЗапросАвтомобиля.Выполнить().Выбрать();
				Если ТаблицаАвто.Следующий() Тогда
					Возврат ТаблицаАвто.Ссылка;
				КонецЕсли;
			КонецЕсли;
			
			Модель = ПривестиЗначение(НаименованиеМодели, "СправочникСсылка.Модели", ДопПараметры);
			
			НовыйОбъект = Справочники.Автомобили.СоздатьЭлемент();
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Наименование = Справочники.Автомобили.СформироватьНаименованиеАвтомобиляПоПолям(НаименованиеМодели, , ГосНомер, Значение);
			НовыйОбъект.НаименованиеПолное = НовыйОбъект.Наименование;
			НовыйОбъект.Родитель = СсылкаНаРодителя;
			НовыйОбъект.VIN = Значение;
			НовыйОбъект.ОригинальныйVIN = Значение;
			НовыйОбъект.ВключатьВПрайсЛист = Перечисления.ВидВключенияВПрайсЛист.ПоУмолчанию;
			НовыйОбъект.Модель = Модель;
			Если НЕ обЗначениеНеЗаполнено(ДатаВыпуска) Тогда
				НовыйОбъект.ГодВыпуска = ДатаВыпуска;
			КонецЕсли;
			
			Попытка
				НовыйОбъект.Записать();
			Исключение
				Возврат Справочники.Автомобили.ПустаяСсылка();
			КонецПопытки;
			
			Если НЕ обЗначениеНеЗаполнено(ХозяинАвтомобиля) Тогда
				Справочники.Автомобили.ЗаписьЗначенияРегистраСведения(НовыйОбъект.Ссылка, ХозяинАвтомобиля, Перечисления.ДополнительнаяИнформацияАвтомобилей.Хозяин);
			КонецЕсли;
			Если НЕ обЗначениеНеЗаполнено(ПробегАвто) Тогда
				Справочники.Автомобили.ЗаписьЗначенияРегистраСведения(НовыйОбъект.Ссылка, ПробегАвто, Перечисления.ДополнительнаяИнформацияАвтомобилей.Пробег);
			КонецЕсли;
			Если НЕ обЗначениеНеЗаполнено(ГосНомер) Тогда
				Справочники.Автомобили.ЗаписьЗначенияРегистраСведения(НовыйОбъект.Ссылка, ГосНомер, Перечисления.ДополнительнаяИнформацияАвтомобилей.ГосНомер);
			КонецЕсли;
			
			Возврат НовыйОбъект.Ссылка;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Контрагенты" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			
			ФамилияВладельца = Неопределено; ИмяВладельца = Неопределено;
			
			ДопПараметры.Свойство("ФамилияВладельца", ФамилияВладельца);
			ДопПараметры.Свойство("ИмяВладельца", ИмяВладельца);
			
			Если обЗначениеНеЗаполнено(ФамилияВладельца) И обЗначениеНеЗаполнено(ИмяВладельца) Тогда
				Возврат Справочники.Контрагенты.ПустаяСсылка();
			КонецЕсли;
			
			СсылкаНаРодителя = ГруппаКонтрагентов;
			ВидКонтрагента = Перечисления.ВидыКонтрагентов.Покупатель;
			ФормаСобственности = Перечисления.ФормыСобственности.ЧастноеЛицо;
			
			ЗапросКонтрагента = Новый Запрос();
			ЗапросКонтрагента.УстановитьПараметр("Фамилия", ФамилияВладельца);
			ЗапросКонтрагента.УстановитьПараметр("Имя", ИмяВладельца);
			ЗапросКонтрагента.УстановитьПараметр("Наименование", Значение);
			ЗапросКонтрагента.УстановитьПараметр("Родитель", СсылкаНаРодителя);
			ЗапросКонтрагента.УстановитьПараметр("ВидКонтрагента", ВидКонтрагента);
			ЗапросКонтрагента.УстановитьПараметр("ФормаСобственности", ФормаСобственности);
			
			// Поиск по фамлии и имени
			Если НЕ обЗначениеНеЗаполнено(ФамилияВладельца) И НЕ обЗначениеНеЗаполнено(ИмяВладельца) Тогда
				ЗапросКонтрагента.Текст = "ВЫБРАТЬ
					|	Контрагенты.Ссылка КАК Ссылка
					|ИЗ
					|	Справочник.Контрагенты КАК Контрагенты
					|ГДЕ
					|	Контрагенты.Фамилия = &Фамилия
					|	И Контрагенты.Имя = &Имя
					|	" + ?(флКонтрагентыТолькоИзГруппы, "И НЕ Контрагенты.ЭтоГруппа", "") + "
					|	И Контрагенты.Родитель = &Родитель
					|	И Контрагенты.ВидКонтрагента = &ВидКонтрагента
					|	И Контрагенты.ФормаСобственности = &ФормаСобственности";
				ТаблицаКонтрагентов = ЗапросКонтрагента.Выполнить().Выбрать();
				Если ТаблицаКонтрагентов.Следующий() Тогда
					Возврат ТаблицаКонтрагентов.Ссылка;
				КонецЕсли;
			КонецЕсли;
			
			// Поиск по фамлии
			Если НЕ обЗначениеНеЗаполнено(ФамилияВладельца) Тогда
				ЗапросКонтрагента.Текст = "ВЫБРАТЬ
					|	Контрагенты.Ссылка КАК Ссылка
					|ИЗ
					|	Справочник.Контрагенты КАК Контрагенты
					|ГДЕ
					|	Контрагенты.Фамилия = &Фамилия
					|	И НЕ Контрагенты.ЭтоГруппа
					|	" + ?(флКонтрагентыТолькоИзГруппы, "И НЕ Контрагенты.ЭтоГруппа", "") + "
					|	И Контрагенты.ВидКонтрагента = &ВидКонтрагента
					|	И Контрагенты.ФормаСобственности = &ФормаСобственности";
				ТаблицаКонтрагентов = ЗапросКонтрагента.Выполнить().Выбрать();
				Если ТаблицаКонтрагентов.Следующий() Тогда
					Возврат ТаблицаКонтрагентов.Ссылка;
				КонецЕсли;
			КонецЕсли;
			
			// Поиск по наименованию
			Если НЕ обЗначениеНеЗаполнено(Значение) Тогда
				ЗапросКонтрагента.Текст = "ВЫБРАТЬ
					|	Контрагенты.Ссылка КАК Ссылка
					|ИЗ
					|	Справочник.Контрагенты КАК Контрагенты
					|ГДЕ
					|	Контрагенты.Наименование = &Наименование
					|	И НЕ Контрагенты.ЭтоГруппа
					|	" + ?(флКонтрагентыТолькоИзГруппы, "И НЕ Контрагенты.ЭтоГруппа", "") + "
					|	И Контрагенты.ВидКонтрагента = &ВидКонтрагента
					|	И Контрагенты.ФормаСобственности = &ФормаСобственности";
				ТаблицаКонтрагентов = ЗапросКонтрагента.Выполнить().Выбрать();
				Если ТаблицаКонтрагентов.Следующий() Тогда
					Возврат ТаблицаКонтрагентов.Ссылка;
				КонецЕсли;
			КонецЕсли;
			
			// Найти контрагента не удалось. Создание нового контрагента.
			НовыйОбъект = Справочники.Контрагенты.СоздатьЭлемент();
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Наименование = Значение;
			НовыйОбъект.НаименованиеПолное = Значение;
			НовыйОбъект.ВидКонтрагента = ВидКонтрагента;
			НовыйОбъект.ФормаСобственности = ФормаСобственности;
			НовыйОбъект.Фамилия = ФамилияВладельца;
			НовыйОбъект.Имя = ИмяВладельца;
			НовыйОбъект.Родитель = СсылкаНаРодителя;
			попытка
				НовыйОбъект.Записать();
			Исключение
				Сообщить(ОписаниеОшибки());
				Возврат Неопределено;
			КонецПопытки;
			
			Возврат НовыйОбъект.Ссылка;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.Автоработы" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			
			АртикулРаботы = Значение;
			Если Врег(АртикулРаботы) = "БН" ИЛИ ВРег(АртикулРаботы) = "ЗАМЕНИТЬ" Тогда
				АртикулРаботы = "";
			КонецЕсли;
			
			НаименованиеРаботы = Неопределено;
			ИсточникРаботы = Неопределено;
			ОписаниеРаботы = Неопределено;
			НаименованиеДетали = Неопределено;
			ПолноеНаименование = Неопределено;
			
			ДопПараметры.Свойство("НаименованиеРаботы", НаименованиеРаботы);
			ДопПараметры.Свойство("НаименованиеДетали", НаименованиеДетали);
			ДопПараметры.Свойство("Источник", ИсточникРаботы);
			ДопПараметры.Свойство("ПолноеНаименование", ПолноеНаименование);
			
			СсылкаНаРодителя = ГруппаАвторабот;
			
			Если обЗначениеНеЗаполнено(НаименованиеРаботы) Тогда
				Возврат Справочники.Автоработы.ПустаяСсылка();
			КонецЕсли;
			
			Запросработ = Новый Запрос();
			Запросработ.УстановитьПараметр("АртикулРаботы", АртикулРаботы);
			Запросработ.УстановитьПараметр("НаименованиеРаботы", Лев(НаименованиеРаботы, ДлинаНаименованияРаботы));
			Запросработ.УстановитьПараметр("НаименованиеПолное", ПолноеНаименование);
			
			// Поиск по артикулу и наименованию
			Запросработ.Текст =
				"ВЫБРАТЬ Автоработы.Ссылка
				|ИЗ Справочник.Автоработы КАК Автоработы
				|ГДЕ НЕ Автоработы.ЭтоГруппа
				|	И Автоработы.Артикул = &АртикулРаботы
				|	И Автоработы.Наименование = &НаименованиеРаботы"
				+ ?(флПоискНаименованиеПолное, " И ВЫРАЗИТЬ(Автоработы.НаименованиеПолное КАК СТРОКА(1000)) = &НаименованиеПолное", "");
			
			ТаблицаРабот = Запросработ.Выполнить().Выбрать();
			Если ТаблицаРабот.Следующий() Тогда
				Возврат ТаблицаРабот.Ссылка;
			КонецЕсли;
			
			Если НЕ флНеДобавлятьНоменклатуруПриСозданииАвторабот Тогда
				Номенклатура = ПривестиЗначение(АртикулРаботы, "СправочникСсылка.Номенклатура", ДопПараметры);
			ИначеЕсли ЗначениеЗаполнено(НоменклатураДляРаботПоУмолчанию) Тогда
				Номенклатура = НоменклатураДляРаботПоУмолчанию;
			Иначе
				Номенклатура = Справочники.Номенклатура.Авторабота;
			КонецЕсли;
			
			
			Если обЗначениеНеЗаполнено(Номенклатура) Тогда
				Возврат Справочники.Автоработы.ПустаяСсылка();
			КонецЕсли;
			
			НовыйОбъект = Справочники.Автоработы.СоздатьЭлемент();
			
			НовыйОбъект.ОбменДанными.Загрузка = Истина;
			
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Артикул = АртикулРаботы;
			НовыйОбъект.Наименование = НаименованиеРаботы;
			НовыйОбъект.НаименованиеПолное = ПолноеНаименование;
			Если НЕ обЗначениеНеЗаполнено(ДопПараметры.ТипРемонта) Тогда
				НовыйОбъект.ЭтоОкраска = (Найти(ДопПараметры.ТипРемонта, "L") > 0);
			КонецЕсли;
			
			НовыйОбъект.Родитель = СсылкаНаРодителя;
			НовыйОбъект.Номенклатура = Номенклатура;
			Если НЕ обЗначениеНеЗаполнено(ИсточникРаботы) Тогда
				НовыйОбъект.Комментарий = ИсточникРаботы;
			КонецЕсли;
			
			Попытка
				НовыйОбъект.Записать();
			Исключение
				Сообщить(ОписаниеОшибки());
				Возврат Справочники.Автоработы.ПустаяСсылка();
			КонецПопытки;
			
			Возврат НовыйОбъект.Ссылка;
		КонецЕсли;
		
	ИначеЕсли Тип = "СправочникСсылка.ХарактеристикиНоменклатуры" Тогда
		Если ТипЗнч(Значение) = Тип("Строка") Тогда
			Если ТипЗнч(ДопПараметры) <> Тип("Структура") Тогда Возврат Неопределено; КонецЕсли;
			VIN = Неопределено;
			ДопПараметры.Свойство("Автомобиль_VIN", VIN);
			
			Если обЗначениеНеЗаполнено(VIN) Тогда
				Возврат Справочники.ХарактеристикиНоменклатуры.ПустаяСсылка();
			КонецЕсли;
			
			// Поиск по наименованию
			ЗапросХарактеристик = Новый Запрос();
			ЗапросХарактеристик.УстановитьПараметр("Наименование", VIN);
			ЗапросХарактеристик.Текст = "ВЫБРАТЬ
				|	ХарактеристикиНоменклатуры.Ссылка
				|ИЗ
				|	Справочник.ХарактеристикиНоменклатуры КАК ХарактеристикиНоменклатуры
				|ГДЕ
				|	ХарактеристикиНоменклатуры.Наименование = &Наименование";
			ТаблицаХарактеристик = ЗапросХарактеристик.Выполнить().Выбрать();
			Если ТаблицаХарактеристик.Следующий() Тогда
				Возврат ТаблицаХарактеристик.Ссылка;
			КонецЕсли;
			
			ВладелецХарактеристики = Справочники.ТипыНоменклатуры.Штучный;
			НовыйОбъект = Справочники.ХарактеристикиНоменклатуры.СоздатьЭлемент();
			НовыйОбъект.Заполнить(Неопределено);
			НовыйОбъект.УстановитьНовыйКод();
			НовыйОбъект.Наименование = VIN;
			НовыйОбъект.СерийныйНомер = VIN;
			Если НЕ обЗначениеНеЗаполнено(ВладелецХарактеристики) Тогда
				НовыйОбъект.Владелец = ВладелецХарактеристики;
			КонецЕсли;
			
			Попытка
				НовыйОбъект.Записать();
			Исключение
				Сообщить(ОписаниеОшибки());
				Возврат Справочники.ХарактеристикиНоменклатуры.ПустаяСсылка();
			КонецПопытки;
			
			Возврат НовыйОбъект.Ссылка;
			
		КонецЕсли;
	КонецЕсли;
	
	Возврат Результат;
КонецФункции

// Функция возвращает xml в формате saxif для прикрепления
//
Функция ПолучитьХМЛПрикрепления(ПутьКФайлу) Экспорт
	
	СодержимоеФайла = Base64Строка(Новый ДвоичныеДанные(ПутьКФайлу)); // XMLСтрока
	
	ЗаписьXML = Новый ЗаписьXML();
	ЗаписьXML.УстановитьСтроку();
	
	ЗаписьXML.ЗаписатьНачалоЭлемента("AttachmentBinaryList");
	ЗаписьXML.ЗаписатьАтрибут("xmlns", "http://www.audatex.com/SAXIF");
	
	ЗаписьXML.ЗаписатьНачалоЭлемента("AttachmentBinary");
	ЗаписьXML.ЗаписатьНачалоЭлемента("FileName");
	ЗаписьXML.ЗаписатьТекст(СтрЗаменить(ПутьКФайлу, КаталогВременныхФайлов(), ""));
	ЗаписьXML.ЗаписатьКонецЭлемента();
	
	ЗаписьXML.ЗаписатьНачалоЭлемента("Source");
	ЗаписьXML.ЗаписатьНачалоЭлемента("Attachment");
	ЗаписьXML.ЗаписатьТекст(СодержимоеФайла);
	ЗаписьXML.ЗаписатьКонецЭлемента(); // Attachment
	ЗаписьXML.ЗаписатьКонецЭлемента(); // Source
	
	ЗаписьXML.ЗаписатьКонецЭлемента(); // AttachmentBinary
	
	ЗаписьXML.ЗаписатьКонецЭлемента(); // AttachmentBinaryList
	
	ТекстХМЛ = ЗаписьXML.Закрыть();
	Возврат ТекстХМЛ;
КонецФункции

Функция ПутьКРаботамПоПодготовкеОкраски()
	
	Возврат "Task.CalculationList.CLASSCalculation.CLASSResult.CLASSXml.CalcData.Paint.PaintPreparations.PntPrep";
	
КонецФункции

Процедура ПеренестиРаботыПоПодготовкеКОстальным()
	
	ВсегоКалькуляций = КэшКалькуляций.Количество();
	
	Если ВсегоКалькуляций > 0 Тогда
		
		ТекКалькуляция = КэшКалькуляций[ВсегоКалькуляций - 1];
		
	КонецЕсли;
	
	Для Каждого РаботаПоПодготовке Из ТекКалькуляция.ПодготовительныеРаботыПоОкраске Цикл
		
		НоваяРабота = ТекКалькуляция.Работы.Добавить();
		ЗаполнитьЗначенияСвойств(НоваяРабота, РаботаПоПодготовке.Значение);
		НоваяРабота.Источник = "PaintPreparations";
		
	КонецЦикла;
	
КонецПроцедуры

////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

Функция ПодготовитьДанныеДляПередачиНаСервер(ТекСтрока, ПараметрРазбора = "Калькуляция") Экспорт
	Если ПараметрРазбора = "Калькуляция" Тогда
		СТРДанные = Новый Структура;
		СТРДанные.Вставить("КурсИсходнойВалюты", ТекСтрока.Шапка["КурсИсходнойВалюты"]);
		СТРДанные.Вставить("ВалютаКалькуляцииСтрока", ТекСтрока.Шапка["ВалютаКалькуляцииСтрока"]);
		Возврат СТРДанные;
	ИначеЕсли ПараметрРазбора = "СтрокаТЧ" Тогда
		СтрВозврат = Новый Структура;
		Таблица = ТекСтрока.Владелец();
		Для Каждого Колонка Из Таблица.Колонки Цикл
			СтрВозврат.Вставить(Колонка.Имя, ТекСтрока[Колонка.Имя]);
		КонецЦикла;
		
		Возврат СтрВозврат;
	КонецЕсли;
КонецФункции

Процедура РазобратьДанныеПолученныеССервера(СТРДАнных, СтрокаТовара) Экспорт
	Для Каждого Реквизит Из СТРДАнных Цикл
		СтрокаТовара[Реквизит.Ключ] = Реквизит.Значение;
	КонецЦикла;
КонецПроцедуры


/////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ


///////////////////////////////////////////////////////////////////
// ИСПОЛНЯЕМАЯ ЧАСТЬ МОДУЛЯ

СерверОснование = обПраво("СерверAutoPadWeb");
Если обЗначениеНеЗаполнено(СерверОснование) Тогда
	СерверОснование = "www.audatex.ru";
КонецЕсли;

ПроксиЗаданий = Неопределено;
ПроксиПрикреплений = Неопределено;

КэшКалькуляций = Новый ТаблицаЗначений();
КэшКалькуляций.Колонки.Добавить("ИдДела", Новый ОписаниеТипов("Строка"));
КэшКалькуляций.Колонки.Добавить("НомерДела", Новый ОписаниеТипов("Строка"));
КэшКалькуляций.Колонки.Добавить("ИдКалькуляции", Новый ОписаниеТипов("Строка"));
КэшКалькуляций.Колонки.Добавить("ДатаКалькуляции", Новый ОписаниеТипов("Дата"));
КэшКалькуляций.Колонки.Добавить("Шапка", Новый ОписаниеТипов("Соответствие"));
КэшКалькуляций.Колонки.Добавить("Товары", Новый ОписаниеТипов("ТаблицаЗначений"));
КэшКалькуляций.Колонки.Добавить("Работы", Новый ОписаниеТипов("ТаблицаЗначений"));
КэшКалькуляций.Колонки.Добавить("ПараметрыОкраски", Новый ОписаниеТипов("ТаблицаЗначений"));
КэшКалькуляций.Колонки.Добавить("ДопКоды", Новый ОписаниеТипов("ТаблицаЗначений"));
КэшКалькуляций.Колонки.Добавить("ПодготовительныеРаботыПоОкраске", Новый ОписаниеТипов("Структура"));

ДлинаНаименованияТовара = Метаданные.Справочники.Номенклатура.ДлинаНаименования;
ДлинаНаименованияРаботы = Метаданные.Справочники.Автоработы.ДлинаНаименования;
