
&НаСервереБезКонтекста
Функция ПреобразоватьНомерТелефона(НомерТелефона) 
	Результат = Прав(сфпСофтФонПроСервер.сфпУбратьИзНомераТелефонаВсеПрефиксы(НомерТелефона), Константы.CRM_КоличествоХранимыхЦифрТелефона.Получить());
	Возврат Результат;
КонецФункции	

&НаСервереБезКонтекста
Функция ПреобразоватьНомерВнТелефона(НомерТелефона) 
	Результат = Прав(сфпСофтФонПроСервер.сфпУбратьИзНомераТелефонаВсеПрефиксы(НомерТелефона), Константы.CRM_МаксимальнаяДлинаВнутреннегоНомера.Получить());
	Возврат Результат;
КонецФункции	

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Если (НЕ ЗначениеЗаполнено(Запись.Пользователь) И НЕ ЗначениеЗаполнено(Запись.НомерВнТелефона) 
		И НЕ ЗначениеЗаполнено(Запись.Контакт) И НЕ ЗначениеЗаполнено(Запись.НомерТелефона)) Тогда
		Предупреждение(Нстр("ru = 'Необходимо заполнить хотя бы одно значение!'"));		
		Отказ = Истина;
	КонецЕсли;
	Если ЗначениеЗаполнено(Запись.НомерВнТелефона) Тогда
		Запись.НомерВнТелефона = ПреобразоватьНомерВнТелефона(Запись.НомерВнТелефона);
	КонецЕсли;	
	Если ЗначениеЗаполнено(Запись.НомерТелефона) Тогда
		Запись.НомерТелефона = ПреобразоватьНомерТелефона(Запись.НомерТелефона);
	КонецЕсли;	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Пользователь") Тогда
		Запись.Пользователь = Параметры.Пользователь;
	КонецЕсли;	
	Если Параметры.Свойство("НомерВнТелефона") Тогда
		Запись.НомерВнТелефона = Параметры.НомерВнТелефона;
	КонецЕсли;	
	Если Параметры.Свойство("Контакт") Тогда
		Запись.Контакт = Параметры.Контакт;
	КонецЕсли;	
	Если Параметры.Свойство("НомерТелефона") Тогда
		Запись.НомерТелефона = Параметры.НомерТелефона;
	КонецЕсли;	
	Если Параметры.Свойство("ОтборПоПользователю") Тогда
		Запись.Пользователь = Параметры.ОтборПоПользователю;
		ЭтаФорма.Элементы.Пользователь.ТолькоПросмотр = Истина;
	КонецЕсли;	
	Если Параметры.Свойство("ОтборПоКонтакту") Тогда
		Запись.Контакт = Параметры.ОтборПоКонтакту;
		ЭтаФорма.Элементы.Контакт.ТолькоПросмотр = Истина;
	КонецЕсли;	
КонецПроцедуры
