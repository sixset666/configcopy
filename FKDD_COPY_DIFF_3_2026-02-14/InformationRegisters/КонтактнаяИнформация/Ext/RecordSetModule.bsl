							  
Перем БезЗаписиКонтрагента Экспорт; //БАА 17/10/2023

Процедура ПередЗаписью(Отказ, Замещение)
	// проверка для предотвращения попытки полной зачистки регистра
	Если ЭтотОбъект.Количество() = 0 Тогда
		Если ОбЗначениеНеЗаполнено(ЭтотОбъект.Отбор.Объект.Значение) И
			ОбЗначениеНеЗаполнено(ЭтотОбъект.Отбор.Тип.Значение) И
			ОбЗначениеНеЗаполнено(ЭтотОбъект.Отбор.Вид.Значение) Тогда
			СтрокаОтказа = "";
			Отказ = Истина;
		КонецЕсли;
	КонецЕсли;
	
	// проверки оставлены в модуле на случай редактирования КИ в строке
	// Вообще проверка делается локально в каждой форме записи КИ
	Для Каждого Запись Из ЭтотОбъект Цикл
		
		Если ОбЗначениеНеЗаполнено(Запись.Объект) Тогда
			Отказ = Истина;
			СтрокаОтказа = "Не заполнено поле ""Владелец"". Запись невозможна!";
			Продолжить;
		КонецЕсли; 
		
		Если Запись.Объект.ЭтоГруппа Тогда
			Отказ = Истина;
			СтрокаОтказа = "Нельзя использовать группу в качестве объекта контактной информации.";
			Прервать;
		КонецЕсли;
		
		Если ОбЗначениеНеЗаполнено(Запись.Вид) Тогда
			Отказ = Истина;
			СтрокаОтказа = "Не заполнено поле ""Вид"". Запись невозможна!";
			Прервать;
		КонецЕсли;
		
		Если ОбЗначениеНеЗаполнено(Запись.Представление) Тогда
			Отказ = Истина;
			СтрокаОтказа = "Не заполнено представление контактной информации. Запись невозможна!";
			Прервать;
		КонецЕсли;
	КонецЦикла;
	
	Если Отказ Тогда
		Сообщить(СтрокаОтказа);
	КонецЕсли; 
	
КонецПроцедуры

//+СофтФон

Процедура ПриЗаписи(Отказ, Замещение)
	Возврат;
		Если НЕ Отказ Тогда
		Если ЗначениеЗаполнено(ЭтотОбъект.Отбор.Объект.Значение) И (ЭтотОбъект.Отбор.Объект.ВидСравнения = ВидСравнения.Равно) Тогда
			сфпСофтФонПроСервер.сфпЗаполнитьРегистрПоискаПоНомерам(ЭтотОбъект.Отбор.Объект.Значение);
		КонецЕсли;
	КонецЕсли;
	// Зарегистрируем изменения для контрагента
	Если НЕ Отказ Тогда
		ЗначениеОтбора = ЭтотОбъект.Отбор.Объект.Значение;
		
		// БИЗТЕХ КОВАЛЬ 26.08.2025 ++
		// Добавил проверку на битую ссылку ибо при удалении записей регистра не позволяет продвинуться дальше
		БитаяЛиСсылка = ЗначениеОтбора.ПолучитьОбъект() = Неопределено;
		// БИЗТЕХ КОВАЛЬ 26.08.2025 --
		
		Если ЗначениеЗаполнено(ЗначениеОтбора) И ТипЗнч(ЗначениеОтбора) = Тип("СправочникСсылка.Контрагенты") И БитаяЛиСсылка = Ложь Тогда
	ПланыОбмена.ОбменСМобильнымУстройством.ЗарегистрироватьИзмененияДляУзла(ЭтотОбъект.Отбор.Объект.Значение);
			//<<БАА 08.10.23
			Если Не БезЗаписиКонтрагента Тогда
	РегистрыСведений.КонтактнаяИнформация.ОбновитьКонтИнфоКонтрагента(ЗначениеОтбора);
			КонецЕсли;	
			//>>БАА
		КонецЕсли;
	КонецЕсли; 

КонецПроцедуры   
БезЗаписиКонтрагента = Ложь;
	
//-СофтФон
