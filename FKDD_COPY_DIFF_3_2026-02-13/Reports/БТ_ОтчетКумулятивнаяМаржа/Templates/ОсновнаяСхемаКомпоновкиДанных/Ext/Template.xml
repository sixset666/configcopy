<?xml version="1.0" encoding="UTF-8"?>
<DataCompositionSchema xmlns="http://v8.1c.ru/8.1/data-composition-system/schema" xmlns:dcscom="http://v8.1c.ru/8.1/data-composition-system/common" xmlns:dcscor="http://v8.1c.ru/8.1/data-composition-system/core" xmlns:dcsset="http://v8.1c.ru/8.1/data-composition-system/settings" xmlns:v8="http://v8.1c.ru/8.1/data/core" xmlns:v8ui="http://v8.1c.ru/8.1/data/ui" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
	<dataSource>
		<name>ИсточникДанных1</name>
		<dataSourceType>Local</dataSourceType>
	</dataSource>
	<dataSet xsi:type="DataSetQuery">
		<name>НаборДанных1</name>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаБонусыБезНДС</dataPath>
			<field>СуммаБонусыБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Возмещение и бонусы</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Количество</dataPath>
			<field>Количество</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Продажи авто, шт.</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВыручкаАвтоБезНДС</dataPath>
			<field>ВыручкаАвтоБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Выручка за авто</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ФинРезЖелезо</dataPath>
			<field>ФинРезЖелезо</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Финрез железо</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>СуммаКСОБезНДС</dataPath>
			<field>СуммаКСОБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>КСО общее</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПериодПродажи</dataPath>
			<field>ПериодПродажи</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Период продажи</v8:content>
				</v8:item>
			</title>
			<role>
				<dcscom:periodNumber>1</dcscom:periodNumber>
				<dcscom:periodType>Main</dcscom:periodType>
			</role>
			<appearance>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Формат</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ДФ='MMMM yyyy'</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</appearance>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КолвоТрейд</dataPath>
			<field>КолвоТрейд</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>ТРЕЙД, шт.</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПодразделениеКМ</dataPath>
			<field>ПодразделениеКМ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Подразделение КМ</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ФинРезЖелезоУД</dataPath>
			<field>ФинРезЖелезоУД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Финрез железо УД</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КСОУД</dataPath>
			<field>КСОУД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>КСО УД</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КМ</dataPath>
			<field>КМ</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Кумулятивная маржа</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>БонусыУД</dataPath>
			<field>БонусыУД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Возмещения и бонусы УД</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КМ_УД</dataPath>
			<field>КМ_УД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Кумулятивная маржа УД</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ВыручкаДоукБезНДС</dataPath>
			<field>ВыручкаДоукБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доукомплектация выручка</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходДОПБезНДС</dataPath>
			<field>ДоходДОПБезНДС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>ДОП доход</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>PRТрейд</dataPath>
			<field>PRТрейд</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>PR Трейд</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Трейд_СС</dataPath>
			<field>Трейд_СС</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Трейд себестоимость</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>Трейд_СС_УД</dataPath>
			<field>Трейд_СС_УД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Трейд себестоимость УД</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>НаценкаТрейд</dataPath>
			<field>НаценкаТрейд</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Наценка трейд</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходДОПБезНДС_УД</dataPath>
			<field>ДоходДОПБезНДС_УД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доп доход УД</v8:content>
				</v8:item>
			</title>
			<inputParameters>
				<dcscor:item>
					<dcscor:parameter>ФорматРедактирования</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>ЧДЦ=2</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</inputParameters>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ССАвтоПоступления</dataPath>
			<field>ССАвтоПоступления</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Себестоимость проданных авто</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПрогнозТрейд_УД</dataPath>
			<field>ПрогнозТрейд_УД</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Прогноз трейд УД</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ТрейдПрогноз</dataPath>
			<field>ТрейдПрогноз</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Трейд прогноз</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ДоходСервиса</dataPath>
			<field>ДоходСервиса</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Доход сервиса</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>КМ_Сервис</dataPath>
			<field>КМ_Сервис</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>КМ и Сервис</v8:content>
				</v8:item>
			</title>
		</field>
		<field xsi:type="DataSetFieldField">
			<dataPath>ПодразделениеКМДивизион</dataPath>
			<field>ПодразделениеКМДивизион</field>
			<title xsi:type="v8:LocalStringType">
				<v8:item>
					<v8:lang>ru</v8:lang>
					<v8:content>Подразделение КМДивизион</v8:content>
				</v8:item>
			</title>
		</field>
		<dataSource>ИсточникДанных1</dataSource>
		<query>ВЫБРАТЬ
	ОстаткиАвтомобилей.Партия КАК Партия,
	ОстаткиАвтомобилей.Период КАК ДатаПродажи,
	ЕСТЬNULL(ОстаткиАвтомобилей.Количество, 0) КАК Количество,
	ЕСТЬNULL(СУММА(ОстаткиАвтомобилей.Сумма - ОстаткиАвтомобилей.СуммаНДС), 0) КАК ССАвто,
	ВЫБОР
		КОГДА ОстаткиАвтомобилей.Регистратор.Организация &lt;&gt; ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.Организация
				И ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ.УчетПродажПоМенеджерам
			ТОГДА ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ
		ИНАЧЕ ОстаткиАвтомобилей.Регистратор.ПодразделениеКомпании
	КОНЕЦ КАК РегистраторПодразделениеКомпании,
	НАЧАЛОПЕРИОДА(ОстаткиАвтомобилей.Период, МЕСЯЦ) КАК ПериодПродажи,
	ВЫБОР
		КОГДА ОстаткиАвтомобилей.Регистратор.Организация &lt;&gt; ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.Организация
				И ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ.УчетПродажПоМенеджерам
			ТОГДА ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ
		ИНАЧЕ ОстаткиАвтомобилей.Регистратор.ПодразделениеКомпании.БТ_ПодразделениеКМ
	КОНЕЦ КАК ПодразделениеКМ,
	ОстаткиАвтомобилей.Регистратор.ДокументОснование КАК РегистраторДокументОснование,
	ОстаткиАвтомобилей.Регистратор КАК Реализация,
	ОстаткиАвтомобилей.Автомобиль КАК Автомобиль
ПОМЕСТИТЬ ВТ_Продажи
ИЗ
	РегистрНакопления.ОстаткиАвтомобилей КАК ОстаткиАвтомобилей
ГДЕ
	ОстаткиАвтомобилей.Период МЕЖДУ &amp;ДатаНач И &amp;ДатаКон
	И ОстаткиАвтомобилей.Регистратор ССЫЛКА Документ.РеализацияАвтомобилей
	И НЕ ОстаткиАвтомобилей.Регистратор.Контрагент В
				(ВЫБРАТЬ
					БТ_КонтрагентыИсключенияПриФормированииКуммаржи.Контрагенты КАК Контрагенты
				ИЗ
					РегистрСведений.БТ_КонтрагентыИсключенияПриФормированииКуммаржи КАК БТ_КонтрагентыИсключенияПриФормированииКуммаржи)
	И НЕ ОстаткиАвтомобилей.СкладКомпании.тт_КатегорияСклада.Код = "000000009"
	И НЕ ОстаткиАвтомобилей.СкладКомпании.тт_КатегорияСклада.Код = "000000011"

СГРУППИРОВАТЬ ПО
	ОстаткиАвтомобилей.Партия,
	ОстаткиАвтомобилей.Период,
	ОстаткиАвтомобилей.Количество,
	НАЧАЛОПЕРИОДА(ОстаткиАвтомобилей.Период, МЕСЯЦ),
	ОстаткиАвтомобилей.Регистратор.ДокументОснование,
	ОстаткиАвтомобилей.Регистратор,
	ОстаткиАвтомобилей.Автомобиль,
	ВЫБОР
		КОГДА ОстаткиАвтомобилей.Регистратор.Организация &lt;&gt; ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.Организация
				И ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ.УчетПродажПоМенеджерам
			ТОГДА ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ
		ИНАЧЕ ОстаткиАвтомобилей.Регистратор.ПодразделениеКомпании
	КОНЕЦ,
	ВЫБОР
		КОГДА ОстаткиАвтомобилей.Регистратор.Организация &lt;&gt; ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.Организация
				И ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ.УчетПродажПоМенеджерам
			ТОГДА ОстаткиАвтомобилей.Регистратор.БТ_ПодразелениеМенеджераКМ.БТ_ПодразделениеКМ
		ИНАЧЕ ОстаткиАвтомобилей.Регистратор.ПодразделениеКомпании.БТ_ПодразделениеКМ
	КОНЕЦ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ОстаткиАвтомобилей.Период КАК ДатаПоступления,
	ОстаткиАвтомобилей.Автомобиль КАК Автомобиль,
	ВТ_Продажи.ДатаПродажи КАК ДатаПродажи,
	ЕСТЬNULL(ВТ_Продажи.Количество, 0) КАК Количество,
	ЕСТЬNULL(ВТ_Продажи.ССАвто, 0) КАК ССАвто,
	ВТ_Продажи.РегистраторПодразделениеКомпании КАК РегистраторПодразделениеКомпании,
	ВТ_Продажи.ПериодПродажи КАК ПериодПродажи,
	ВТ_Продажи.ПодразделениеКМ КАК ПодразделениеКМ,
	ВТ_Продажи.РегистраторДокументОснование КАК РегистраторДокументОснование,
	ВТ_Продажи.Реализация КАК Реализация,
	ЕСТЬNULL(ОстаткиАвтомобилей.Сумма, 0) - ЕСТЬNULL(ОстаткиАвтомобилей.СуммаНДС, 0) + ЕСТЬNULL(ВложенныйЗапрос.КорректировкаПоступления, 0) КАК ССАвтоПоступления,
	ЕСТЬNULL(ВложенныйЗапрос.КорректировкаПоступления, 0) КАК КорректировкаПоступления
ПОМЕСТИТЬ ВТ_ПродажиАвтоСС
ИЗ
	ВТ_Продажи КАК ВТ_Продажи
		ВНУТРЕННЕЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиАвтомобилей КАК ОстаткиАвтомобилей
		ПО ВТ_Продажи.Партия = ОстаткиАвтомобилей.Регистратор
			И ВТ_Продажи.Автомобиль = ОстаткиАвтомобилей.Автомобиль
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			СУММА(ЕСТЬNULL(ОстаткиАвтомобилей.Сумма, 0) - ЕСТЬNULL(ОстаткиАвтомобилей.СуммаНДС, 0)) КАК КорректировкаПоступления,
			ОстаткиАвтомобилей.Автомобиль КАК Автомобиль,
			ОстаткиАвтомобилей.Партия КАК Партия
		ИЗ
			РегистрНакопления.ОстаткиАвтомобилей КАК ОстаткиАвтомобилей
		ГДЕ
			ОстаткиАвтомобилей.Регистратор.Ссылка = (ВЫРАЗИТЬ(ОстаткиАвтомобилей.Регистратор.Ссылка КАК Документ.КорректировкаПоступленияАвтомобилей))
		
		СГРУППИРОВАТЬ ПО
			ОстаткиАвтомобилей.Партия,
			ОстаткиАвтомобилей.Автомобиль) КАК ВложенныйЗапрос
		ПО ВТ_Продажи.Партия = ВложенныйЗапрос.Партия
			И ВТ_Продажи.Автомобиль = ВложенныйЗапрос.Автомобиль
ГДЕ
	ОстаткиАвтомобилей.СтатусПартии = ЗНАЧЕНИЕ(Перечисление.СтатусыПартий.ТоварКупленный)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ВЫБОР
			КОГДА ЗаказНарядТовары.Ссылка.ВидРемонта.Код = "ЦБ000017"
				ТОГДА ЕСТЬNULL(ЗаказНарядТовары.СуммаВсего, 0) - ЕСТЬNULL(ЗаказНарядТовары.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК ЗЧ_Доук_БезНДС,
	СУММА(0) КАК Работ_Доук_БезНДС,
	СУММА(ВЫБОР
			КОГДА ЗаказНарядТовары.Ссылка.ВидРемонта.Код = "00000001"
				ТОГДА ЕСТЬNULL(ЗаказНарядТовары.СуммаВсего, 0) - ЕСТЬNULL(ЗаказНарядТовары.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК ЗЧ_Доп_БезНДС,
	СУММА(0) КАК Работ_Доп_БезНДС,
	ЗаказНарядТовары.Ссылка КАК Ссылка,
	ВТ_ПродажиАвтоСС.Автомобиль КАК Автомобиль
ПОМЕСТИТЬ ВТ_ЗН_ДД
ИЗ
	ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаряд.Товары КАК ЗаказНарядТовары
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ЗаказНарядТовары.Ссылка.Автомобиль
ГДЕ
	ЗаказНарядТовары.Ссылка.Дата &lt;= КОНЕЦПЕРИОДА(ВТ_ПродажиАвтоСС.ДатаПродажи, ДЕНЬ)
	И ЗаказНарядТовары.Ссылка.Дата &gt; ВТ_ПродажиАвтоСС.ДатаПоступления
	И ЗаказНарядТовары.Ссылка.Проведен
	И (ЗаказНарядТовары.Ссылка.ВидРемонта.Код = "ЦБ000017"
			ИЛИ ЗаказНарядТовары.Ссылка.ВидРемонта.Код = "00000001")

СГРУППИРОВАТЬ ПО
	ЗаказНарядТовары.Ссылка,
	ВТ_ПродажиАвтоСС.Автомобиль

ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
	СУММА(0),
	СУММА(ВЫБОР
			КОГДА ЗаказНарядРаботы.Ссылка.ВидРемонта.Код = "ЦБ000017"
				ТОГДА ЕСТЬNULL(ЗаказНарядРаботы.СуммаВсего, 0) - ЕСТЬNULL(ЗаказНарядРаботы.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ),
	СУММА(0),
	СУММА(ВЫБОР
			КОГДА ЗаказНарядРаботы.Ссылка.ВидРемонта.Код = "00000001"
				ТОГДА ЕСТЬNULL(ЗаказНарядРаботы.СуммаВсего, 0) - ЕСТЬNULL(ЗаказНарядРаботы.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ),
	ЗаказНарядРаботы.Ссылка,
	ВТ_ПродажиАвтоСС.Автомобиль
ИЗ
	ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ЗаказНаряд.Работы КАК ЗаказНарядРаботы
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ЗаказНарядРаботы.Ссылка.Автомобиль
ГДЕ
	ЗаказНарядРаботы.Ссылка.Проведен
	И ЗаказНарядРаботы.Ссылка.Дата &lt;= ВТ_ПродажиАвтоСС.ДатаПродажи
	И ЗаказНарядРаботы.Ссылка.Дата &gt; ВТ_ПродажиАвтоСС.ДатаПоступления
	И (ЗаказНарядРаботы.Ссылка.ВидРемонта.Код = "00000001"
			ИЛИ ЗаказНарядРаботы.Ссылка.ВидРемонта.Код = "ЦБ000017")

СГРУППИРОВАТЬ ПО
	ЗаказНарядРаботы.Ссылка,
	ВТ_ПродажиАвтоСС.Автомобиль
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ЗН_ДД.Автомобиль КАК Автомобиль,
	СУММА(ВТ_ЗН_ДД.ЗЧ_Доук_БезНДС) КАК ЗЧ_Доук_БезНДС,
	СУММА(ВТ_ЗН_ДД.Работ_Доук_БезНДС) КАК Работ_Доук_БезНДС,
	СУММА(ВТ_ЗН_ДД.ЗЧ_Доп_БезНДС) КАК ЗЧ_Доп_БезНДС,
	СУММА(ВТ_ЗН_ДД.Работ_Доп_БезНДС) КАК Работ_Доп_БезНДС,
	ВТ_ЗН_ДД.Ссылка КАК Ссылка
ПОМЕСТИТЬ ВТ_ЗН_ДД_Свертка
ИЗ
	ВТ_ЗН_ДД КАК ВТ_ЗН_ДД

СГРУППИРОВАТЬ ПО
	ВТ_ЗН_ДД.Автомобиль,
	ВТ_ЗН_ДД.Ссылка
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ТоварыВПроизводстве.Регистратор КАК Регистратор,
	СУММА(ВЫБОР
			КОГДА ТоварыВПроизводстве.Регистратор.ВидРемонта.Код = "ЦБ000017"
				ТОГДА ЕСТЬNULL(ТоварыВПроизводстве.Сумма, 0) - ЕСТЬNULL(ТоварыВПроизводстве.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК СС_ЗЧ_Доук_БезНДС,
	СУММА(ВЫБОР
			КОГДА ТоварыВПроизводстве.Регистратор.ВидРемонта.Код = "00000001"
				ТОГДА ЕСТЬNULL(ТоварыВПроизводстве.Сумма, 0) - ЕСТЬNULL(ТоварыВПроизводстве.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК СС_ЗЧ_ДОП_БезНДС
ПОМЕСТИТЬ ВТ_ССЗЧ
ИЗ
	РегистрНакопления.ТоварыВПроизводстве КАК ТоварыВПроизводстве
ГДЕ
	ТоварыВПроизводстве.ЗаказНаряд.Автомобиль В
			(ВЫБРАТЬ
				ВТ_ПродажиАвтоСС.Автомобиль КАК Автомобиль
			ИЗ
				ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
			СГРУППИРОВАТЬ ПО
				ВТ_ПродажиАвтоСС.Автомобиль)
	И (ТоварыВПроизводстве.ЗаказНаряд.ВидРемонта.Код = "ЦБ000017"
			ИЛИ ТоварыВПроизводстве.ЗаказНаряд.ВидРемонта.Код = "00000001")

СГРУППИРОВАТЬ ПО
	ТоварыВПроизводстве.Регистратор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ВЫБОР
			КОГДА Субподряд.ЗаказНаряд.ВидРемонта.Код = "ЦБ000017"
				ТОГДА ЕСТЬNULL(Субподряд.Себестоимость, 0) - ЕСТЬNULL(Субподряд.СуммаНДСВходящий, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК Выручка_Суб_Доук_БезНДС,
	СУММА(ВЫБОР
			КОГДА Субподряд.ЗаказНаряд.ВидРемонта.Код = "00000001"
				ТОГДА ЕСТЬNULL(Субподряд.Себестоимость, 0) - ЕСТЬNULL(Субподряд.СуммаНДСВходящий, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК Выручка_Суб_Доп_БезНДС,
	Субподряд.ЗаказНаряд КАК ЗаказНаряд
ПОМЕСТИТЬ ВТ_Субподряд
ИЗ
	РегистрНакопления.Субподряд КАК Субподряд
ГДЕ
	Субподряд.ЗаказНаряд.Автомобиль В
			(ВЫБРАТЬ
				ВТ_ПродажиАвтоСС.Автомобиль КАК Автомобиль
			ИЗ
				ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
			СГРУППИРОВАТЬ ПО
				ВТ_ПродажиАвтоСС.Автомобиль)
	И (Субподряд.ЗаказНаряд.ВидРемонта.Код = "ЦБ000017"
			ИЛИ Субподряд.ЗаказНаряд.ВидРемонта.Код = "00000001")

СГРУППИРОВАТЬ ПО
	Субподряд.ЗаказНаряд
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_ЗН_ДД_Свертка.Автомобиль КАК Автомобиль,
	СУММА(ВТ_ЗН_ДД_Свертка.ЗЧ_Доук_БезНДС) КАК ЗЧ_Доук_БезНДС,
	СУММА(ВТ_ЗН_ДД_Свертка.Работ_Доук_БезНДС) КАК Работ_Доук_БезНДС,
	СУММА(ВТ_ЗН_ДД_Свертка.ЗЧ_Доп_БезНДС) КАК ЗЧ_Доп_БезНДС,
	СУММА(ВТ_ЗН_ДД_Свертка.Работ_Доп_БезНДС) КАК Работ_Доп_БезНДС,
	СУММА(ВТ_ССЗЧ.СС_ЗЧ_Доук_БезНДС) КАК СС_ЗЧ_Доук_БезНДС,
	СУММА(ВТ_ССЗЧ.СС_ЗЧ_ДОП_БезНДС) КАК СС_ЗЧ_ДОП_БезНДС,
	СУММА(ВТ_Субподряд.Выручка_Суб_Доук_БезНДС) КАК Выручка_Суб_Доук_БезНДС,
	СУММА(ВТ_Субподряд.Выручка_Суб_Доп_БезНДС) КАК Выручка_Суб_Доп_БезНДС
ПОМЕСТИТЬ ВТ_ЗН_ДД_Итог
ИЗ
	ВТ_ЗН_ДД_Свертка КАК ВТ_ЗН_ДД_Свертка
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ССЗЧ КАК ВТ_ССЗЧ
		ПО ВТ_ЗН_ДД_Свертка.Ссылка = ВТ_ССЗЧ.Регистратор
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Субподряд КАК ВТ_Субподряд
		ПО ВТ_ЗН_ДД_Свертка.Ссылка = ВТ_Субподряд.ЗаказНаряд

СГРУППИРОВАТЬ ПО
	ВТ_ЗН_ДД_Свертка.Автомобиль
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(1) КАК КолвоТрейд,
	ЗначенияСвойствОбъектов.Объект КАК ПоступлениеБУ,
	ЗначенияСвойствОбъектов.Значение КАК ЗНА
ПОМЕСТИТЬ ВТ_Трейд
ИЗ
	РегистрСведений.ЗначенияСвойствОбъектов КАК ЗначенияСвойствОбъектов
ГДЕ
	ЗначенияСвойствОбъектов.Свойство = ЗНАЧЕНИЕ(планвидовхарактеристик.свойстваобъектов.заказнаавтомобиль)
	И ЗначенияСвойствОбъектов.Значение.Ссылка ССЫЛКА Документ.ЗаказНаАвтомобиль
	И ЗначенияСвойствОбъектов.Значение.Автомобиль В
			(ВЫБРАТЬ
				ВТ_ПродажиАвтоСС.Автомобиль КАК Автомобиль
			ИЗ
				ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
			СГРУППИРОВАТЬ ПО
				ВТ_ПродажиАвтоСС.Автомобиль)

СГРУППИРОВАТЬ ПО
	ЗначенияСвойствОбъектов.Объект,
	ЗначенияСвойствОбъектов.Значение
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ВТ_Трейд.КолвоТрейд) КАК КолвоТрейд,
	СУММА(ЕСТЬNULL(ПоступлениеАвтомобилейАвтомобили.Сумма, 0) - ЕСТЬNULL(ПоступлениеАвтомобилейАвтомобили.СуммаНДС, 0)) КАК Трейд_ССБезНДС,
	ВТ_Трейд.ЗНА КАК ЗНА,
	ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0) КАК ПрогнозТрейд
ПОМЕСТИТЬ ВТ_Трейд_СС
ИЗ
	ВТ_Трейд КАК ВТ_Трейд
		ЛЕВОЕ СОЕДИНЕНИЕ Документ.ПоступлениеАвтомобилей.Автомобили КАК ПоступлениеАвтомобилейАвтомобили
		ПО ВТ_Трейд.ПоступлениеБУ = ПоступлениеАвтомобилейАвтомобили.Ссылка
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЭМ_КумулятивнаяМаржа КАК ЭМ_КумулятивнаяМаржа
		ПО ВТ_Трейд.ЗНА = ЭМ_КумулятивнаяМаржа.РеализацияАвтомобиля.ДокументОснование
			И (ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМАржи.ПрогнозМаржаТрейдИН))

СГРУППИРОВАТЬ ПО
	ВТ_Трейд.ЗНА,
	ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0)
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЭМ_КумулятивнаяМаржа.Автомобиль КАК Автомобиль,
	СУММА(ВЫБОР
			КОГДА ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.АВКредитЛизинг)
					ИЛИ ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.КВКАСКО)
					ИЛИ ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.КВОСАГО)
					ИЛИ ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.КВГЭП)
					ИЛИ ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.КВСЖ)
					ИЛИ ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМаржи.КВКартаПомощи)
				ТОГДА ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК СуммаКСОБезНДС,
	СУММА(ВЫБОР
			КОГДА ЭМ_КумулятивнаяМаржа.Показатель В (&amp;Бонусы)
				ТОГДА ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК СуммаБонусыБезНДС,
	ВТ_ПродажиАвтоСС.Реализация КАК Реализация
ПОМЕСТИТЬ ВТ_КСО
ИЗ
	ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЭМ_КумулятивнаяМаржа КАК ЭМ_КумулятивнаяМаржа
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ЭМ_КумулятивнаяМаржа.Автомобиль
			И ВТ_ПродажиАвтоСС.Реализация = ЭМ_КумулятивнаяМаржа.РеализацияАвтомобиля

СГРУППИРОВАТЬ ПО
	ЭМ_КумулятивнаяМаржа.Автомобиль,
	ВТ_ПродажиАвтоСС.Реализация
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ЕСТЬNULL(Продажи.Сумма, 0) - ЕСТЬNULL(Продажи.СуммаНДС, 0)) КАК ВыручкаСервисаБезНДС,
	Продажи.ПодразделениеКомпании КАК ПодразделениеКомпании,
	Продажи.ПодразделениеКомпании.БТ_ПодразделениеКМ КАК ПодразделениеКМ,
	НАЧАЛОПЕРИОДА(Продажи.Период, МЕСЯЦ) КАК ПериодСервиса,
	СУММА(ЕСТЬNULL(Продажи.Себестоимость, 0) - ЕСТЬNULL(Продажи.СуммаНДСВходящий, 0)) КАК ССЗЧ_БезНДС,
	Продажи.Регистратор КАК Регистратор
ПОМЕСТИТЬ ВТ_ЗН
ИЗ
	РегистрНакопления.Продажи КАК Продажи
ГДЕ
	Продажи.Регистратор ССЫЛКА Документ.ЗаказНаряд
	И Продажи.Период МЕЖДУ &amp;ДатаНач И &amp;ДатаКОн
	И (Продажи.Регистратор.ВидРемонта.Наименование = "Техническое обслуживание (ТО)"
			ИЛИ Продажи.Регистратор.ВидРемонта.Наименование = "Сервисный клиентский заказ"
			ИЛИ Продажи.Регистратор.ВидРемонта.Наименование = "Гарантийный заказ"
			ИЛИ Продажи.Регистратор.ВидРемонта.Наименование = "Ремонт автомобилей сотрудников"
			ИЛИ Продажи.Регистратор.ВидРемонта.Наименование = "Страховой ремонт")

СГРУППИРОВАТЬ ПО
	Продажи.ПодразделениеКомпании,
	Продажи.ПодразделениеКомпании.БТ_ПодразделениеКМ,
	НАЧАЛОПЕРИОДА(Продажи.Период, МЕСЯЦ),
	Продажи.Регистратор
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ЕСТЬNULL(Субподряд.СебестоимостьУпр, 0)) КАК СС_СубподрядБезНДС,
	Субподряд.ЗаказНаряд КАК ЗаказНаряд
ПОМЕСТИТЬ ВТ_Суб
ИЗ
	РегистрНакопления.Субподряд КАК Субподряд
ГДЕ
	Субподряд.ЗаказНаряд В
			(ВЫБРАТЬ
				ВТ_ЗН.Регистратор КАК Регистратор
			ИЗ
				ВТ_ЗН КАК ВТ_ЗН
			СГРУППИРОВАТЬ ПО
				ВТ_ЗН.Регистратор)

СГРУППИРОВАТЬ ПО
	Субподряд.ЗаказНаряд
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ЕСТЬNULL(ВТ_ЗН.ВыручкаСервисаБезНДС, 0)) КАК ВыручкаСервисаБезНДС,
	ВТ_ЗН.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ВТ_ЗН.ПодразделениеКМ КАК ПодразделениеКМ,
	ВТ_ЗН.ПериодСервиса КАК ПериодСервиса,
	СУММА(ЕСТЬNULL(ВТ_ЗН.ССЗЧ_БезНДС, 0)) КАК ССЗЧ_БезНДС,
	СУММА(ЕСТЬNULL(ВТ_Суб.СС_СубподрядБезНДС, 0)) КАК СС_СубподрядБезНДС
ПОМЕСТИТЬ ВТ_Сервис
ИЗ
	ВТ_ЗН КАК ВТ_ЗН
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Суб КАК ВТ_Суб
		ПО ВТ_ЗН.Регистратор = ВТ_Суб.ЗаказНаряд

СГРУППИРОВАТЬ ПО
	ВТ_ЗН.ПодразделениеКомпании,
	ВТ_ЗН.ПодразделениеКМ,
	ВТ_ЗН.ПериодСервиса
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ЭМ_КумулятивнаяМаржа.РеализацияАвтомобиля КАК РеализацияАвтомобиля,
	СУММА(ВЫБОР
			КОГДА ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМАржи.БонусДистрибьютораГодовой)
				ТОГДА ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК РасходыНаЭвакуатор,
	ЭМ_КумулятивнаяМаржа.Автомобиль КАК Автомобиль,
	СУММА(ВЫБОР
			КОГДА ЭМ_КумулятивнаяМаржа.Показатель = ЗНАЧЕНИЕ(Справочник.ЭМ_ПоказателиКумулятивнойМАржи.МаржаАвтомобиля)
				ТОГДА ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.Сумма, 0) - ЕСТЬNULL(ЭМ_КумулятивнаяМаржа.СуммаНДС, 0)
			ИНАЧЕ 0
		КОНЕЦ) КАК МаржаАвтомобиля
ПОМЕСТИТЬ ВТ_РасходыНаЭвакуатор
ИЗ
	ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ЭМ_КумулятивнаяМаржа КАК ЭМ_КумулятивнаяМаржа
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ЭМ_КумулятивнаяМаржа.Автомобиль
			И ВТ_ПродажиАвтоСС.Реализация = ЭМ_КумулятивнаяМаржа.РеализацияАвтомобиля
ГДЕ
	ЭМ_КумулятивнаяМаржа.Автомобиль В
			(ВЫБРАТЬ
				ВТ_ПродажиАвтоСС.Автомобиль КАК Автомобиль
			ИЗ
				ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
			СГРУППИРОВАТЬ ПО
				ВТ_ПродажиАвтоСС.Автомобиль)

СГРУППИРОВАТЬ ПО
	ЭМ_КумулятивнаяМаржа.Автомобиль,
	ЭМ_КумулятивнаяМаржа.РеализацияАвтомобиля
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	СУММА(ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)) КАК Количество,
	СУММА(ЕСТЬNULL(ВТ_ПродажиАвтоСС.ССАвто, 0)) КАК ССАвто,
	СУММА(ЕСТЬNULL(ПродажиАвтомобилей.Сумма, 0) - ЕСТЬNULL(ПродажиАвтомобилей.СуммаНДС, 0)) КАК ВыручкаАвтоБезНДС,
	СУММА(ЕСТЬNULL(ВТ_КСО.СуммаКСОБезНДС, 0)) КАК СуммаКСОБезНДС,
	СУММА(ЕСТЬNULL(ВТ_КСО.СуммаБонусыБезНДС, 0)) КАК СуммаБонусыБезНДС,
	ВТ_ПродажиАвтоСС.ПериодПродажи КАК ПериодПродажи,
	ВТ_ПродажиАвтоСС.ПодразделениеКМ КАК ПодразделениеКМ,
	СУММА(ВТ_ЗН_ДД_Итог.ЗЧ_Доук_БезНДС + ВТ_ЗН_ДД_Итог.Работ_Доук_БезНДС) КАК ВыручкаДоукБезНДС,
	СУММА(ЕСТЬNULL(ВТ_ЗН_ДД_Итог.ЗЧ_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.ЗЧ_Доук_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Работ_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Работ_Доук_БезНДС, 0) - (ЕСТЬNULL(ВТ_ЗН_ДД_Итог.СС_ЗЧ_ДОП_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.СС_ЗЧ_Доук_БезНДС, 0)) - (ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Выручка_Суб_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Выручка_Суб_Доук_БезНДС, 0))) КАК ДоходДОПБезНДС,
	СУММА(ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.МаржаАвтомобиля, 0) - ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.РасходыНаЭвакуатор, 0)) КАК ФинРезЖелезо,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ (ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.МаржаАвтомобиля, 0) - ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.РасходыНаЭвакуатор, 0)) / ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)
		КОНЕЦ) КАК ФинРезЖелезоУД,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_КСО.СуммаКСОБезНДС, 0) / ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)
		КОНЕЦ) КАК КСОУД,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_КСО.СуммаБонусыБезНДС, 0) / ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)
		КОНЕЦ) КАК БонусыУД,
	СУММА(ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0)) КАК КолвоТрейд,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0) / ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)
		КОНЕЦ) КАК PRТрейд,
	СУММА(ЕСТЬNULL(ВТ_Трейд_СС.Трейд_ССБезНДС, 0)) КАК Трейд_СС,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_Трейд_СС.Трейд_ССБезНДС, 0) / ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0)
		КОНЕЦ) КАК Трейд_СС_УД,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ (ЕСТЬNULL(ВТ_ЗН_ДД_Итог.ЗЧ_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.ЗЧ_Доук_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Работ_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Работ_Доук_БезНДС, 0) - (ЕСТЬNULL(ВТ_ЗН_ДД_Итог.СС_ЗЧ_ДОП_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.СС_ЗЧ_Доук_БезНДС, 0)) - (ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Выручка_Суб_Доп_БезНДС, 0) + ЕСТЬNULL(ВТ_ЗН_ДД_Итог.Выручка_Суб_Доук_БезНДС, 0))) / ЕСТЬNULL(ВТ_ПродажиАвтоСС.Количество, 0)
		КОНЕЦ) КАК ДоходДОПБезНДС_УД,
	СУММА(ЕСТЬNULL(ПродажиАвтомобилей.Сумма, 0) - ЕСТЬNULL(ПродажиАвтомобилей.СуммаНДС, 0) - (ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.МаржаАвтомобиля, 0) - ЕСТЬNULL(ВТ_РасходыНаЭвакуатор.РасходыНаЭвакуатор, 0))) КАК ССАвтоПоступления,
	СУММА(ЕСТЬNULL(ВТ_Трейд_СС.ПрогнозТрейд, 0)) КАК ПрогнозТрейд,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_Трейд_СС.ПрогнозТрейд, 0) / ЕСТЬNULL(ВТ_Трейд_СС.КолвоТрейд, 0)
		КОНЕЦ) КАК ПрогнозТрейд_УД,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Трейд_СС.Трейд_ССБезНДС, 0) = 0
				ТОГДА 0
			ИНАЧЕ ЕСТЬNULL(ВТ_Трейд_СС.ПрогнозТрейд, 0) / ЕСТЬNULL(ВТ_Трейд_СС.Трейд_ССБезНДС, 0)
		КОНЕЦ) КАК НаценкаТрейд
ПОМЕСТИТЬ ВТ_Авто_Свернутый
ИЗ
	ВТ_ПродажиАвтоСС КАК ВТ_ПродажиАвтоСС
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ПродажиАвтомобилей КАК ПродажиАвтомобилей
		ПО ВТ_ПродажиАвтоСС.Реализация = ПродажиАвтомобилей.Регистратор
			И ВТ_ПродажиАвтоСС.Автомобиль = ПродажиАвтомобилей.Автомобиль
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_КСО КАК ВТ_КСО
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ВТ_КСО.Автомобиль
			И ВТ_ПродажиАвтоСС.Реализация = ВТ_КСО.Реализация
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЗН_ДД_Итог КАК ВТ_ЗН_ДД_Итог
		ПО ВТ_ПродажиАвтоСС.Автомобиль = ВТ_ЗН_ДД_Итог.Автомобиль
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Трейд_СС КАК ВТ_Трейд_СС
		ПО ВТ_ПродажиАвтоСС.Реализация.ДокументОснование = ВТ_Трейд_СС.ЗНА
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_РасходыНаЭвакуатор КАК ВТ_РасходыНаЭвакуатор
		ПО ВТ_ПродажиАвтоСС.Реализация = ВТ_РасходыНаЭвакуатор.РеализацияАвтомобиля
ГДЕ
	ПродажиАвтомобилей.Период МЕЖДУ &amp;ДатаНач И &amp;ДатаКон

СГРУППИРОВАТЬ ПО
	ВТ_ПродажиАвтоСС.ПериодПродажи,
	ВТ_ПродажиАвтоСС.ПодразделениеКМ
;

////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
	ВТ_Авто_Свернутый.ПериодПродажи КАК ПериодПродажи,
	ВТ_Авто_Свернутый.ПодразделениеКМ КАК ПодразделениеКМ,
	СУММА(ВТ_Авто_Свернутый.Количество) КАК Количество,
	ВТ_Авто_Свернутый.ССАвтоПоступления КАК ССАвтоПоступления,
	СУММА(ВТ_Авто_Свернутый.ВыручкаАвтоБезНДС) КАК ВыручкаАвтоБезНДС,
	СУММА(ВТ_Авто_Свернутый.СуммаКСОБезНДС) КАК СуммаКСОБезНДС,
	СУММА(ВТ_Авто_Свернутый.СуммаБонусыБезНДС) КАК СуммаБонусыБезНДС,
	СУММА(ВТ_Авто_Свернутый.ВыручкаДоукБезНДС) КАК ВыручкаДоукБезНДС,
	СУММА(ВТ_Авто_Свернутый.ДоходДОПБезНДС) КАК ДоходДОПБезНДС,
	СУММА(ВТ_Авто_Свернутый.ФинРезЖелезо) КАК ФинРезЖелезо,
	СУММА(ВТ_Авто_Свернутый.ФинРезЖелезоУД) КАК ФинРезЖелезоУД,
	СУММА(ВТ_Авто_Свернутый.КСОУД) КАК КСОУД,
	СУММА(ВТ_Авто_Свернутый.БонусыУД) КАК БонусыУД,
	СУММА(ВТ_Авто_Свернутый.КолвоТрейд) КАК КолвоТрейд,
	СУММА(ВТ_Авто_Свернутый.PRТрейд) КАК PRТрейд,
	СУММА(ВТ_Авто_Свернутый.Трейд_СС) КАК Трейд_СС,
	СУММА(ВТ_Авто_Свернутый.Трейд_СС_УД) КАК Трейд_СС_УД,
	СУММА(ВТ_Авто_Свернутый.ДоходДОПБезНДС_УД) КАК ДоходДОПБезНДС_УД,
	СУММА(ВТ_Авто_Свернутый.ПрогнозТрейд) КАК ТрейдПрогноз,
	СУММА(ВТ_Авто_Свернутый.ПрогнозТрейд_УД) КАК ПрогнозТрейд_УД,
	СУММА(ВТ_Авто_Свернутый.НаценкаТрейд) КАК НаценкаТрейд,
	СУММА(ВТ_Авто_Свернутый.ФинРезЖелезо + ВТ_Авто_Свернутый.ДоходДОПБезНДС + ВТ_Авто_Свернутый.СуммаКСОБезНДС + ВТ_Авто_Свернутый.ПрогнозТрейд + ВТ_Авто_Свернутый.СуммаБонусыБезНДС) КАК КМ,
	СУММА(ВЫБОР
			КОГДА ЕСТЬNULL(ВТ_Авто_Свернутый.Количество, 0) = 0
				ТОГДА 0
			ИНАЧЕ (ВТ_Авто_Свернутый.ФинРезЖелезо + ВТ_Авто_Свернутый.ДоходДОПБезНДС + ВТ_Авто_Свернутый.СуммаКСОБезНДС + ВТ_Авто_Свернутый.ПрогнозТрейд + ВТ_Авто_Свернутый.СуммаБонусыБезНДС) / ЕСТЬNULL(ВТ_Авто_Свернутый.Количество, 0)
		КОНЕЦ) КАК КМ_УД,
	ЕСТЬNULL(ВТ_Сервис.ВыручкаСервисаБезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.ССЗЧ_БезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.СС_СубподрядБезНДС, 0) КАК ДоходСервиса,
	ВТ_Авто_Свернутый.ФинРезЖелезо + ВТ_Авто_Свернутый.ДоходДОПБезНДС + ВТ_Авто_Свернутый.СуммаКСОБезНДС + ВТ_Авто_Свернутый.ПрогнозТрейд + ВТ_Авто_Свернутый.СуммаБонусыБезНДС + ЕСТЬNULL(ВТ_Сервис.ВыручкаСервисаБезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.ССЗЧ_БезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.СС_СубподрядБезНДС, 0) КАК КМ_Сервис,
	ВТ_Авто_Свернутый.ПодразделениеКМ.Дивизион КАК ПодразделениеКМДивизион
ИЗ
	ВТ_Авто_Свернутый КАК ВТ_Авто_Свернутый
		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_Сервис КАК ВТ_Сервис
		ПО ВТ_Авто_Свернутый.ПодразделениеКМ = ВТ_Сервис.ПодразделениеКМ
			И ВТ_Авто_Свернутый.ПериодПродажи = ВТ_Сервис.ПериодСервиса

СГРУППИРОВАТЬ ПО
	ВТ_Авто_Свернутый.ПериодПродажи,
	ВТ_Авто_Свернутый.ПодразделениеКМ,
	ВТ_Авто_Свернутый.ССАвтоПоступления,
	ЕСТЬNULL(ВТ_Сервис.ВыручкаСервисаБезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.ССЗЧ_БезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.СС_СубподрядБезНДС, 0),
	ВТ_Авто_Свернутый.ПодразделениеКМ.Дивизион,
	ВТ_Авто_Свернутый.ФинРезЖелезо + ВТ_Авто_Свернутый.ДоходДОПБезНДС + ВТ_Авто_Свернутый.СуммаКСОБезНДС + ВТ_Авто_Свернутый.ПрогнозТрейд + ВТ_Авто_Свернутый.СуммаБонусыБезНДС + ЕСТЬNULL(ВТ_Сервис.ВыручкаСервисаБезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.ССЗЧ_БезНДС, 0) - ЕСТЬNULL(ВТ_Сервис.СС_СубподрядБезНДС, 0)</query>
	</dataSet>
	<totalField>
		<dataPath>ВыручкаАвтоБезНДС</dataPath>
		<expression>Сумма(ВыручкаАвтоБезНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>ВыручкаДоукБезНДС</dataPath>
		<expression>Сумма(ВыручкаДоукБезНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>ДоходДОПБезНДС</dataPath>
		<expression>Сумма(ДоходДОПБезНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>КМ</dataPath>
		<expression>Сумма(КМ)</expression>
	</totalField>
	<totalField>
		<dataPath>КолвоТрейд</dataPath>
		<expression>Сумма(КолвоТрейд)</expression>
	</totalField>
	<totalField>
		<dataPath>Количество</dataPath>
		<expression>Сумма(Количество)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаБонусыБезНДС</dataPath>
		<expression>Сумма(СуммаБонусыБезНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>СуммаКСОБезНДС</dataPath>
		<expression>Сумма(СуммаКСОБезНДС)</expression>
	</totalField>
	<totalField>
		<dataPath>Трейд_СС</dataPath>
		<expression>Сумма(Трейд_СС)</expression>
	</totalField>
	<totalField>
		<dataPath>ФинРезЖелезо</dataPath>
		<expression>Сумма(ФинРезЖелезо)</expression>
	</totalField>
	<totalField>
		<dataPath>ФинРезЖелезоУД</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(ФинРезЖелезо)/Сумма(Количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>ДоходДОПБезНДС_УД</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(ДоходДОПБезНДС)/Сумма(количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>КСОУД</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(СуммаКСОБезНДС)/Сумма(Количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>PRТрейд</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(КолвоТрейд)/Сумма(Количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>Трейд_СС_УД</dataPath>
		<expression>выбор когда Сумма(КолвоТрейд) =0 тогда 0 иначе Сумма(Трейд_СС)/Сумма(КолвоТрейд) конец</expression>
	</totalField>
	<totalField>
		<dataPath>НаценкаТрейд</dataPath>
		<expression>выбор когда Сумма(Трейд_СС) =0 тогда 0 иначе Сумма(ТрейдПрогноз)/Сумма(Трейд_СС)*100 конец</expression>
	</totalField>
	<totalField>
		<dataPath>БонусыУД</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(СуммаБонусыБезНДС)/Сумма(Количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>КМ_УД</dataPath>
		<expression>выбор когда Сумма(Количество) =0 тогда 0 иначе Сумма(КМ)/Сумма(Количество) конец</expression>
	</totalField>
	<totalField>
		<dataPath>ССАвтоПоступления</dataPath>
		<expression>Сумма(ССАвтоПоступления)</expression>
	</totalField>
	<totalField>
		<dataPath>ПрогнозТрейд_УД</dataPath>
		<expression>выбор когда Сумма(КолвоТрейд) =0 тогда 0 иначе Сумма(ТрейдПрогноз)/Сумма(КолвоТрейд) конец</expression>
	</totalField>
	<totalField>
		<dataPath>ТрейдПрогноз</dataPath>
		<expression>Сумма(ТрейдПрогноз)</expression>
	</totalField>
	<totalField>
		<dataPath>ДоходСервиса</dataPath>
		<expression>Сумма(ДоходСервиса)</expression>
	</totalField>
	<totalField>
		<dataPath>КМ_Сервис</dataPath>
		<expression>Сумма(КМ_Сервис)</expression>
	</totalField>
	<parameter>
		<name>ДатаНач</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата нач</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;Период.ДатаНачала</expression>
	</parameter>
	<parameter>
		<name>ДатаКон</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Дата кон</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>xs:dateTime</v8:Type>
			<v8:DateQualifiers>
				<v8:DateFractions>DateTime</v8:DateFractions>
			</v8:DateQualifiers>
		</valueType>
		<value xsi:type="xs:dateTime">0001-01-01T00:00:00</value>
		<useRestriction>true</useRestriction>
		<expression>&amp;Период.ДатаОкончания</expression>
	</parameter>
	<parameter>
		<name>Период</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Период</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type>v8:StandardPeriod</v8:Type>
		</valueType>
		<value xsi:type="v8:StandardPeriod">
			<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
			<v8:startDate>0001-01-01T00:00:00</v8:startDate>
			<v8:endDate>0001-01-01T00:00:00</v8:endDate>
		</value>
		<useRestriction>false</useRestriction>
	</parameter>
	<parameter>
		<name>Бонусы</name>
		<title xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>Бонусы</v8:content>
			</v8:item>
		</title>
		<valueType>
			<v8:Type xmlns:d4p1="http://v8.1c.ru/8.1/data/enterprise/current-config">d4p1:CatalogRef.ЭМ_ПоказателиКумулятивнойМаржи</v8:Type>
		</valueType>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеFleet</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораМесячный</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораКвартальный</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеОнлайнБронирование</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеРозница</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеКредит</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеДругое</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ИноеВозмещение</value>
		<value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеПрямаяCкидкаЧанган</value>
		<useRestriction>false</useRestriction>
		<valueListAllowed>true</valueListAllowed>
	</parameter>
	<settingsVariant>
		<dcsset:name>Основной</dcsset:name>
		<dcsset:presentation xsi:type="xs:string">Основной</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Количество</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ССАвтоПоступления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВыручкаДоукБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВыручкаАвтоБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ФинРезЖелезо</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ФинРезЖелезоУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходДОПБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходДОПБезНДС_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаКСОБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КСОУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КолвоТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>PRТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Трейд_СС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Трейд_СС_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТрейдПрогноз</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПрогнозТрейд_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НаценкаТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаБонусыБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>БонусыУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПодразделениеКМ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ПериодПродажи</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходСервиса</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ_Сервис</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Период</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardPeriod">
						<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
						<v8:startDate>2023-09-01T00:00:00</v8:startDate>
						<v8:endDate>2023-09-30T23:59:59</v8:endDate>
					</dcscor:value>
					<dcsset:userSettingID>a7e546a2-684e-4559-9e0f-b77569d46594</dcsset:userSettingID>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Бонусы</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеFleet</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораМесячный</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораКвартальный</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеОнлайнБронирование</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеРозница</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеКредит</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеДругое</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ИноеВозмещение</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеПрямаяCкидкаЧанган</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ДопБонус</dcscor:value>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:conditionalAppearance>
				<dcsset:item>
					<dcsset:selection>
						<dcsset:item>
							<dcsset:field>PRТрейд</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>БонусыУД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ДоходДОПБезНДС_УД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>КМ_УД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>КСОУД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>Трейд_СС_УД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ФинРезЖелезоУД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>НаценкаТрейд</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ПрогнозТрейд_УД</dcsset:field>
						</dcsset:item>
						<dcsset:item>
							<dcsset:field>ТрейдПрогноз</dcsset:field>
						</dcsset:item>
					</dcsset:selection>
					<dcsset:filter/>
					<dcsset:appearance>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>Формат</dcscor:parameter>
							<dcscor:value xsi:type="v8:LocalStringType">
								<v8:item>
									<v8:lang>ru</v8:lang>
									<v8:content>ЧДЦ=2</v8:content>
								</v8:item>
							</dcscor:value>
						</dcscor:item>
					</dcsset:appearance>
				</dcsset:item>
			</dcsset:conditionalAppearance>
			<dcsset:outputParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>РасположениеРесурсов</dcscor:parameter>
					<dcscor:value xsi:type="dcsset:DataCompositionResourcesPlacement">Vertically</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Заголовок</dcscor:parameter>
					<dcscor:value xsi:type="v8:LocalStringType">
						<v8:item>
							<v8:lang>ru</v8:lang>
							<v8:content>Отчет по КМ (детальный)</v8:content>
						</v8:item>
					</dcscor:value>
				</dcscor:item>
			</dcsset:outputParameters>
			<dcsset:item xsi:type="dcsset:StructureItemTable">
				<dcsset:column>
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ПодразделениеКМ</dcsset:field>
							<dcsset:groupType>HierarchyOnly</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
					<dcsset:outputParameters>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:use>false</dcscor:use>
							<dcscor:parameter>РасположениеИтогов</dcscor:parameter>
							<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">End</dcscor:value>
						</dcscor:item>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>РасположениеПолейГруппировки</dcscor:parameter>
							<dcscor:value xsi:type="dcsset:DataCompositionGroupFieldsPlacement">SeparatelyAndInTotalsOnly</dcscor:value>
						</dcscor:item>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>РасположениеГруппировки</dcscor:parameter>
							<dcscor:value xsi:type="dcsset:DataCompositionGroupPlacement">End</dcscor:value>
						</dcscor:item>
					</dcsset:outputParameters>
					<dcsset:item>
						<dcsset:groupItems>
							<dcsset:item xsi:type="dcsset:GroupItemField">
								<dcsset:field>ПодразделениеКМ</dcsset:field>
								<dcsset:groupType>Items</dcsset:groupType>
								<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
								<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
								<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
							</dcsset:item>
						</dcsset:groupItems>
						<dcsset:order>
							<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
						</dcsset:order>
						<dcsset:selection>
							<dcsset:item xsi:type="dcsset:SelectedItemAuto">
								<dcsset:use>false</dcsset:use>
							</dcsset:item>
						</dcsset:selection>
						<dcsset:outputParameters>
							<dcscor:item xsi:type="dcsset:SettingsParameterValue">
								<dcscor:parameter>РасположениеИтогов</dcscor:parameter>
								<dcscor:value xsi:type="dcscor:DataCompositionTotalPlacement">None</dcscor:value>
							</dcscor:item>
							<dcscor:item xsi:type="dcsset:SettingsParameterValue">
								<dcscor:parameter>РасположениеПолейГруппировки</dcscor:parameter>
								<dcscor:value xsi:type="dcsset:DataCompositionGroupFieldsPlacement">Separately</dcscor:value>
							</dcscor:item>
							<dcscor:item xsi:type="dcsset:SettingsParameterValue">
								<dcscor:parameter>РасположениеГруппировки</dcscor:parameter>
								<dcscor:value xsi:type="dcsset:DataCompositionGroupPlacement">None</dcscor:value>
							</dcscor:item>
						</dcsset:outputParameters>
						<dcsset:item>
							<dcsset:groupItems>
								<dcsset:item xsi:type="dcsset:GroupItemField">
									<dcsset:field>ПериодПродажи</dcsset:field>
									<dcsset:groupType>Items</dcsset:groupType>
									<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
									<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
									<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
								</dcsset:item>
							</dcsset:groupItems>
							<dcsset:order>
								<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
							</dcsset:order>
							<dcsset:selection>
								<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
							</dcsset:selection>
							<dcsset:outputParameters>
								<dcscor:item xsi:type="dcsset:SettingsParameterValue">
									<dcscor:parameter>РасположениеПолейГруппировки</dcscor:parameter>
									<dcscor:value xsi:type="dcsset:DataCompositionGroupFieldsPlacement">Separately</dcscor:value>
								</dcscor:item>
							</dcsset:outputParameters>
						</dcsset:item>
					</dcsset:item>
				</dcsset:column>
				<dcsset:column>
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ПодразделениеКМДивизион</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">ПодразделениеКМДивизион.Наименование</dcsset:left>
							<dcsset:comparisonType>Contains</dcsset:comparisonType>
							<dcsset:right xsi:type="xs:string">Сочи</dcsset:right>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
				</dcsset:column>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
	<settingsVariant>
		<dcsset:name>ДляВыгрузки</dcsset:name>
		<dcsset:presentation xsi:type="v8:LocalStringType">
			<v8:item>
				<v8:lang>ru</v8:lang>
				<v8:content>ДляВыгрузки</v8:content>
			</v8:item>
		</dcsset:presentation>
		<dcsset:settings xmlns:style="http://v8.1c.ru/8.1/data/ui/style" xmlns:sys="http://v8.1c.ru/8.1/data/ui/fonts/system" xmlns:web="http://v8.1c.ru/8.1/data/ui/colors/web" xmlns:win="http://v8.1c.ru/8.1/data/ui/colors/windows">
			<dcsset:selection>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Количество</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ССАвтоПоступления</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВыручкаДоукБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ВыручкаАвтоБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ФинРезЖелезо</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ФинРезЖелезоУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходДОПБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходДОПБезНДС_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаКСОБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КСОУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КолвоТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>PRТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>Трейд_СС_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТрейдПрогноз</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ТрейдГМ_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>НаценкаТрейд</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>СуммаБонусыБезНДС</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>БонусыУД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ_УД</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>ДоходСервиса</dcsset:field>
				</dcsset:item>
				<dcsset:item xsi:type="dcsset:SelectedItemField">
					<dcsset:field>КМ_Сервис</dcsset:field>
				</dcsset:item>
			</dcsset:selection>
			<dcsset:dataParameters>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Период</dcscor:parameter>
					<dcscor:value xsi:type="v8:StandardPeriod">
						<v8:variant xsi:type="v8:StandardPeriodVariant">Custom</v8:variant>
						<v8:startDate>2023-01-01T00:00:00</v8:startDate>
						<v8:endDate>2023-12-31T23:59:59</v8:endDate>
					</dcscor:value>
				</dcscor:item>
				<dcscor:item xsi:type="dcsset:SettingsParameterValue">
					<dcscor:parameter>Бонусы</dcscor:parameter>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеFleet</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораМесячный</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.БонусДистрибьютораКвартальный</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеОнлайнБронирование</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеРозница</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеКредит</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеДругое</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ИноеВозмещение</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ВозмещениеПрямаяCкидкаЧанган</dcscor:value>
					<dcscor:value xsi:type="dcscor:DesignTimeValue">Справочник.ЭМ_ПоказателиКумулятивнойМаржи.ДопБонус</dcscor:value>
				</dcscor:item>
			</dcsset:dataParameters>
			<dcsset:item xsi:type="dcsset:StructureItemTable">
				<dcsset:column>
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ПериодПродажи</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
				</dcsset:column>
				<dcsset:row>
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ПодразделениеКМ</dcsset:field>
							<dcsset:groupType>Hierarchy</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
				</dcsset:row>
				<dcsset:row>
					<dcsset:groupItems>
						<dcsset:item xsi:type="dcsset:GroupItemField">
							<dcsset:field>ПодразделениеКМДивизион</dcsset:field>
							<dcsset:groupType>Items</dcsset:groupType>
							<dcsset:periodAdditionType>None</dcsset:periodAdditionType>
							<dcsset:periodAdditionBegin xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionBegin>
							<dcsset:periodAdditionEnd xsi:type="xs:dateTime">0001-01-01T00:00:00</dcsset:periodAdditionEnd>
						</dcsset:item>
					</dcsset:groupItems>
					<dcsset:filter>
						<dcsset:item xsi:type="dcsset:FilterItemComparison">
							<dcsset:left xsi:type="dcscor:Field">ПодразделениеКМДивизион.Наименование</dcsset:left>
							<dcsset:comparisonType>Contains</dcsset:comparisonType>
							<dcsset:right xsi:type="xs:string">Сочи</dcsset:right>
						</dcsset:item>
					</dcsset:filter>
					<dcsset:order>
						<dcsset:item xsi:type="dcsset:OrderItemAuto"/>
					</dcsset:order>
					<dcsset:selection>
						<dcsset:item xsi:type="dcsset:SelectedItemAuto"/>
					</dcsset:selection>
					<dcsset:outputParameters>
						<dcscor:item xsi:type="dcsset:SettingsParameterValue">
							<dcscor:parameter>ВыводитьОтбор</dcscor:parameter>
							<dcscor:value xsi:type="dcsset:DataCompositionTextOutputType">DontOutput</dcscor:value>
						</dcscor:item>
					</dcsset:outputParameters>
				</dcsset:row>
			</dcsset:item>
		</dcsset:settings>
	</settingsVariant>
</DataCompositionSchema>