
//Перем ПоследовательностиОтчета Экспорт;                // хранит последовательности отчета

////////////////////////////////////////////////////////////////////////////////
// ЭКСПОРТНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ ДОПОЛНИТЕЛЬНЫХ МЕТОДОВ ОБЪЕКТА

Функция ПолучитьСвойства() Экспорт
	
	СтруктураСвойств = Новый Структура;
	СтруктураСвойств.Вставить("Партия");
	СтруктураСвойств.Вставить("Номенклатура");
	СтруктураСвойств.Вставить("Контрагент");
	СтруктураСвойств.Вставить("ДоговорВзаиморасчетов");
	
	Возврат СтруктураСвойств;
	
КонецФункции

// Стандартная процедура настройки схемы компоновщика данных
//
Процедура ЗаполнитьНачальныеНастройки() Экспорт
	
	ОтчетыСервер.ЗаполнитьНачальныеОстатки(ЭтотОбъект);
	//ПоказательАвтомобиля=Неопределено;
	//Если ПараметрыИспользованияПолейИПоказателей.Свойство("Автомобиль",ПоказательАвтомобиля) Тогда
	//	ПоказательГодВыпуска=Неопределено;
	//	Если ПоказательАвтомобиля.Поля.Свойство("ГодВыпуска",ПоказательГодВыпуска) Тогда
	//		ФорматПредставленияГодаВыпускаАвтомобиля=орПолучитьФорматПредставленияГодаВыпускаАвтомобиля();
	//		ПоказательГодВыпуска.Формат=ФорматПредставленияГодаВыпускаАвтомобиля;
	//	КонецЕсли;
	//КонецЕсли;
	
КонецПроцедуры // ЗаполнитьНачальныеНастройки()

Функция ПолучениеОграниченийНастроек() Экспорт
	
	СтруктураПолей = Новый Структура;
	СтруктураПолей.Вставить("Группировки");
	//СтруктураПолей.Вставить("Показатели");
	СтруктураПолей.Вставить("Порядок");
	СтруктураПолей.Вставить("Отборы");
	СтруктураПолей.Вставить("Параметры");
	
	Возврат СтруктураПолей;
	
КонецФункции

//Заполняет основные параметры отчета
//
//Без параметров
//
Процедура УстановитьПараметры() 
	
	ДатаОкончания             = ОтчетыСервер.КомпоновщикПолучитьЗначениеПараметра("ДатаОкончанияГраница", КомпоновщикНастроек.Настройки);
	КоэффициентРублевогоКурса = обПересчет(1, Константы.ВалютаРегламентированногоУчетаОрганизаций.Получить(), ДатаОкончания, Константы.ВалютаУправленческогоУчетаКомпании.Получить(), ДатаОкончания);
	
	КомпоновщикНастроек.Настройки.ПараметрыДанных.УстановитьЗначениеПараметра("КоэффициентРублевогоКурса", ?(КоэффициентРублевогоКурса=0, 1, КоэффициентРублевогоКурса));
	
КонецПроцедуры // УстановитьОсновныеПараметры()

// Функция возвращает структуру сортировки поля
//
//Без параметров
//
// Возвращаемое значение:
//   СтруктураСортировкиПоля – Структура
//
Функция СтруктураСортировки() Экспорт
	
	СтруктураСортировкиПоля = Новый Структура("Описание, НаправлениеСортировки");
	СтруктураСортировкиПоля.НаправлениеСортировки = НаправлениеСортировки.Возр;
	СтруктураСортировкиПоля.Описание              = "СтатусПартии";
	
	Возврат СтруктураСортировкиПоля;
	
КонецФункции // СтруктураФорматированияПолей()

Процедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка) Экспорт
	
	УстановитьПараметры();
	
	ВидРазвертки = ОтчетыСервер.КомпоновщикПолучитьЗначениеПараметра("ВидРазвертки", КомпоновщикНастроек.Настройки);
	ПоТоварам    = ОтчетыСервер.КомпоновщикПолучитьЗначениеПараметра("ПоТоварам",    КомпоновщикНастроек.Настройки);
	ПоДокументам = ОтчетыСервер.КомпоновщикПолучитьЗначениеПараметра("ПоДокументам", КомпоновщикНастроек.Настройки);
	
	Структура = КомпоновщикНастроек.Настройки.Структура;
	Структура.Очистить();
	
	Если ВидРазвертки=0 Тогда
		//ДобавитьИзмерение("СтатусПартии");
		
		ПерваяГруппировка = Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ПерваяГруппировка.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ПерваяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("СтатусПартии");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		
		ВложеннаяГруппировка = ПерваяГруппировка.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ВложеннаяГруппировка.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ВложеннаяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("ПредставлениеКонтрагента");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		
		//ДобавитьИзмерение("ПредставлениеКонтрагента");
	ИначеЕсли ВидРазвертки=1 Тогда
		ПерваяГруппировка = Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ПерваяГруппировка.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ПерваяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("ПредставлениеКонтрагента");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		
		ВложеннаяГруппировка = ПерваяГруппировка.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ВложеннаяГруппировка.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ВложеннаяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("СтатусПартии");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		//ДобавитьИзмерение("ПредставлениеКонтрагента");
		//ДобавитьИзмерение("СтатусПартии");
	Иначе 
		//ДобавитьИзмерение("СтатусПартии");
		//ДобавитьИзмерение("ПредставлениеКонтрагента");
		ПерваяГруппировка = Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ПерваяГруппировка.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ПерваяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ПерваяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("СтатусПартии");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		
		ВложеннаяГруппировка = ПерваяГруппировка.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ВложеннаяГруппировка.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ВложеннаяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("ПредставлениеКонтрагента");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
	КонецЕсли;
	
	Если ПоТоварам<>0 Тогда
		//ДобавитьИзмерение("Номенклатура");
		ВложеннаяГруппировка = ВложеннаяГруппировка.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ВложеннаяГруппировка.Использование = Истина;
		
		НовоеПоле = ВложеннаяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ВложеннаяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("Номенклатура");
		Если ПоТоварам = 1 Тогда
			ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		Иначе
			ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Иерархия;
		КонецЕсли;
		
	КонецЕсли;
	
	Если ПоДокументам = 1 Тогда
		ВложеннаяГруппировка = ВложеннаяГруппировка.Структура.Добавить(Тип("ГруппировкаКомпоновкиДанных"));
		ВложеннаяГруппировка.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Выбор.Элементы.Добавить(Тип("АвтоВыбранноеПолеКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		НовоеПоле = ВложеннаяГруппировка.Порядок.Элементы.Добавить(Тип("АвтоЭлементПорядкаКомпоновкиДанных"));
		НовоеПоле.Использование = Истина;
		ПолеГруппировки = ВложеннаяГруппировка.ПоляГруппировки.Элементы.Добавить(Тип("ПолеГруппировкиКомпоновкиДанных"));
		ПолеГруппировки.Использование = Истина;
		ПолеГруппировки.Поле = Новый ПолеКомпоновкиДанных("Партия");
		ПолеГруппировки.ТипГруппировки = ТипГруппировкиКомпоновкиДанных.Элементы;
		//ДобавитьИзмерение("Партия");
	КонецЕсли;
	
	ОтчетыСервер.ВывестиОтчет(ЭтотОбъект, СхемаКомпоновкиДанных, КомпоновщикНастроек.Настройки, ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка);
	
КонецПроцедуры


//////////////////////////////////////////////////////////////////////////////////
//// ОПЕРАТОРЫ ОСНОВНОЙ ПРОГРАММЫ

//ИмяРегистра = "ОстаткиТоваровКомпании";
//отОтчетПриИнициализацииОбъекта(ЭтотОбъект);
//ПромежуточныеЗначенияПостроителя = Новый Структура();
//СтруктураНеСвязанныхПоказателей = Новый Структура();

//ПоследовательностиОтчета = Новый Структура();
//ПоследовательностиОтчета.Вставить("ГраницыПартий");
//ПоследовательностиОтчета.Вставить("ГраницыВзаиморасчетов");

