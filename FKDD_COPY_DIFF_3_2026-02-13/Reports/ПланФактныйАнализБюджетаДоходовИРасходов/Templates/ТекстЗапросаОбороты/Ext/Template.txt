ВЫБРАТЬ РАЗРЕШЕННЫЕ
#Область ИзмеренияПостроителяДляСвойств
	ОбъединенныйЗапрос.ПодразделениеКомпании.Организация КАК Организация,
	ОбъединенныйЗапрос.ПодразделениеКомпании КАК ПодразделениеКомпании,
	ОбъединенныйЗапрос.СтатьяДоходовИРасходов КАК СтатьяДоходовИРасходов,
	ОбъединенныйЗапрос.Период КАК Период,
#КонецОбласти
	СУММА(ОбъединенныйЗапрос.СуммаПланДоход) КАК ПланДоход,
	СУММА(ОбъединенныйЗапрос.СуммаПланРасход) КАК ПланРасход,
	СУММА(ОбъединенныйЗапрос.СуммаФактДоход) КАК ФактДоход,
	СУММА(ОбъединенныйЗапрос.СуммаФактРасход) КАК ФактРасход,
	СУММА(ОбъединенныйЗапрос.СуммаФактДоход - ОбъединенныйЗапрос.СуммаПланДоход) КАК ОтклонениеДоход,
	СУММА(ОбъединенныйЗапрос.СуммаФактРасход - ОбъединенныйЗапрос.СуммаПланРасход) КАК ОтклонениеРасход
	
	//СВОЙСТВА

{ВЫБРАТЬ 
	Организация.* КАК Организация,
	ПодразделениеКомпании.* КАК ПодразделениеКомпании,
	СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов,
	Период КАК Период,
	ПланДоход КАК ПланДоход,
	ПланРасход КАК ПланРасход,
	ФактДоход КАК ФактДоход,
	ФактРасход КАК ФактРасход,
	ОтклонениеДоход КАК ОтклонениеДоход,
	ОтклонениеРасход КАК ОтклонениеРасход
	//СВОЙСТВА}
ИЗ 
	(
	 ВЫБРАТЬ
	  БюджетДоходовИРасходов.ПодразделениеКомпании КАК ПодразделениеКомпании,
	  БюджетДоходовИРасходов.СтатьяДоходовИРасходов КАК СтатьяДоходовИРасходов,
	  БюджетДоходовИРасходов.Период КАК Период,
	  
	  БюджетДоходовИРасходов.СуммаДоходУпрОборот КАК СуммаПланДоход,
	  БюджетДоходовИРасходов.СуммаРасходУпрОборот КАК СуммаПланРасход,
	  
	  0 КАК СуммаФактДоход,
	  0 КАК СуммаФактРасход
	
	 ИЗ
	 РегистрНакопления.БюджетДоходовИРасходов.Обороты(&ДатаНач, &ДатаКон, Месяц, СценарийПланирования = &СценарийПланирования{
		ПодразделениеКомпании.Организация.* КАК Организация, 
		ПодразделениеКомпании.* КАК ПодразделениеКомпании, 
		СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов
		}) КАК БюджетДоходовИРасходов
	   
		
	 ОБЪЕДИНИТЬ ВСЕ
	 
	 ВЫБРАТЬ
	  	ДоходыИРасходы.ПодразделениеКомпании,
	  	ДоходыИРасходы.СтатьяДоходовИРасходов,
	    НАЧАЛОПЕРИОДА(ДоходыИРасходы.Период, Месяц),
	 	
	 	0,
	 	0,
	 	
	 	(ВЫБОР
	 		КОГДА ДоходыИРасходы.ДоходУпрОборот>0 ТОГДА
	 			ДоходыИРасходы.ДоходУпрОборот
	 		ИНАЧЕ
	 			0
	 	КОНЕЦ) + 
	 	(ВЫБОР
	 		КОГДА ДоходыИРасходы.РасходУпрОборот<0 ТОГДА
	 			-ДоходыИРасходы.РасходУпрОборот
	 		ИНАЧЕ
	 			0
	 	КОНЕЦ),
	 	(ВЫБОР
	 		КОГДА ДоходыИРасходы.РасходУпрОборот>0 ТОГДА
	 			ДоходыИРасходы.РасходУпрОборот
	 		ИНАЧЕ
	 			0
	 	КОНЕЦ) + 
	 	(ВЫБОР
	 		КОГДА ДоходыИРасходы.ДоходУпрОборот<0 ТОГДА
	 			-ДоходыИРасходы.ДоходУпрОборот
	 		ИНАЧЕ
	 			0
	 	КОНЕЦ)
	 ИЗ
	 	РегистрНакопления.ДоходыИРасходы.Обороты(&ДатаНач, &ДатаКон, Месяц,
	 	{
	    ПодразделениеКомпании.Организация.* КАК Организация, 
	 	ПодразделениеКомпании.* КАК ПодразделениеКомпании,
	  	СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов}) КАК ДоходыИРасходы
	) КАК ОбъединенныйЗапрос
//СОЕДИНЕНИЯ

СГРУППИРОВАТЬ ПО
	ОбъединенныйЗапрос.ПодразделениеКомпании,
	ОбъединенныйЗапрос.СтатьяДоходовИРасходов,
	ОбъединенныйЗапрос.Период
	//СГРУППИРОВАТЬПО

 ИМЕЮЩИЕ
	&ВыводитьВсеЗаписи ИЛИ (СУММА(ОбъединенныйЗапрос.СуммаПланДоход)-СУММА(ОбъединенныйЗапрос.СуммаПланРасход))<>0
	
{ГДЕ 
	ОбъединенныйЗапрос.ПодразделениеКомпании.* КАК ПодразделениеКомпании,
	ОбъединенныйЗапрос.СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов
	//СВОЙСТВА}
	
{УПОРЯДОЧИТЬ ПО 
	Организация.* КАК Организация,
	ПодразделениеКомпании.* КАК ПодразделениеКомпании,
	СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов,
	Период КАК Период
	 //СВОЙСТВА}
	
{ИТОГИ ПО 
	Организация.* КАК Организация,
	ПодразделениеКомпании.* КАК ПодразделениеКомпании,
	СтатьяДоходовИРасходов.* КАК СтатьяДоходовИРасходов,
	Период КАК Период
	//СВОЙСТВА}

ИТОГИ
	СУММА(ПланДоход),
	СУММА(ПланРасход),
	СУММА(ФактДоход),
	СУММА(ФактРасход),
	СУММА(ОтклонениеДоход),
	СУММА(ОтклонениеРасход)
	//ИТОГИСВОЙСТВА
	
ПО ОБЩИЕ
				
АВТОУПОРЯДОЧИВАНИЕ
