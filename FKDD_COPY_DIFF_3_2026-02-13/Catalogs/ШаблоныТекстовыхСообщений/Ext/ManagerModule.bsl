// Функция - Заполнить шаблон по объекту
//
// Параметры:
//  Шаблон	 - СправочникСсылка.ШаблоныТекстовыхСообщений	 - Шаблон, в котором будем заменять параметры
//  Объект	 - Произвольный									 - Объект, элементами которого будем заполнять шаблон.
// 
// Возвращаемое значение:
//  Строка - Текст смс-сообщения
//
Функция ЗаполнитьШаблонПоОбъекту(Шаблон, Объект) Экспорт
	// Получим Шаблон
	Текст = Шаблон.Шаблон;
	// Обход тч
	Для Каждого Элемент Из Шаблон.СоответствиеРеквизитовИЗамен Цикл
		// Проверяем это реквизит объекта, или элемент справочника действия
		Если ТипЗнч(Элемент.Имя)= Тип("Строка") Тогда
			Попытка
				ПозицияТочки = Найти(Элемент.Имя, ".");
				Если ПозицияТочки = 0 Тогда
					Значение = Формат(Объект[Элемент.Имя], "ДЛФ=DD");
				Иначе
					Значение = Формат(Объект[Лев(Элемент.Имя, ПозицияТочки-1)][Сред(Элемент.Имя, ПозицияТочки+1)], "ДЛФ=DD")
				КонецЕсли;
			Исключение
				Значение = "";
			КонецПопытки;
		ИначеЕсли ТипЗнч(Элемент.Имя)= Тип("СправочникСсылка.Действия") Тогда
			// Получаем действие, которое необходимо выполнить
			Действие = Справочники.Действия.НайтиПоРеквизиту("ПредставлениеДействия",Элемент.Представление);
			Попытка
				// Выполняем, все пишется в переменную Автотекст (Строка), так же и пользователь должен писать
				Автотекст = "";
				Выполнить(Действие.Действие);
				Значение = Автотекст; 
			Исключение	
				Значение = "";
			КонецПопытки;
		КонецЕсли;
		// Заменяем параметры на значения
		Текст = СтрЗаменить(Текст, Элемент.Мнемоника, Значение);
	КонецЦикла;
	
	Возврат Текст;
	
КонецФункции

// Процедура - Заполнить предопределенные элементы
//
// Параметры:
//  ЗаполнятьВсе - Булево	 - Признак заполнения всех реквизитов
//
Процедура ЗаполнитьПредопределенныеЭлементы(ЗаполнятьВсе=Ложь) Экспорт
	
 	Если ПустаяСтрока(Справочники.ШаблоныТекстовыхСообщений.ПримерШаблонаДляРегламентногоЗаданияАктивацияБонусныхБаллов.ОбъектМетаданных) Тогда
		Объект = Справочники.ШаблоныТекстовыхСообщений.ПримерШаблонаДляРегламентногоЗаданияАктивацияБонусныхБаллов.ПолучитьОбъект();
		
		Объект.ТипОбъектаМетаданных            = "Обработки";
		Объект.ОбъектМетаданных                = "АктивацияБонусныхБаллов";
		Объект.ТабличнаяЧастьОбъектаМетаДанных = "ТаблицаРассылок";
		
		Объект.Шаблон = "Уважаемый(ая) %Контрагент% бонусные баллы были активированы.";
		
		СтрокаКонтрагент = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		СтрокаКонтрагент.Имя = "Контрагент";
		СтрокаКонтрагент.Представление = "Контрагент";
		СтрокаКонтрагент.Мнемоника = "%Контрагент%";
		
		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЕсли;
	
	Если ПустаяСтрока(Справочники.ШаблоныТекстовыхСообщений.ПримерШаблонаДляРегламентногоЗаданияРассылкаИнформацииОБонусныхБаллах.ОбъектМетаданных) Тогда
		Объект = Справочники.ШаблоныТекстовыхСообщений.ПримерШаблонаДляРегламентногоЗаданияРассылкаИнформацииОБонусныхБаллах.ПолучитьОбъект();
		
		Объект.ТипОбъектаМетаданных            = "Обработки";
		Объект.ОбъектМетаданных                = "РассылкаИнформацииОБонусныхБаллах";
		Объект.ТабличнаяЧастьОбъектаМетаДанных = "ДанныеДляРассылки";
		
		Объект.Шаблон = "Уважаемый(ая) %Контрагент% ваши баллы близки к сгоранию.";
		
		СтрокаКонтрагент = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		СтрокаКонтрагент.Имя = "Контрагент";
		СтрокаКонтрагент.Представление = "Контрагент";
		СтрокаКонтрагент.Мнемоника = "%Контрагент%";
		
		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЕсли;
	
	Если ПустаяСтрока(Справочники.ШаблоныТекстовыхСообщений.ШаблонПриОтменыЗаявкиНаРемонт.ОбъектМетаданных) Тогда
		Объект = Справочники.ШаблоныТекстовыхСообщений.ШаблонПриОтменыЗаявкиНаРемонт.ПолучитьОбъект();
		
		Объект.ТипОбъектаМетаданных            = "Документы";
		Объект.ОбъектМетаданных                = "ЗаявкаНаРемонт";
		Объект.ТабличнаяЧастьОбъектаМетаДанных = "";
		
		Объект.Шаблон = "Уважаемый(ая) %Заказчик% , Ваша заявка на ремонт\обслуживание автомобиля [%Гос номер%] на %Дата заявки на ремонт без времени% в "; 
		Объект.Шаблон=Объект.Шаблон+"%Дата заявки на ремонт только время% - отменена."+Символы.ПС+"Ваш сервисный консультант: %Консультант% %Телефон консультанта%.";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = "Заказчик";
		НоваяСтрока.Представление = "Заказчик";
		НоваяСтрока.Мнемоника = "%Заказчик%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ГосНомер;
		НоваяСтрока.Представление = "%Гос номер";
		НоваяСтрока.Мнемоника = "%Гос номер%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ДатаЗаявкиНаРемонтБезВремени;
		НоваяСтрока.Представление = "%Дата заявки на ремонт без времени";
		НоваяСтрока.Мнемоника = "%Дата заявки на ремонт без времени%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ДатаЗаявкиНаРемонтТолькоВремя;
		НоваяСтрока.Представление = "%Дата заявки на ремонт только время";
		НоваяСтрока.Мнемоника = "%Дата заявки на ремонт только время%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.Консультант;
		НоваяСтрока.Представление = "%Консультант";
		НоваяСтрока.Мнемоника = "%Консультант%";

		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ТелефонКонсультанта;
		НоваяСтрока.Представление = "%Телефон консультанта";
		НоваяСтрока.Мнемоника = "%Телефон консультанта%";

		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЕсли;
	
	Если ПустаяСтрока(Справочники.ШаблоныТекстовыхСообщений.ШаблонПриНачалеРабот.ОбъектМетаданных) Тогда
		Объект = Справочники.ШаблоныТекстовыхСообщений.ШаблонПриНачалеРабот.ПолучитьОбъект();
		
		Объект.ТипОбъектаМетаданных            = "Документы";
		Объект.ОбъектМетаданных                = "ЗаявкаНаРемонт";
		Объект.ТабличнаяЧастьОбъектаМетаДанных = "";
		
		Объект.Шаблон = "Уважаемый(ая) %Заказчик%,  напоминаем, что Вы записаны на ремонт\обслуживание автомобиля [%Гос номер%] на "; 
		Объект.Шаблон=Объект.Шаблон+"%Дата заявки на ремонт без времени% в %Дата заявки на ремонт только время%."+Символы.ПС+"Ваш сервисный консультант: %Консультант% %Телефон консультанта%.";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = "Заказчик";
		НоваяСтрока.Представление = "Заказчик";
		НоваяСтрока.Мнемоника = "%Заказчик%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ГосНомер;
		НоваяСтрока.Представление = "%Гос номер";
		НоваяСтрока.Мнемоника = "%Гос номер%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ДатаЗаявкиНаРемонтБезВремени;
		НоваяСтрока.Представление = "%Дата заявки на ремонт без времени";
		НоваяСтрока.Мнемоника = "%Дата заявки на ремонт без времени%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ДатаЗаявкиНаРемонтТолькоВремя;
		НоваяСтрока.Представление = "%Дата заявки на ремонт только время";
		НоваяСтрока.Мнемоника = "%Дата заявки на ремонт только время%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = "%Консультант";
		НоваяСтрока.Представление = "%Консультант";
		НоваяСтрока.Мнемоника = "%Консультант%";

		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ТелефонКонсультанта;
		НоваяСтрока.Представление = "%Телефон консультанта";
		НоваяСтрока.Мнемоника = "%Телефон консультанта%";
		
		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЕсли;
	
	Если ПустаяСтрока(Справочники.ШаблоныТекстовыхСообщений.ШаблонПриИзмененииСостоянияЗаказНаряда.ОбъектМетаданных) Тогда
		Объект = Справочники.ШаблоныТекстовыхСообщений.ШаблонПриИзмененииСостоянияЗаказНаряда.ПолучитьОбъект();
		
		Объект.ТипОбъектаМетаданных            = "Документы";
		Объект.ОбъектМетаданных                = "ЗаказНаряд";
		Объект.ТабличнаяЧастьОбъектаМетаДанных = "";
		
		Объект.Шаблон = "Уважаемый(ая) %Заказчик%, статус заказ-наряда на ремонт\обслуживание Вашего автомобиля "; 
		Объект.Шаблон = Объект.Шаблон+"[%Гос номер авто в заказ наряде%] изменен на: [%Состояние%]."+Символы.ПС+"Ваш сервисный консультант: %Консультант% %Телефон консультанта%.";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = "Заказчик";
		НоваяСтрока.Представление = "Заказчик";
		НоваяСтрока.Мнемоника = "%Заказчик%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ГосНомерАвтоВЗаказНаряде;
		НоваяСтрока.Представление = "%Гос номер авто в заказ наряде";
		НоваяСтрока.Мнемоника = "%Гос номер авто в заказ наряде%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = "Состояние";
		НоваяСтрока.Представление = "Состояние заказ-наряда";
		НоваяСтрока.Мнемоника = "%Состояние%";
		
		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.Консультант;
		НоваяСтрока.Представление = "%Консультант";
		НоваяСтрока.Мнемоника = "%Консультант%";

		НоваяСтрока = Объект.СоответствиеРеквизитовИЗамен.Добавить();
		НоваяСтрока.Имя = Справочники.Действия.ТелефонКонсультанта;
		НоваяСтрока.Представление = "%Телефон консультанта";
		НоваяСтрока.Мнемоника = "%Телефон консультанта%";
		
		Объект.ОбменДанными.Загрузка = Истина;
		Объект.Записать();
	КонецЕсли;

КонецПроцедуры