// Процедура загружает элементы справочника из макета справочника "Приложение1"
//
Процедура ЗагрузитьТребованияИзМакета() Экспорт
	
	Отказ = Ложь;
	спПроверкаПраваДоступа(Справочники.ТребованияКТранспортнымСредствам.СоздатьЭлемент(), Отказ);
	Если Отказ Тогда
		Возврат
	КонецЕсли;	
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТребованияКТранспортнымСредствам.Ссылка,
	               |	ТребованияКТранспортнымСредствам.Наименование КАК Наименование,
	               |	ТребованияКТранспортнымСредствам.Родитель
	               |ИЗ
	               |	Справочник.ТребованияКТранспортнымСредствам КАК ТребованияКТранспортнымСредствам
	               |ГДЕ
	               |	ТребованияКТранспортнымСредствам.ЭтоГруппа = ИСТИНА
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	Наименование";
	ТаблицаГруппВСправочнике = Запрос.Выполнить().Выгрузить();
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	               |	ТребованияКТранспортнымСредствам.НаименованиеПолное,
	               |	ТребованияКТранспортнымСредствам.Ссылка,
	               |	ТребованияКТранспортнымСредствам.Родитель
	               |ИЗ
	               |	Справочник.ТребованияКТранспортнымСредствам КАК ТребованияКТранспортнымСредствам
	               |ГДЕ
	               |	ТребованияКТранспортнымСредствам.ЭтоГруппа = ЛОЖЬ
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	ТребованияКТранспортнымСредствам.Номер";
	ТаблицаЭлементовВСправочнике = Запрос.Выполнить().Выгрузить();
	
	#Если Клиент Тогда
	Состояние("Загружаются требования к транспортным средствам из макета в справочник...");
	#КонецЕсли		
	
	Макет = Справочники.ТребованияКТранспортнымСредствам.ПолучитьМакет("Приложение1");
	Попытка
		ОбластьТаблицаТребований = Макет.ПолучитьОбласть("СписокТребований");
					
		#Если Клиент Тогда
		// отображаем форму индикации
		ФормаИндикатора = ПолучитьОбщуюФорму("Индикация", Справочники.ТребованияКТранспортнымСредствам.ПолучитьФормуСписка());
		ФормаИндикатора.СтрокаСостояния = "Загрузка справочника ""Требования к транспортным средствам""...";
		Сч = (ОбластьТаблицаТребований.ВысотаТаблицы - 5) * 2;
		ФормаИндикатора.ЭлементыФормы.Индикатор.МаксимальноеЗначение = Сч;
		ФормаИндикатора.ЭлементыФормы.Индикатор.Шаг = Сч / 100;
		ФормаИндикатора.Открыть();
		Сч = 0;
		#КонецЕсли		

		// получим таблицу из макета
		ТаблицаТребований = Новый ТаблицаЗначений;
		ТаблицаТребований.Колонки.Добавить("Загрузка");
		ТаблицаТребований.Колонки.Добавить("Номер");
		ТаблицаТребований.Колонки.Добавить("Родитель");
		ТаблицаТребований.Колонки.Добавить("НаименованиеПолное");
		ТаблицаТребований.Колонки.Добавить("Описание");
		ТаблицаТребований.Колонки.Добавить("КатегорияM1Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияM1МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияM1МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN1Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияN1МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN1МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияM2Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияM2МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияM2МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN2Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияN2МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN2МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияM3Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияM3МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияM3МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN3Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияN3МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияN3МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияO1O2Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияO1O2МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияO1O2МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияO3O4Использование");
		ТаблицаТребований.Колонки.Добавить("КатегорияO3O4МинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияO3O4МаксЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияLИспользование");
		ТаблицаТребований.Колонки.Добавить("КатегорияLМинЗнач");
		ТаблицаТребований.Колонки.Добавить("КатегорияLМаксЗнач");
		
		ВысотаТаблицы = Макет.ПолучитьОбласть("СписокТребований").ВысотаТаблицы;
		
		Для НомерСтроки = 1 По ВысотаТаблицы  Цикл
			
			#Если Клиент Тогда
			Сч = Сч + 1;
			ФормаИндикатора.ЭлементыФормы.Индикатор.Значение = Сч;
			#КонецЕсли		
			
			// проверим заполнение текущей строки макета
			НомерТребования = ОбластьТаблицаТребований.Область(НомерСтроки, 1).Текст;	
			Если ПустаяСтрока(НомерТребования) Тогда
				Прервать;
			КонецЕсли;
			СтрокаТаблицыТребований 							= ТаблицаТребований.Добавить();
			СтрокаТаблицыТребований.Номер 						= НомерТребования;
			СтрокаТаблицыТребований.Родитель 					= ОбластьТаблицаТребований.Область(НомерСтроки, 2).Текст;
			СтрокаТаблицыТребований.НаименованиеПолное 			= ОбластьТаблицаТребований.Область(НомерСтроки, 3).Текст;
			СтрокаТаблицыТребований.Описание 					= ОбластьТаблицаТребований.Область(НомерСтроки, 4).Текст;
			СтрокаТаблицыТребований.КатегорияM1Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 5).Текст;
			СтрокаТаблицыТребований.КатегорияM1МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 6).Текст;
			СтрокаТаблицыТребований.КатегорияM1МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 7).Текст;
			СтрокаТаблицыТребований.КатегорияN1Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 8).Текст;
			СтрокаТаблицыТребований.КатегорияN1МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 9).Текст;
			СтрокаТаблицыТребований.КатегорияN1МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 10).Текст;
			СтрокаТаблицыТребований.КатегорияM2Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 11).Текст;
			СтрокаТаблицыТребований.КатегорияM2МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 12).Текст;
			СтрокаТаблицыТребований.КатегорияM2МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 13).Текст;
			СтрокаТаблицыТребований.КатегорияN2Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 14).Текст;
			СтрокаТаблицыТребований.КатегорияN2МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 15).Текст;
			СтрокаТаблицыТребований.КатегорияN2МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 16).Текст;
			СтрокаТаблицыТребований.КатегорияM3Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 17).Текст;
			СтрокаТаблицыТребований.КатегорияM3МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 18).Текст;
			СтрокаТаблицыТребований.КатегорияM3МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 19).Текст;
			СтрокаТаблицыТребований.КатегорияN3Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 20).Текст;
			СтрокаТаблицыТребований.КатегорияN3МинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 21).Текст;
			СтрокаТаблицыТребований.КатегорияN3МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 22).Текст;
			СтрокаТаблицыТребований.КатегорияO1O2Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 23).Текст;
			СтрокаТаблицыТребований.КатегорияO1O2МинЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 24).Текст;
			СтрокаТаблицыТребований.КатегорияO1O2МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 25).Текст;
			СтрокаТаблицыТребований.КатегорияO3O4Использование	= ОбластьТаблицаТребований.Область(НомерСтроки, 26).Текст;
			СтрокаТаблицыТребований.КатегорияO3O4МинЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 27).Текст;
			СтрокаТаблицыТребований.КатегорияO3O4МаксЗнач 		= ОбластьТаблицаТребований.Область(НомерСтроки, 28).Текст;
			СтрокаТаблицыТребований.КатегорияLИспользование		= ОбластьТаблицаТребований.Область(НомерСтроки, 29).Текст;
			СтрокаТаблицыТребований.КатегорияLМинЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 30).Текст;
			СтрокаТаблицыТребований.КатегорияLМаксЗнач 			= ОбластьТаблицаТребований.Область(НомерСтроки, 31).Текст;
		КонецЦикла; 
		
		ТаблицаГрупп = ТаблицаТребований.Скопировать();
		ТаблицаГрупп.Свернуть("Родитель");
				
		Форма = Справочники.ТребованияКТранспортнымСредствам.ПолучитьФорму("ФормаЗагрузки");
		Форма.ТаблицаГрупп = ТаблицаГрупп;
		Форма.ТаблицаЭлементов = ТаблицаТребований;
		Форма.ТаблицаЭлементовВСправочнике = ТаблицаЭлементовВСправочнике;
		Результат = Форма.ОткрытьМодально();
		
		Если НЕ обЗначениеНеЗаполнено(Результат) И Результат.Количество() Тогда
			ТаблицаТребований = Результат;
		Иначе
			//Сообщить("Загрузка не выполнена!");
			#Если Клиент Тогда
			Состояние("");
			Если ФормаИндикатора.Открыта() Тогда ФормаИндикатора.Закрыть(); КонецЕсли;
			#КонецЕсли					
			Возврат;
		КонецЕсли;
		
		ТС_M1 = Справочники.КатегорииТранспортныхСредств.АвтомобилиЛегковые;
		ТС_M2 = Справочники.КатегорииТранспортныхСредств.АвтобусыДо5000;
		ТС_M3 = Справочники.КатегорииТранспортныхСредств.Автобусы;
		
		ТС_N1 = Справочники.КатегорииТранспортныхСредств.ГрузовикиДо3500;
		ТС_N2 = Справочники.КатегорииТранспортныхСредств.ГрузовикиДо12000;
		ТС_N3 = Справочники.КатегорииТранспортныхСредств.Грузовики;
		
		ТС_O1 = Справочники.КатегорииТранспортныхСредств.ПрицепыДо750;
		ТС_O2 = Справочники.КатегорииТранспортныхСредств.ПрицепыДо3500;
		ТС_O3 = Справочники.КатегорииТранспортныхСредств.ПрицепыДо10000;
		ТС_O4 = Справочники.КатегорииТранспортныхСредств.Прицепы;
		
		ТС_L1 = Справочники.КатегорииТранспортныхСредств.МопедыДвухколесные;
		ТС_L2 = Справочники.КатегорииТранспортныхСредств.МопедыТрехколесные;
		ТС_L3 = Справочники.КатегорииТранспортныхСредств.МотоциклыДвухколесные;
		ТС_L4 = Справочники.КатегорииТранспортныхСредств.МотоциклыТрехколесныеАссиметричные;
		ТС_L5 = Справочники.КатегорииТранспортныхСредств.МотоциклыТрехколесныеСиметричные;
		ТС_L6 = Справочники.КатегорииТранспортныхСредств.КвадроциклыДо350;
		ТС_L7 = Справочники.КатегорииТранспортныхСредств.КвадроциклыДо400;
		
		СчОбъектов = 0;
		
		Для Каждого СтрокаТаблицыТребований Из ТаблицаТребований Цикл
			СтрокаТаблицыГруппВСправочнике = ТаблицаГруппВСправочнике.Найти(СокрЛП(СтрокаТаблицыТребований.Родитель), "Наименование");
			
			СчОбъектов = СчОбъектов + 1;
			
			#Если Клиент Тогда
			Сч = Сч + 1;
			ФормаИндикатора.ЭлементыФормы.Индикатор.Значение = Сч;
			#КонецЕсли		
			
			Если СтрокаТаблицыГруппВСправочнике = Неопределено Тогда
				ТекущийРодитель = Справочники.ТребованияКТранспортнымСредствам.СоздатьГруппу();
				ТекущийРодитель.УстановитьНовыйКод("");
				ТекущийРодитель.Наименование = СокрЛП(СтрокаТаблицыТребований.Родитель);
				ТекущийРодитель.Записать();
								
				СтрокаТаблицыГруппВСправочнике = ТаблицаГруппВСправочнике.Добавить();
				СтрокаТаблицыГруппВСправочнике.Ссылка = ТекущийРодитель.Ссылка;
				СтрокаТаблицыГруппВСправочнике.Наименование = ТекущийРодитель.Наименование;
			КонецЕсли;
			
			ТекущийРодитель = СтрокаТаблицыГруппВСправочнике.Ссылка;
			
			СтрокаТаблицыТребованийВСправочнике = ТаблицаЭлементовВСправочнике.Найти(СокрЛП(СтрокаТаблицыТребований.НаименованиеПолное), "НаименованиеПолное");
			
			Если СтрокаТаблицыТребованийВСправочнике = Неопределено Тогда
				ТекущийЭлемент = Справочники.ТребованияКТранспортнымСредствам.СоздатьЭлемент();
				ТекущийЭлемент.УстановитьНовыйКод("");
			Иначе
				ТекущийЭлемент = СтрокаТаблицыТребованийВСправочнике.Ссылка.ПолучитьОбъект();
			КонецЕсли;
			
			ТекущийЭлемент.Номер = СтрокаТаблицыТребований.Номер;
			ТекущийЭлемент.Родитель = ТекущийРодитель;
			ТекущийЭлемент.Наименование = СокрЛП(СтрокаТаблицыТребований.НаименованиеПолное);
			ТекущийЭлемент.НаименованиеПолное =  СокрЛП(СтрокаТаблицыТребований.НаименованиеПолное);
			ТекущийЭлемент.Описание = СокрЛП(СтрокаТаблицыТребований.Описание);
			
			ТЧ = ТекущийЭлемент.ДиапазонЗначений;
			ТЧ.Очистить();
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияM1Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_M1;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияM1МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияM1МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияN1Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_N1;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияN1МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияN1МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияM2Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_M2;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияM2МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияM2МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияN2Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_N2;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияN2МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияN2МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияM3Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_M3;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияM3МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияM3МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияN3Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_N3;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияN3МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияN3МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияO1O2Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_O1;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияO1O2МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияO1O2МаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_O2;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияO1O2МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияO1O2МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияO3O4Использование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_O3;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияO3O4МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияO3O4МаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_O4;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияO3O4МинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияO3O4МаксЗнач;
			КонецЕслИ;
			Если СокрЛП(СтрокаТаблицыТребований.КатегорияLИспользование) = "Х" Тогда
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L1;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L2;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L3;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L4;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L5;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L6;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
				НоваяСтрока = ТЧ.Добавить();
				НоваяСтрока.КатегорияТранспортногоСредства = ТС_L7;
				НоваяСтрока.ЗначениеМин = СтрокаТаблицыТребований.КатегорияLМинЗнач;
				НоваяСтрока.ЗначениеМакс = СтрокаТаблицыТребований.КатегорияLМаксЗнач;
			КонецЕслИ;
				
			Попытка
				ТекущийЭлемент.Записать();
			Исключение
				Сообщить("Не удалось записать элемент """ + СокрЛП(СтрокаТаблицыТребований.Наименование) +  """");	
			КонецПопытки;
			
		КонецЦикла;	
		
	Исключение
		#Если Клиент Тогда
		Предупреждение("Не удалось загрузить макет!");
		#КонецЕсли		
	КонецПопытки;	
	#Если Клиент Тогда
	Состояние("");
	Если ФормаИндикатора.Открыта() Тогда ФормаИндикатора.Закрыть(); КонецЕсли;
	Сообщить("Загружено объектов в справочник: " + СчОбъектов);
	#КонецЕсли		
КонецПроцедуры // ЗагрузитьТребованияИзМакета() Экспорт	
