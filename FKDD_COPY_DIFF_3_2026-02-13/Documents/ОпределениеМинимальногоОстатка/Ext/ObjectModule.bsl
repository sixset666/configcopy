Перем Права Экспорт;				// Переменная объекта - ссылка на коллекцию прав, настроек и переменных окружения
Перем ОбработкаЗначенияСвойствОбъектов Экспорт; // Переменная для хранения значения свойств основания/объекта копирования

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	Если Дата <= Дата(2019, 07, 15) тогда
		сообщить("Ранее 15 июля 2019 года проводить нельзя!");
		Отказ = Истина;
		Возврат;
	КонецЕсли;	
	Для каждого СтрокаДокумента из Товары цикл
		Если СтрокаДокумента.УстанавливаемыйМинимальныйОстаток <> СтрокаДокумента.РассчитанныйМинимальныйОстаток И СтрокаДокумента.Комментарий = "" тогда
			сообщить("В строке №" + СтрокаДокумента.НомерСтроки + " обязательно нужно указать причину изменения минимального остатка! Заполните колонку Комментарий для этой строки! ");
			Отказ = Истина;
			Возврат;
		КонецЕсли;
	КонецЦикла;	
	
	Для каждого СтрокаДокумента из Товары цикл
		Если (СтрокаДокумента.ТипXYZ = "") Тогда 
			сообщить("ТИП XYZ по номенклатуре " + СтрокаДокумента.Номенклатура + " не рассчитан!!! Необходимо произвести расчет документа автоматически! ");
			Отказ = Истина;
			Возврат;
		КонецЕсли;
		Если (СтрокаДокумента.ГруппаABC = "")  Тогда
			сообщить("Группа ABC по номенклатуре " + СтрокаДокумента.Номенклатура + " не рассчитана!!! Необходимо произвести расчет документа автоматически! ");
			Отказ = Истина;
			Возврат;
		КонецЕсли;
	КонецЦикла;	
	НаборЗаписей = РегистрыСведений.ДополнительныеРеквизитыНоменклатуры.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.ПодразделениеКомпании.Установить(ПодразделениеКомпании);
	НаборЗаписей.Отбор.ДополнительныйРеквизит.Установить(Перечисления.ДополнительныеРеквизитыНоменклатуры.МинимальныйОстаток);
	НаборЗаписей.Отбор.Период.Установить(Дата);
	НаборЗаписей.Записать();
	
	Для Каждого СтрокаТаблицы Из Товары Цикл 
		
		НоваяЗапись = НаборЗаписей.Добавить(); 
		
		НоваяЗапись.Номенклатура = СтрокаТаблицы.Номенклатура; 
		НоваяЗапись.ПодразделениеКомпании = ПодразделениеКомпании; 
		НоваяЗапись.ДополнительныйРеквизит = Перечисления.ДополнительныеРеквизитыНоменклатуры.МинимальныйОстаток; 
		НоваяЗапись.Период = Дата; 
		НоваяЗапись.ЗначениеРеквизита = СтрокаТаблицы.УстанавливаемыйМинимальныйОстаток; 
		
	КонецЦикла; 
	
	НаборЗаписей.Записать();

	
	НаборЗаписей = РегистрыСведений.ВычисляемыеПараметрыДляМинимальныхОстатков.СоздатьНаборЗаписей();
	НаборЗаписей.Отбор.Период.Установить(Дата);
	НаборЗаписей.Записать();
	
	
	Для Каждого СтрокаТаблицы Из Товары Цикл 
		
		НоваяЗапись = НаборЗаписей.Добавить(); 
		НоваяЗапись.Номенклатура = СтрокаТаблицы.Номенклатура; 
		НоваяЗапись.Период = Дата; 
		НоваяЗапись.ГруппаABC = СтрокаТаблицы.ГруппаABC; 
		НоваяЗапись.ТипXYZ = СтрокаТаблицы.ТипXYZ; 
		
	КонецЦикла; 
	
	НаборЗаписей.Записать();

КонецПроцедуры

Процедура ОбработкаУдаленияПроведения(Отказ) Экспорт
	
		НаборЗаписей = РегистрыСведений.ДополнительныеРеквизитыНоменклатуры.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.ПодразделениеКомпании.Установить(ПодразделениеКомпании);
		НаборЗаписей.Отбор.ДополнительныйРеквизит.Установить(Перечисления.ДополнительныеРеквизитыНоменклатуры.МинимальныйОстаток);
		НаборЗаписей.Отбор.Период.Установить(Дата);
		НаборЗаписей.Записать();

		НаборЗаписей = РегистрыСведений.ВычисляемыеПараметрыДляМинимальныхОстатков.СоздатьНаборЗаписей();
		НаборЗаписей.Отбор.Период.Установить(Дата);
		НаборЗаписей.Записать();

КонецПроцедуры

//&НаСервере
//Процедура ТабличныйДокументФормирование(ТабДокумент, ЭтотОбъект)
//Пробный.ТабличныйДокумент_Формирование(ТабДокумент, ЭтотОбъект);	
//КонецПроцедуры

//&НаСервере
//Процедура Печать(Кнопка) Экспорт
//////	Макет = ПолучитьМакет("Макет");
//////	ОбластьМакета = Макет.ПолучитьОбласть("Шапка");
//	ТабДокумент = Новый ТабличныйДокумент();

//////	ОбластьМакета.Параметры.Дата = Дата; 
//////	ОбластьМакета.Параметры.Год_ДоТекущегоМесяца = ФОРМАТ(НачалоМесяца(ДобавитьМесяц(Дата, -ЧислоМесяцевДляРасчета)), "ДЛФ") + " - " + Формат(КонецМесяца(ДобавитьМесяц(Дата, -1)), "ДЛФ");
//////	ТабДокумент.Вывести(ОбластьМакета);	
//////	
//////	//перебор строк
//////	ОбластьМакета = Макет.ПолучитьОбласть("Строка|Таблица");
//////	//ТаблицаТолькоНеликвид = Неликвид();
//////	Для Каждого СтрокаТабл Из Товары Цикл
//////	//	ЦветСтроки = ЭлементыФормы.Товары.ОформлениеСтроки(СтрокаТабл).ЦветФона;
//////		ОбластьМакета.Параметры.Заполнить(СтрокаТабл);
//////	//	ОбластьМакета.Области.Строка.ЦветФона = ЦветСтроки;
//////		ТабДокумент.Вывести(ОбластьМакета);
////////		сообщить("строка макета №" + СтрокаТабл.НомерСтроки);



//////		//СтрокаТаблНеликвид = ТаблицаТолькоНеликвид.Найти(СтрокаТабл.Номенклатура, "Номенклатура");
//////		//
//////		//Если СтрокаТаблНеликвид<>Неопределено тогда
//////		//	ОбластьМакета = Макет.ПолучитьОбласть("СтрокаНеликвид");
//////		//Иначе
//////		//	ОбластьМакета = Макет.ПолучитьОбласть("Строка");
//////		//КонецЕсли;
//////		//ОбластьМакета.Параметры.Заполнить(СтрокаТабл);
//////		//ТабДокумент.Вывести(ОбластьМакета);
//////	КонецЦикла;
//////	
//ТабличныйДокументФормирование(ТабДокумент, ЭтотОбъект);
//ТабДокумент.Показать();
//	
//КонецПроцедуры

// сохранение ссылки на коллекцию прав, настроек и окружения
Права = Неопределено;
#Если Клиент Тогда
	Права = глПрава;
#КонецЕсли
