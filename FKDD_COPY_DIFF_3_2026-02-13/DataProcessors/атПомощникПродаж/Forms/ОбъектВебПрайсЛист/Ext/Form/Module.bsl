
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("ДанныеОбъекта") Тогда
		
		ДанныеОбъекта = Параметры.ДанныеОбъекта;
		
		Если ДанныеОбъекта.Свойство("Опции") Тогда
			ЗаполнитьЗначенияСвойств(ЭтаФорма, ДанныеОбъекта,, "СпособыЗаказа, Опции");
			
			Для Каждого СтрокаОпций ИЗ ДанныеОбъекта.Опции Цикл
				
				НоваяСтрока = Опции.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаОпций);
				
			КонецЦикла;
			
		Иначе
			ЗаполнитьЗначенияСвойств(ЭтаФорма, ДанныеОбъекта,, "СпособыЗаказа");
		КонецЕсли;
		
		Для Каждого СтрокаПараметров ИЗ ДанныеОбъекта.Параметры Цикл
			
			НоваяСтрока = ПараметрыПрайсЛиста.Добавить();
			ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаПараметров);
			
		КонецЦикла;
		
		Для Каждого СтрокаСпособа ИЗ ДанныеОбъекта.СпособыЗаказа Цикл
			
			НоваяСтрока = СпособыЗаказа.Добавить();
			НоваяСтрока.Способ = СтрокаСпособа;
			
		КонецЦикла;
		
	Иначе
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПолучитьОпцииНаСервере()
	
	атСервер.ПрайсЛистыЗаполнитьТаблицуОпций(Код, ПараметрыПрайсЛиста.Выгрузить(), Опции);
	
КонецПроцедуры

&НаКлиенте
Процедура ПолучитьОпции(Команда)
	ПолучитьОпцииНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ПриЗакрытии()
	ПриЗакрытииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПриЗакрытииНаСервере()
	
	МассивПараметров = Новый Массив;
	
	Для Каждого СтрокаПараметра ИЗ ПараметрыПрайсЛиста Цикл
		
		Структура = Новый Структура("Имя, Заголовок, Описание, РежимПароля, Значение");
		ЗаполнитьЗначенияСвойств(Структура, СтрокаПараметра);
		МассивПараметров.Добавить(Структура);
		
	КонецЦикла;
	
	ДанныеОбъекта.Вставить("Параметры", МассивПараметров);
	
	МассивОпций = Новый Массив;
	
	Для Каждого СтрокаОпций ИЗ Опции Цикл
		
		Структура = Новый Структура("Имя, ЗначениеПоУмолчанию, Значение, СписокЗначений, Описание, Заголовок");
		ЗаполнитьЗначенияСвойств(Структура, СтрокаОпций);
		МассивОпций.Добавить(Структура);
		
	КонецЦикла;
	
	ДанныеОбъекта.Вставить("Опции", МассивОпций);
	ДанныеОбъекта.Вставить("СпособЗаказа", СпособЗаказа);
	
	атСервер.ЗаписатьДополнительныеПараметры(Новый Структура("Тип, Код, ВладелецТип, ВладелецКод", "ВебПрайсЛисты", Код, "", ""), ДанныеОбъекта);
	
КонецПроцедуры

