
&НаКлиенте
Процедура Применить()
	
	МассивВозврата = Новый Массив;

	Для Каждого Условие Из ТаблицаУсловий Цикл
		СтруктураВозврата = Новый Структура("Name,Note,Value,SSDModification");
		СтруктураВозврата.Name = Условие.Name;
		Если НРег(Условие.Type) = "input" Тогда
			Условие.Regexp = Условие.Value;
			СтруктураВозврата.Note = "Введено пользователем";
			СтруктураВозврата.Value = ""+СокрЛП(Условие.Regexp);
			СтруктураВозврата.SSDModification = СтрЗаменить(Условие.SSDModification,"$",СокрЛП(Условие.Regexp));
		Иначе
			СтруктураВозврата.Note = Условие.Note;
			СтруктураВозврата.Value = Условие.Value;
			СтруктураВозврата.SSDModification = Условие.SSDModification;
		КонецЕсли;
		МассивВозврата.Добавить(СтруктураВозврата);
	КонецЦикла;
	
	Если МассивВозврата.Количество() <> 0 Тогда
		ЭтаФорма.Закрыть(МассивВозврата);
	Иначе
		ЭтаФорма.Закрыть(Неопределено);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ТаблицаУсловийВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ТекСтрока = Элементы.ТаблицаУсловий.ТекущиеДанные;
	Если ТекСтрока.Type = "list" Тогда
		//будем показывать список значений
		СписокВариантов = Новый СписокЗначений;
		Для Каждого ВозможныйВариант Из ТекСтрока.ListValues Цикл
			СписокВариантов.Добавить(ВозможныйВариант.Name);
		КонецЦикла;
		
		ВыбранныйПункт = ВыбратьИзСписка(СписокВариантов, Элементы.ТаблицаУсловийValue);
		Если ВыбранныйПункт = Неопределено Тогда
			Элементы.ТаблицаУсловий.ЗакончитьРедактированиеСтроки(Истина);
			Возврат;
		КонецЕсли;
		
		ТекСтрока.Value = ВыбранныйПункт.Значение;
		
		СтруктураПараметров = Новый Структура("Name", ВыбранныйПункт.Значение); 
		МассивСтрок = ТекСтрока.ListValues.НайтиСтроки(СтруктураПараметров);
		ТекСтрока.SSDModification = МассивСтрок[0].ssdModification; 
		ТекСтрока.Note = МассивСтрок[0].Note;
		
		Элементы.ТаблицаУсловий.ЗакончитьРедактированиеСтроки(Ложь);
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Данные") Тогда
		Для Каждого СтрокаДанных Из Параметры.Данные Цикл
			Если СтрокаДанных = "" Тогда
				Продолжить;
			КонецЕсли;
			СтрокаТаблицыУсловий = ТаблицаУсловий.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаТаблицыУсловий, СтрокаДанных);
			Если СтрокаДанных.Type = "list" Тогда
				//тогда нужно заполнить values
				Если ТипЗнч(СтрокаДанных.values.row) = Тип("Структура") Тогда
					НоваяСтрока = СтрокаТаблицыУсловий.ListValues.Добавить();
					ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДанных.values.row);
				Иначе
					// Массив!
					Для Каждого Строка Из СтрокаДанных.values.row Цикл
						НоваяСтрока = СтрокаТаблицыУсловий.ListValues.Добавить();
						ЗаполнитьЗначенияСвойств(НоваяСтрока, Строка);
					КонецЦикла;
				КонецЕсли;
			Иначе
				//type = input
				СтрокаТаблицыУсловий.Value = "";
			КонецЕсли;
		КонецЦикла;
	КонецЕсли
КонецПроцедуры

&НаКлиенте
Процедура ТаблицаУсловийПриАктивизацииСтроки(Элемент)
	Попытка
		Если Элемент.ТекущиеДанные.Type = "list" Тогда
			Элементы.ТаблицаУсловийValue.ТолькоПросмотр = Истина;	
		Иначе
			Элементы.ТаблицаУсловийValue.ТолькоПросмотр = Ложь;
		КонецЕсли;
	Исключение
	КонецПопытки;
КонецПроцедуры
