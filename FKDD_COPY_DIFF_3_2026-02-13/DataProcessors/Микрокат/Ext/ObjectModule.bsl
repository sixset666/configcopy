#Если Клиент Тогда
	
Перем РезультатЗагрузки Экспорт; // хранится результат загрузки
Перем Права Экспорт;             // права пользователя

// Удаляет файл импорта(принятое сообщение от Микрокат)
Процедура УдалитьФайлИмпорта() Экспорт
	
	// Позаботимся о файле импорта, и вообще каждый сам должен заботится о файлах,
	// потому как о файле экспорта Микрокат сам заботится :)
	Попытка
		УдалитьФайлы(КаталогФайлов+ИмяФайлаИмпорта);
	Исключение
		// Возможно установлен атрибут "только чтение"(пока только предположение)... Бог его знает что ещё может быть...
		Сообщить(ОписаниеОшибки());		
	КонецПопытки;
	
КонецПроцедуры // УдалитьФайлИмпорта()

// Возвращает таблицу остатков для номенклатуры
Функция ПолучитьТаблицуОстатков(Артикул) Экспорт
	
	Запрос = Новый Запрос("ВЫБРАТЬ
	|	ТабНоменклатура.Ссылка.Артикул КАК Номер,
	|	ТабНоменклатура.Ссылка КАК Номенклатура,
	|	СУММА(ЕСТЬNULL(ОстаткиТоваровКомпанииОстатки.КоличествоОстаток, 0)) КАК КоличествоОстаток,
	|	СУММА(ЕСТЬNULL(ОстаткиТоваровКомпанииОстатки.РезервОстаток, 0)) КАК РезервОстаток
	|ИЗ
	|	(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|		Номенклатура.Ссылка КАК Ссылка
	|	ИЗ
	|		Справочник.Номенклатура КАК Номенклатура
	|	ГДЕ
	|		Номенклатура.Артикул В(&СписокНомеров)) КАК ТабНоменклатура
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрНакопления.ОстаткиТоваровКомпании.Остатки(&Период, " + ?(СкладКомпании.Пустая(), "","СкладКомпании = &СкладКомпании") + ") КАК ОстаткиТоваровКомпанииОстатки
	|		ПО ТабНоменклатура.Ссылка = ОстаткиТоваровКомпанииОстатки.Номенклатура
	|
	|СГРУППИРОВАТЬ ПО
	|	ТабНоменклатура.Ссылка.Артикул,
	|	ТабНоменклатура.Ссылка");
	
	Запрос.УстановитьПараметр("СписокНомеров", Артикул);
	Запрос.УстановитьПараметр("СкладКомпании", СкладКомпании);
	Запрос.УстановитьПараметр("Период",ТекущаяДата());
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции // ПолучитьТаблицуОстатков()

// Поиск контрагента по коду, либо по наименованию
Функция ПоискКонтрагента(ТипЗапросаМикрокат, ТекстЗапросаМикрокат) Экспорт
	// ТипЗапросаМикрокат - Либо значение кода, либо значение наименования контрагента	
	Запрос=Новый Запрос;
	Запрос.Текст="ВЫБРАТЬ ПЕРВЫЕ 1
	|	Контрагенты.Ссылка
	|ИЗ
	|	Справочник.Контрагенты КАК Контрагенты
	|ГДЕ
	|	Контрагенты."+?(ТипЗапросаМикрокат="1","Наименование ПОДОБНО &ТекстЗапроса","Код=&ТекстЗапроса");
	Запрос.УстановитьПараметр("ТекстЗапроса",ТекстЗапросаМикрокат);
	ТЗРезультатЗапроса=Запрос.Выполнить().Выгрузить();
	
	Возврат ТЗРезультатЗапроса;
	
КонецФункции // ПоискКонтрагента()

// Возвращает список автомобилей контрагента
Функция ПолучитьАвтомобилиКонтрагента(Контрагент) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = "ВЫБРАТЬ
	|	АвтомобилиСрезПоследних.Автомобиль.Ссылка КАК Автомобиль
	|ИЗ
	|	РегистрСведений.Автомобили.СрезПоследних(, ВидЗначения = ЗНАЧЕНИЕ(Перечисление.ДополнительнаяИнформацияАвтомобилей.Хозяин)) КАК АвтомобилиСрезПоследних
	|ГДЕ
	|	АвтомобилиСрезПоследних.Значение = &Хозяин";
	Запрос.УстановитьПараметр("Хозяин",Контрагент);
	РезультатЗапроса=Запрос.Выполнить().Выгрузить();
	Возврат РезультатЗапроса;
	
КонецФункции // ПолучитьАвтомобилиКонтрагента()

// Возвращает найденное транспортное средство по VIN, либо гаражному номеру
Функция ПоискТранспортногоСредства(VIN=Неопределено,НомерГаражный=Неопределено) Экспорт
	
	Запрос=Новый Запрос;
	Запрос.Текст="ВЫБРАТЬ
	|	Автомобили.Ссылка
	|ИЗ
	|	Справочник.Автомобили КАК Автомобили
	|ГДЕ
	|	Автомобили.VIN = &VIN
	|	ИЛИ Автомобили.НомерГаражный = &НомерГаражный";
	Запрос.УстановитьПараметр("VIN",VIN);
	Запрос.УстановитьПараметр("НомерГаражный",НомерГаражный);
	РезультатЗапроса=Запрос.Выполнить().Выгрузить();
	Возврат РезультатЗапроса;
	
КонецФункции // ПоискТранспортногоСредства()

// Приводит строку артикула к строке с требуемой маской
Функция ПолучитьПредставлениеАртикула(Артикул) Экспорт 
	
	// Из микрокат передается артикул в виде строки без разделителя "-". Строка всегда состоит из 10 символов.
	// Артикул до: 0911160075
	// Нужно его привести к нормальному виду по аналогии с микрокат
	// Артикул после: 09111-60075
	Если СтрДлина(Артикул)=10 Тогда
		Возврат Лев(Артикул,5)+"-"+Прав(Артикул,5);
	Иначе
		// Никак не представляем
		Возврат Артикул;
	КонецЕсли;
	
КонецФункции // ПолучитьПредставлениеАртикула()

// Устанавливает новый номер транзакции
Функция УстановитьНовыйНомерТранзакции() Экспорт
	
	ГСЧ=Новый ГенераторСлучайныхЧисел(ТекущаяДата()-'00010101');
	Возврат СтрЗаменить(Строка(ГСЧ.СлучайноеЧисло(150000,190000))," ","");
	
КонецФункции // УстановитьНовыйНомерТранзакции()

// Создание элемента справочника "Контрагенты"
Функция СоздатьЭлементСправочникаКонтрагенты(Наименование) Экспорт
	// НА БУДУЩЕЕ ОБСУДИТЬ С YABS
	
	//НовыйЭлемент =Справочники.Контрагенты.СоздатьЭлемент();
	////ТипКонтрагента = НеНайденныеКонтрагенты[Индекс].Значение["ТИПКОНТРАГЕНТА"];
	////Создадим контрагента
	//НовыйЭлемент.УстановитьНовыйКод();
	//Если НеНайденныеКонтрагенты[Индекс].Значение[ТипКонтрагента+"1"]=Неопределено Тогда
	//	НовыйЭлемент.Наименование=СтрокаКонтрагент;
	//	НовыйЭлемент.НаименованиеПолное=СтрокаКонтрагент;
	//Иначе
	//	НовыйЭлемент.Наименование=НеНайденныеКонтрагенты[Индекс].Значение[ТипКонтрагента+"1"];
	//	НовыйЭлемент.НаименованиеПолное=НеНайденныеКонтрагенты[Индекс].Значение[ТипКонтрагента+"1"];
	//КонецЕсли;
	//НовыйЭлемент.ИНН=НеНайденныеКонтрагенты[Индекс].Значение[ТипКонтрагента+"ИНН"];
	//НовыйЭлемент.КПП = НеНайденныеКонтрагенты[Индекс].Значение[ТипКонтрагента+"КПП"];
	//Если ТипКонтрагента="ПЛАТЕЛЬЩИК" Тогда
	//	НовыйЭлемент.ВидКонтрагента=Перечисления.ВидыКонтрагентов.Покупатель;
	//ИначеЕсли ТипКонтрагента="ПОЛУЧАТЕЛЬ" Тогда
	//	НовыйЭлемент.ВидКонтрагента=Перечисления.ВидыКонтрагентов.Поставщик;
	//Иначе
	//	НовыйЭлемент.ВидКонтрагента=Перечисления.ВидыКонтрагентов.Прочее;
	//КонецЕсли; 
	//НовыйЭлемент.ФормаСобственности=Перечисления.ФормыСобственности.Прочее;
	//Попытка
	//	НовыйЭлемент.Записать();
	//Исключение
	//	Сообщить("Ошибка при записи контрагента: "+ОписаниеОшибки());
	//КонецПопытки;
КонецФункции // СоздатьЭлементСправочникаКонтрагенты()

// Возвращает структуру прдеставления ServiceMenu, для постройки иерархии справочника "Автоработы"
Функция ПолучитьСтруктуруПредставленияServiceMenu(Знач СтрокаMenu) Экспорт
	
	СтруктураРаботы=Новый Структура;
	
	Позиция=Найти(СтрокаMenu,"•");
	СтрНомер=Лев(СтрокаMenu,Позиция);
	СтрСокр=Прав(СтрокаMenu,СтрДлина(СтрокаMenu)-Позиция);
	Если Найти(СтрСокр,"Repair/Replace")>0 Тогда
		Позиция=Найти(СтрСокр,", Repair/Replace.");
		СтрИмя=Лев(СтрСокр,Позиция-1);
		СтруктураРаботы.Вставить("а0","Repair/Replace");
		СтруктураРаботы.Вставить("а1",СтрИмя);
	Иначе
		СтруктураРаботы.Вставить("а0","Service");
		СтруктураРаботы.Вставить("а1",СтрСокр);
	КонецЕсли;
	
	//// CLUTCH: CLUTCH COMPLETE, REMOVE & REPLACE, 5 DR HATCHBACK; 1ZR-FE; MP INJ  PETROL,
	////(-) MULTI MODE MANUAL TRANS, С:01.06.2006 ПО:30.04.2008(не понятно последнее поле с периодом...)
	//Позиция=Найти(СтрокаMenu,":");
	//СтруктураРаботы.Вставить("Заголовок",Лев(СтрокаMenu,Позиция-1));
	//
	//СтрокаMenu=СокрЛП(Прав(СтрокаMenu,СтрДлина(СтрокаMenu)-(Позиция)));
	//
	//Флаг=Ложь; // Признак обрезанной строки с разделителями ","
	//м=0;
	//Пока Найти(СтрокаMenu,";")>0 ИЛИ Найти(СтрокаMenu,",")>0 Цикл
	//	СтруктураСоставаРаботы=Новый Структура;
	//	Позиция=Найти(СтрокаMenu,";");
	//	Строка=Лев(СтрокаMenu,Позиция-1);
	//	Если Найти(СтрокаMenu,";")=0 Тогда
	//		Строка=СтрокаMenu;
	//		Флаг=Истина;
	//	КонецЕсли;
	//	СтрокаMenu=СокрЛП(Прав(СтрокаMenu,СтрДлина(СтрокаMenu)-(Позиция)));
	//	н=0;
	//	Пока Найти(Строка,",")>0 Цикл
	//		Позиция=Найти(Строка,",");
	//		СтруктураСоставаРаботы.Вставить("а"+н,СокрЛП(Лев(Строка,Позиция-1)));
	//		Строка=СокрЛП(Прав(Строка,СтрДлина(Строка)-(Позиция)));
	//		н=н+1;
	//	КонецЦикла;
	//	СтруктураСоставаРаботы.Вставить("а"+н,СокрЛП(Строка));
	//	СтруктураРаботы.Вставить("Структура"+м,СтруктураСоставаРаботы);
	//	м=м+1;
	//	Если Флаг Тогда
	//		Прервать;
	//	КонецЕсли;
	//КонецЦикла;
	
	Возврат СтруктураРаботы;

КонецФункции // ПолучитьСтруктуруПредставленияServiceMenu()


РезультатЗагрузки = Неопределено;
Права = Неопределено;
Права = глПрава;
Права[ПланыВидовХарактеристик.ПраваИНастройки.АвтоСохранениеДокументов]=Ложь;
ИспользоватьПроизводителяМодели = Истина;
#КонецЕсли