
&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	ПараметрыФормы = Новый Структура;
	Если ЗначениеЗаполнено(ЭтаФорма.ОтборПоПользователю) ИЛИ ЗначениеЗаполнено(ЭтаФорма.ОтборПоКонтакту) Тогда
		Если ЗначениеЗаполнено(ЭтаФорма.ОтборПоПользователю) Тогда
			ПараметрыФормы.Вставить("ОтборПоПользователю", ЭтаФорма.ОтборПоПользователю);
		КонецЕсли;	
		Если ЗначениеЗаполнено(ЭтаФорма.ОтборПоКонтакту) Тогда
			ПараметрыФормы.Вставить("ОтборПоКонтакту", ЭтаФорма.ОтборПоКонтакту);
		КонецЕсли;	
	ИначеЕсли Копирование Тогда
		ТД = Элементы.Список.ТекущиеДанные;
		Если ЗначениеЗаполнено(ТД.Пользователь) Тогда
			ПараметрыФормы.Вставить("Пользователь", ТД.Пользователь);
		КонецЕсли;	
		Если ЗначениеЗаполнено(ТД.Контакт) Тогда
			ПараметрыФормы.Вставить("Контакт", ТД.Контакт);
		КонецЕсли;	
		Если ЗначениеЗаполнено(ТД.НомерВнТелефона) Тогда
			ПараметрыФормы.Вставить("НомерВнТелефона", ТД.НомерВнТелефона);
		КонецЕсли;	
		Если ЗначениеЗаполнено(ТД.НомерТелефона) Тогда
			ПараметрыФормы.Вставить("НомерТелефона", ТД.НомерТелефона);
		КонецЕсли;	
	Иначе		
		Возврат;		
	КонецЕсли;	
	Отказ = Истина;
	ФормаЗаписи = ПолучитьФорму("РегистрСведений.сфпПравилаЗаписиТелефонныхПереговоров.ФормаЗаписи", ПараметрыФормы, ЭтаФорма);
	ФормаЗаписи.Открыть();
КонецПроцедуры

&НаСервере
Процедура УстановитьОтборПоПользователю(Пользователь)
	ЭлементыОтбора = Список.Отбор.Элементы;
	Для Каждого ЭлементОтбора Из ЭлементыОтбора Цикл
		Если ЭлементОтбора.Представление = "ОтборПоПользователю" Тогда
			Если ЗначениеЗаполнено(Пользователь) Тогда
				ЭлементОтбора.ПравоеЗначение = Пользователь;
				ЭлементОтбора.Использование = Истина;
			Иначе
				ЭлементОтбора.Использование = Ложь;
			КонецЕсли;	
			Прервать;
		КонецЕсли;	
	КонецЦикла;	
КонецПроцедуры	

&НаСервере
Процедура УстановитьОтборПоКонтакту(Контакт)
	ЭлементыОтбора = Список.Отбор.Элементы;
	Для Каждого ЭлементОтбора Из ЭлементыОтбора Цикл
		Если ЭлементОтбора.Представление = "ОтборПоКонтакту" Тогда
			Если ЗначениеЗаполнено(Контакт) Тогда
				ЭлементОтбора.ПравоеЗначение = Контакт;
				ЭлементОтбора.Использование = Истина;
			Иначе
				ЭлементОтбора.Использование = Ложь;
			КонецЕсли;	
			Прервать;
		КонецЕсли;	
	КонецЦикла;	
КонецПроцедуры	

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если НЕ сфпСофтФонПроСервер.сфпИспользоватьЗаписьПереговоров() Тогда
		Отказ = Истина;
		Возврат;
	КонецЕсли;
	ЭтаФорма.ТолькоПросмотр	= НЕ (РольДоступна("ПолныеПрава") ИЛИ РольДоступна("ДобавлениеИзменениеПользователей"));
КонецПроцедуры

&НаКлиенте
Процедура ОтборПоПользователюПриИзменении(Элемент)
	УстановитьОтборПоПользователю(ЭтаФорма.ОтборПоПользователю);
КонецПроцедуры

&НаКлиенте
Процедура ОтборПоКонтактуПриИзменении(Элемент)
	Если (ЭтаФорма.ОтборПоКонтакту = Неопределено) ИЛИ ЗначениеЗаполнено(ЭтаФорма.ОтборПоКонтакту) Тогда
		УстановитьОтборПоКонтакту(ЭтаФорма.ОтборПоКонтакту);
	КонецЕсли;	
КонецПроцедуры
