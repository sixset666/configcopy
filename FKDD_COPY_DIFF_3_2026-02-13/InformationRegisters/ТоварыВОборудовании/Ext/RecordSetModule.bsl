Перем ДокументОбъект Экспорт; // Документ объект


// функция выполняет запись товаров в документ
Функция ЗаписатьТоварыДокумента() Экспорт
	//Запрос=Новый Запрос("
	//|ВЫБРАТЬ РАЗЛИЧНЫЕ
	//|	ГруппаТоваровОборудования
	//|ИЗ
	//|	Справочник.Оборудование
	//|ГДЕ
	//|	КлассОборудования = &КлассОборудования");
	//Запрос.УстановитьПараметр("КлассОборудования",Перечисления.КлассыОборудования.POS);
	//ВыборкаГрупп=Запрос.Выполнить().Выбрать();
	//Пока ВыборкаГрупп.Следующий() Цикл
	//	Запрос=Новый Запрос("ВЫБРАТЬ МАКСИМУМ(НомерЯчейки) КАК НомерЯчейки ИЗ РегистрСведений.ТоварыВОборудовании ГДЕ ГруппаТоваров=&ГруппаТоваров");
	//	Запрос.УстановитьПараметр("ГруппаТоваров",ВыборкаГрупп.ГруппаТоваровОборудования);
	//	ПоследнийНомер=0;
	//	Выборка=Запрос.Выполнить().Выбрать();
	//	Если Выборка.Следующий() Тогда
	//		ПоследнийНомер=?(Выборка.НомерЯчейки=NULL,0,Выборка.НомерЯчейки);
	//	КонецЕсли;
	//	ПоследнийНомер=ПоследнийНомер+1;
	//	
	//	Для Каждого СтрокаТовар Из ДокументОбъект.Товары Цикл
	//		НоваяЗапись=РегистрыСведений.ТоварыВОборудовании.СоздатьМенеджерЗаписи();
	//		НоваяЗапись.ГруппаТоваров=ВыборкаГрупп.ГруппаТоваровОборудования;
	//		НоваяЗапись.Номенклатура=СтрокаТовар.Номенклатура;
	//		НоваяЗапись.Прочитать();
	//		Если обЗначениеНеЗаполнено(НоваяЗапись.НомерЯчейки) Тогда
	//			НоваяЗапись.ГруппаТоваров=ВыборкаГрупп.ГруппаТоваровОборудования;
	//			НоваяЗапись.Номенклатура=СтрокаТовар.Номенклатура;
	//			НоваяЗапись.НомерЯчейки=ПоследнийНомер;
	//			ПоследнийНомер=ПоследнийНомер+1;
	//		КонецЕсли;
	//		НоваяЗапись.МоментИзменения=ТекущаяДата();
	//		НоваяЗапись.Записать(Истина);
	//	КонецЦикла;
	//	
	//КонецЦикла;
	
	ДокументОбъект=Неопределено;
КонецФункции

// обработчик перед записью
Процедура ПередЗаписью(Отказ, Замещение)
	Если НЕ Замещение Тогда Возврат; КонецЕсли;
	Для каждого ЗаписьНабора Из ЭтотОбъект Цикл
		Запрос = Новый Запрос;
		Запрос.Текст = "ВЫБРАТЬ
		|	ТоварыВОборудовании.Номенклатура
		|ИЗ
		|	РегистрСведений.ТоварыВОборудовании КАК ТоварыВОборудовании
		|ГДЕ
		|	ТоварыВОборудовании.ГруппаТоваров = &ГруппаТоваров И
		|	ТоварыВОборудовании.НомерЯчейки = &НомерЯчейки";
		Запрос.УстановитьПараметр("ГруппаТоваров",ЗаписьНабора.ГруппаТоваров);
		Запрос.УстановитьПараметр("НомерЯчейки",ЗаписьНабора.НомерЯчейки);
		Результат=Запрос.Выполнить();
		Выборка=Результат.Выбрать();
		Пока Выборка.Следующий() Цикл
			Если ЗаписьНабора.Номенклатура<>Выборка.Номенклатура Тогда
				Отказ=Истина;
				Сообщить("Ячейка с номером "+ЗаписьНабора.НомерЯчейки+" занята номенклатурой "+Выборка.Номенклатура);
				Возврат;
			КонецЕсли; 
		КонецЦикла;
	КонецЦикла; 
КонецПроцедуры

// проверка, принадлежит ли группа к весам
Функция ГруппаПринадлежитВесам(ГруппаТоваров) Экспорт
	Запрос=Новый Запрос("
	|ВЫБРАТЬ
	|	Ссылка
	|ИЗ
	|	Справочник.Оборудование
	|ГДЕ
	|	КлассОборудования = &КлассОборудования
	|	И ГруппаТоваровОборудования = &ГруппаТоваровОборудования");
	Запрос.УстановитьПараметр("КлассОборудования",Перечисления.КлассыОборудования.Весы);
	Запрос.УстановитьПараметр("ГруппаТоваровОборудования",ГруппаТоваров);
	
	Возврат НЕ Запрос.Выполнить().Пустой();
КонецФункции

// раскидывает товар по всем кассам
Процедура ДобавитьТоварВКассы(Номенклатура) Экспорт
	//ЗапросГруппыКуда=Новый Запрос("
	//|ВЫБРАТЬ РАЗЛИЧНЫЕ
	//|	Оборудование.ГруппаТоваровОборудования КАК ГруппаТоваровОборудования
	//|ИЗ
	//|	Справочник.Оборудование КАК Оборудование
	//|ГДЕ
	//|	Оборудование.КлассОборудования = &КлассОборудования
	//|	И НЕ 1 В (ВЫБРАТЬ 1 ИЗ РегистрСведений.ТоварыВОборудовании ГДЕ ГруппаТоваров=Оборудование.ГруппаТоваровОборудования И Номенклатура=&Номенклатура)");
	//ЗапросГруппыКуда.УстановитьПараметр("КлассОборудования",Перечисления.КлассыОборудования.POS);
	//ЗапросГруппыКуда.УстановитьПараметр("Номенклатура",Номенклатура);
	//ВыборкаГруппыКуда=ЗапросГруппыКуда.Выполнить().Выбрать();
	//Пока ВыборкаГруппыКуда.Следующий() Цикл
	//	Форма=РегистрыСведений.ТоварыВОборудовании.ПолучитьФормуСписка();
	//	НовыйНомер=Форма.ПолучитьМаксимальныйНомерЯчейки(ВыборкаГруппыКуда.ГруппаТоваровОборудования)+1;
	//	
	//	НоваяЗапись=РегистрыСведений.ТоварыВОборудовании.СоздатьМенеджерЗаписи(); 
	//	НоваяЗапись.ГруппаТоваров=ВыборкаГруппыКуда.ГруппаТоваровОборудования;
	//	НоваяЗапись.Номенклатура=Номенклатура;
	//	НоваяЗапись.НомерЯчейки=НовыйНомер;
	//	НоваяЗапись.МоментИзменения=ТекущаяДата();
	//	НоваяЗапись.Записать();
	//КонецЦикла;
КонецПроцедуры