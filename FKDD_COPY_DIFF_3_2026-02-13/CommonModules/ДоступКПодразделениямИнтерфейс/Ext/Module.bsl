Функция ЕстьЛиДоступКНастройке() Экспорт
	Если РольДоступна("ПолныеПрава") Тогда
		Возврат Истина;
	Иначе
		Возврат Ложь;
	КонецЕсли;
КонецФункции

Функция НастроенТолькоШаблон(СсылкаПользователя) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ДоступКПодразделениям.Подразделение КАК Подразделение
		|ИЗ
		|	РегистрСведений.ДоступКПодразделениям КАК ДоступКПодразделениям
		|ГДЕ
		|	ДоступКПодразделениям.ШаблонПрав = &ШаблонПрав";
	
	Запрос.УстановитьПараметр("ШаблонПрав", СсылкаПользователя);
	
	РезультатЗапроса = Запрос.Выполнить().Выгрузить();
	
	Если РезультатЗапроса.Количество() = 1 И ТипЗнч(РезультатЗапроса[0].Подразделение) = Тип("СправочникСсылка.ГруппыДоступаКПодразделениям") тогда
		Возврат РезультатЗапроса[0].Подразделение;
	Иначе 
		Возврат ложь;
	КонецЕсли;
	
КонецФункции

Функция ПолучитьВсеДоступныеПодразделения(СсылкаПользователя) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ГруппыДоступаКПодразделениямПодразделения.ПодразделениеКомпании КАК ПодразделениеКомпании
		|ПОМЕСТИТЬ ТекущиеДоступыПользователя
		|ИЗ
		|	РегистрСведений.ДоступКПодразделениям КАК ДоступКПодразделениям
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Справочник.ГруппыДоступаКПодразделениям.Подразделения КАК ГруппыДоступаКПодразделениямПодразделения
		|		ПО ДоступКПодразделениям.Подразделение.Ссылка = ГруппыДоступаКПодразделениямПодразделения.Ссылка
		|ГДЕ
		|	ДоступКПодразделениям.ШаблонПрав = &ШаблонПрав
		|	И ТИПЗНАЧЕНИЯ(ДоступКПодразделениям.Подразделение.Ссылка) = ТИП(Справочник.ГруппыДоступаКПодразделениям)
		|
		|СГРУППИРОВАТЬ ПО
		|	ГруппыДоступаКПодразделениямПодразделения.ПодразделениеКомпании
		|
		|ОБЪЕДИНИТЬ ВСЕ
		|
		|ВЫБРАТЬ
		|	ДоступКПодразделениям.Подразделение
		|ИЗ
		|	РегистрСведений.ДоступКПодразделениям КАК ДоступКПодразделениям
		|ГДЕ
		|	ДоступКПодразделениям.ШаблонПрав = &ШаблонПрав
		|	И ТИПЗНАЧЕНИЯ(ДоступКПодразделениям.Подразделение.Ссылка) = ТИП(Справочник.ПодразделенияКомпании)
		|;
		|
		|////////////////////////////////////////////////////////////////////////////////
		|ВЫБРАТЬ
		|	ПодразделенияКомпании.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ПодразделенияКомпании КАК ПодразделенияКомпании
		|ГДЕ
		|	ПодразделенияКомпании.Ссылка В ИЕРАРХИИ
		|			(ВЫБРАТЬ
		|				ТекущиеДоступыПользователя.ПодразделениеКомпании КАК ПодразделениеКомпании
		|			ИЗ
		|				ТекущиеДоступыПользователя КАК ТекущиеДоступыПользователя)";
	
	Запрос.УстановитьПараметр("ШаблонПрав", СсылкаПользователя);
	
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции 

Функция ПолучитьВсехРодителейПодразделений() Экспорт
	
	Сп = новый СписокЗначений;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	ПодразделенияКомпании.Ссылка КАК Ссылка
		|ИЗ
		|	Справочник.ПодразделенияКомпании КАК ПодразделенияКомпании
		|ГДЕ
		|	ПодразделенияКомпании.Родитель = ЗНАЧЕНИЕ(Справочник.ПодразделенияКомпании.ПустаяСсылка)";
	
	РезультатЗапроса = Запрос.Выполнить();
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();
	
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
		Сп.Добавить(ВыборкаДетальныеЗаписи.Ссылка);
	КонецЦикла;
	
	Возврат Сп;
КонецФункции